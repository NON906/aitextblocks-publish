/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={6434:(e,t,n)=>{"use strict";e=n.nmd(e);const r=(e=0)=>t=>`[${38+e};5;${t}m`,s=(e=0)=>(t,n,r)=>`[${38+e};2;${t};${n};${r}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(const[n,r]of Object.entries(t)){for(const[n,s]of Object.entries(r))t[n]={open:`[${s[0]}m`,close:`[${s[1]}m`},r[n]=t[n],e.set(s[0],s[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="[39m",t.bgColor.close="[49m",t.color.ansi256=r(),t.color.ansi16m=s(),t.bgColor.ansi256=r(10),t.bgColor.ansi16m=s(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5),enumerable:!1},hexToRgb:{value:e=>{const t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:n}=t.groups;3===n.length&&(n=n.split("").map((e=>e+e)).join(""));const r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,a=o(e),i=a[0],l=a[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,i,l)),u=0,d=l>0?i-4:i;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===l&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===l&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,s=r%3,a=[],i=16383,o=0,c=r-s;o<c;o+=i)a.push(l(e,o,o+i>c?c:o+i));return 1===s?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===s&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)n[i]=a[i],r[a.charCodeAt(i)]=i;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,r){for(var s,a,i=[],o=t;o<r;o+=3)s=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(n[(a=s)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return i.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},3204:e=>{"use strict";const t=/[\p{Lu}]/u,n=/[\p{Ll}]/u,r=/^[\p{Lu}](?![\p{Lu}])/gu,s=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,i=new RegExp("^"+a.source),o=new RegExp(a.source+s.source,"gu"),l=new RegExp("\\d+"+s.source,"gu"),c=(e,s)=>{if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");if(s={pascalCase:!1,preserveConsecutiveUppercase:!1,...s},0===(e=Array.isArray(e)?e.map((e=>e.trim())).filter((e=>e.length)).join("-"):e.trim()).length)return"";const a=!1===s.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(s.locale),c=!1===s.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(s.locale);return 1===e.length?s.pascalCase?c(e):a(e):(e!==a(e)&&(e=((e,r,s)=>{let a=!1,i=!1,o=!1;for(let l=0;l<e.length;l++){const c=e[l];a&&t.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),a=!1,o=i,i=!0,l++):i&&o&&n.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=i,i=!1,a=!0):(a=r(c)===c&&s(c)!==c,o=i,i=s(c)===c&&r(c)!==c)}return e})(e,a,c)),e=e.replace(i,""),e=s.preserveConsecutiveUppercase?((e,t)=>(r.lastIndex=0,e.replace(r,(e=>t(e)))))(e,a):a(e),s.pascalCase&&(e=c(e.charAt(0))+e.slice(1)),((e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,((e,n)=>t(n))).replace(l,(e=>t(e)))))(e,c))};e.exports=c,e.exports.default=c},2466:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},6729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,a||e,i),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},o.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,a=r.length,i=new Array(a);s<a;s++)i[s]=r[s].fn;return i},o.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,s,a,i){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,s),!0;case 5:return u.fn.call(u.context,t,r,s,a),!0;case 6:return u.fn.call(u.context,t,r,s,a,i),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,s);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,r,s){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return i(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||s&&!o.once||r&&o.context!==r||i(this,a);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[a]=1===c.length?c[0]:c:i(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o},7345:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},5860:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(6729),s=n(8147),a=n(6506),i=()=>{},o=new s.TimeoutError;t.default=class extends r{constructor(e){var t,n,r,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=i,this._resolveIdle=i,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(s=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==s?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=i,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=i,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((n,r)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const a=void 0===this._timeout&&void 0===t.timeout?e():s.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(o)}));n(await a)}catch(e){r(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},7489:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=0,s=e.length;for(;s>0;){const a=s/2|0;let i=r+a;n(e[i],t)<=0?(r=++i,s-=a+1):s=a}return r}},6506:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7489);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const s=r.default(this._queue,n,((e,t)=>t.priority-e.priority));this._queue.splice(s,0,n)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},2693:(e,t,n)=>{"use strict";const r=n(9353),s=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class a extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const i=(e,t)=>new Promise(((n,i)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=r.operation(t);o.attempt((async r=>{try{n(await e(r))}catch(e){if(!(e instanceof Error))return void i(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof a)o.stop(),i(e.originalError);else if(e instanceof TypeError&&(l=e.message,!s.includes(l)))o.stop(),i(e);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(e,r,t);try{await t.onFailedAttempt(e)}catch(e){return void i(e)}o.retry(e)||i(o.mainError())}}var l}))}));e.exports=i,e.exports.default=i,e.exports.AbortError=a},8147:(e,t,n)=>{"use strict";const r=n(7345);class s extends Error{constructor(e){super(e),this.name="TimeoutError"}}const a=(e,t,n)=>new Promise(((a,i)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);const o=setTimeout((()=>{if("function"==typeof n){try{a(n())}catch(e){i(e)}return}const r=n instanceof Error?n:new s("string"==typeof n?n:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),i(r)}),t);r(e.then(a,i),(()=>{clearTimeout(o)}))}));e.exports=a,e.exports.default=a,e.exports.TimeoutError=s},9353:(e,t,n)=>{e.exports=n(1846)},1846:(e,t,n)=>{var r=n(1960);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],s=0;s<t.retries;s++)r.push(this.createTimeout(s,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(s,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var s in r=[],e)"function"==typeof e[s]&&r.push(s);for(var a=0;a<r.length;a++){var i=r[a],o=e[i];e[i]=function(r){var s=t.operation(n),a=Array.prototype.slice.call(arguments,1),i=a.pop();a.push((function(e){s.retry(e)||(e&&(arguments[0]=s.mainError()),i.apply(this,arguments))})),s.attempt((function(){r.apply(e,a)}))}.bind(e,o),e[i].options=n}}},1960:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var s=this._errors[r],a=s.message,i=(e[a]||0)+1;e[a]=i,i>=n&&(t=s,n=i)}return t}},7429:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return l.default}});var r=h(n(3990)),s=h(n(8237)),a=h(n(5355)),i=h(n(3764)),o=h(n(6314)),l=h(n(8464)),c=h(n(6435)),u=h(n(4008)),d=h(n(8222));function h(e){return e&&e.__esModule?e:{default:e}}},4163:(e,t)=>{"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,s,a,i){return r((o=r(r(t,e),r(s,i)))<<(l=a)|o>>>32-l,n);var o,l}function a(e,t,n,r,a,i,o){return s(t&n|~t&r,e,t,a,i,o)}function i(e,t,n,r,a,i,o){return s(t&r|n&~r,e,t,a,i,o)}function o(e,t,n,r,a,i,o){return s(t^n^r,e,t,a,i,o)}function l(e,t,n,r,a,i,o){return s(n^(t|~r),e,t,a,i,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){const t=[],n=32*e.length,r="0123456789abcdef";for(let s=0;s<n;s+=8){const n=e[s>>5]>>>s%32&255,a=parseInt(r.charAt(n>>>4&15)+r.charAt(15&n),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;let s=1732584193,c=-271733879,u=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){const n=s,h=c,p=u,m=d;s=a(s,c,u,d,e[t],7,-680876936),d=a(d,s,c,u,e[t+1],12,-389564586),u=a(u,d,s,c,e[t+2],17,606105819),c=a(c,u,d,s,e[t+3],22,-1044525330),s=a(s,c,u,d,e[t+4],7,-176418897),d=a(d,s,c,u,e[t+5],12,1200080426),u=a(u,d,s,c,e[t+6],17,-1473231341),c=a(c,u,d,s,e[t+7],22,-45705983),s=a(s,c,u,d,e[t+8],7,1770035416),d=a(d,s,c,u,e[t+9],12,-1958414417),u=a(u,d,s,c,e[t+10],17,-42063),c=a(c,u,d,s,e[t+11],22,-1990404162),s=a(s,c,u,d,e[t+12],7,1804603682),d=a(d,s,c,u,e[t+13],12,-40341101),u=a(u,d,s,c,e[t+14],17,-1502002290),c=a(c,u,d,s,e[t+15],22,1236535329),s=i(s,c,u,d,e[t+1],5,-165796510),d=i(d,s,c,u,e[t+6],9,-1069501632),u=i(u,d,s,c,e[t+11],14,643717713),c=i(c,u,d,s,e[t],20,-373897302),s=i(s,c,u,d,e[t+5],5,-701558691),d=i(d,s,c,u,e[t+10],9,38016083),u=i(u,d,s,c,e[t+15],14,-660478335),c=i(c,u,d,s,e[t+4],20,-405537848),s=i(s,c,u,d,e[t+9],5,568446438),d=i(d,s,c,u,e[t+14],9,-1019803690),u=i(u,d,s,c,e[t+3],14,-187363961),c=i(c,u,d,s,e[t+8],20,1163531501),s=i(s,c,u,d,e[t+13],5,-1444681467),d=i(d,s,c,u,e[t+2],9,-51403784),u=i(u,d,s,c,e[t+7],14,1735328473),c=i(c,u,d,s,e[t+12],20,-1926607734),s=o(s,c,u,d,e[t+5],4,-378558),d=o(d,s,c,u,e[t+8],11,-2022574463),u=o(u,d,s,c,e[t+11],16,1839030562),c=o(c,u,d,s,e[t+14],23,-35309556),s=o(s,c,u,d,e[t+1],4,-1530992060),d=o(d,s,c,u,e[t+4],11,1272893353),u=o(u,d,s,c,e[t+7],16,-155497632),c=o(c,u,d,s,e[t+10],23,-1094730640),s=o(s,c,u,d,e[t+13],4,681279174),d=o(d,s,c,u,e[t],11,-358537222),u=o(u,d,s,c,e[t+3],16,-722521979),c=o(c,u,d,s,e[t+6],23,76029189),s=o(s,c,u,d,e[t+9],4,-640364487),d=o(d,s,c,u,e[t+12],11,-421815835),u=o(u,d,s,c,e[t+15],16,530742520),c=o(c,u,d,s,e[t+2],23,-995338651),s=l(s,c,u,d,e[t],6,-198630844),d=l(d,s,c,u,e[t+7],10,1126891415),u=l(u,d,s,c,e[t+14],15,-1416354905),c=l(c,u,d,s,e[t+5],21,-57434055),s=l(s,c,u,d,e[t+12],6,1700485571),d=l(d,s,c,u,e[t+3],10,-1894986606),u=l(u,d,s,c,e[t+10],15,-1051523),c=l(c,u,d,s,e[t+1],21,-2054922799),s=l(s,c,u,d,e[t+8],6,1873313359),d=l(d,s,c,u,e[t+15],10,-30611744),u=l(u,d,s,c,e[t+6],15,-1560198380),c=l(c,u,d,s,e[t+13],21,1309151649),s=l(s,c,u,d,e[t+4],6,-145523070),d=l(d,s,c,u,e[t+11],10,-1120210379),u=l(u,d,s,c,e[t+2],15,718787259),c=l(c,u,d,s,e[t+9],21,-343485551),s=r(s,n),c=r(c,h),u=r(u,p),d=r(d,m)}return[s,c,u,d]}(function(e){if(0===e.length)return[];const t=8*e.length,r=new Uint32Array(n(t));for(let n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))}},4790:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=n},6314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},8222:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(6435))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,s.default)(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}},58:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},3319:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)};const r=new Uint8Array(16)},3757:(e,t)=>{"use strict";function n(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function r(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const a=e.length/4+2,i=Math.ceil(a/16),o=new Array(i);for(let t=0;t<i;++t){const n=new Uint32Array(16);for(let r=0;r<16;++r)n[r]=e[64*t+4*r]<<24|e[64*t+4*r+1]<<16|e[64*t+4*r+2]<<8|e[64*t+4*r+3];o[t]=n}o[i-1][14]=8*(e.length-1)/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<i;++e){const a=new Uint32Array(80);for(let t=0;t<16;++t)a[t]=o[e][t];for(let e=16;e<80;++e)a[e]=r(a[e-3]^a[e-8]^a[e-14]^a[e-16],1);let i=s[0],l=s[1],c=s[2],u=s[3],d=s[4];for(let e=0;e<80;++e){const s=Math.floor(e/20),o=r(i,5)+n(s,l,c,u)+d+t[s]+a[e]>>>0;d=u,u=c,c=r(l,30)>>>0,l=i,i=o}s[0]=s[0]+i>>>0,s[1]=s[1]+l>>>0,s[2]=s[2]+c>>>0,s[3]=s[3]+u>>>0,s[4]=s[4]+d>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,255&s[0],s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,255&s[1],s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,255&s[2],s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,255&s[3],s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,255&s[4]]}},4008:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=i;var r,s=(r=n(6435))&&r.__esModule?r:{default:r};const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function i(e,t=0){return a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]}t.default=function(e,t=0){const n=i(e,t);if(!(0,s.default)(n))throw TypeError("Stringified UUID is invalid");return n}},3990:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(3319))&&r.__esModule?r:{default:r},a=n(4008);let i,o,l=0,c=0;t.default=function(e,t,n){let r=t&&n||0;const u=t||new Array(16);let d=(e=e||{}).node||i,h=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==h){const t=e.random||(e.rng||s.default)();null==d&&(d=i=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==h&&(h=o=16383&(t[6]<<8|t[7]))}let p=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:c+1;const f=p-l+(m-c)/1e4;if(f<0&&void 0===e.clockseq&&(h=h+1&16383),(f<0||p>l)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=p,c=m,o=h,p+=122192928e5;const g=(1e4*(268435455&p)+m)%4294967296;u[r++]=g>>>24&255,u[r++]=g>>>16&255,u[r++]=g>>>8&255,u[r++]=255&g;const y=p/4294967296*1e4&268435455;u[r++]=y>>>8&255,u[r++]=255&y,u[r++]=y>>>24&15|16,u[r++]=y>>>16&255,u[r++]=h>>>8|128,u[r++]=255&h;for(let e=0;e<6;++e)u[r+e]=d[e];return t||(0,a.unsafeStringify)(u)}},8237:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(7925)),s=a(n(4163));function a(e){return e&&e.__esModule?e:{default:e}}var i=(0,r.default)("v3",48,s.default);t.default=i},7925:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,n){function r(e,r,i,o){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=(0,a.default)(r)),16!==(null===(l=r)||void 0===l?void 0:l.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+e.length);if(c.set(r),c.set(e,r.length),c=n(c),c[6]=15&c[6]|t,c[8]=63&c[8]|128,i){o=o||0;for(let e=0;e<16;++e)i[o+e]=c[e];return i}return(0,s.unsafeStringify)(c)}try{r.name=e}catch(e){}return r.DNS=i,r.URL=o,r};var r,s=n(4008),a=(r=n(8222))&&r.__esModule?r:{default:r};const i="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=i;const o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o},5355:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(4790)),s=i(n(3319)),a=n(4008);function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,n){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();const i=(e=e||{}).random||(e.rng||s.default)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return(0,a.unsafeStringify)(i)}},3764:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(7925)),s=a(n(3757));function a(e){return e&&e.__esModule?e:{default:e}}var i=(0,r.default)("v5",80,s.default);t.default=i},6435:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(58))&&r.__esModule?r:{default:r};t.default=function(e){return"string"==typeof e&&s.default.test(e)}},8464:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(6435))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,s.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},8721:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});const r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let s;const a=new Uint8Array(16);function i(){if(!s&&(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(a)}const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));const l=function(e,t,n){if(r.randomUUID&&!t&&!e)return r.randomUUID();const s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=s[e];return t}return function(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}(s)}},3641:(e,t,n)=>{"use strict";n.r(t),n.d(t,{auto_export_string:()=>r,export_markdown:()=>s});const r=function(e,t,n){const r=new Blob([e],{type:n}),s=URL.createObjectURL(r),a=document.createElement("a");document.body.appendChild(a),a.download=t,a.href=s,a.click(),a.remove(),URL.revokeObjectURL(s)},s=function(){const e=function(){const e=document.getElementById("items").children;let t="";for(const n of e)if(!n.id.endsWith("_template"))if("item"==n.className)t+="#### "+n.getElementsByClassName("item_title")[0].value+"\n",t+=n.getElementsByClassName("item_content")[0].value+"\n\n";else if("conversation"==n.className){t+="#### "+n.getElementsByClassName("item_title")[0].value+"\n";const e=n.getElementsByClassName("conversation_main")[0];for(const n of e.children)"conversation_human"==n.className?t+="_Human:_\n_"+n.textContent+"_\n":t+="AI:\n"+n.textContent+"\n";t+="\n"}return t}();r(e,"untitled.md","text/markdown")}},434:(e,t,n)=>{"use strict";n.r(t),n.d(t,{add_conversation:()=>x,add_item:()=>w});const{v4:r}=n(7429),{add_undo_history:s,clear_undo_history:a,undo:i,redo:o,dump_contents:l,load_contents:c}=n(8361),{itemTitleTextArea:u,setTextareaHeight:d}=n(6548),{generate:h,instruction:p,conversation_chat:m,abort:f}=n(4099),{auto_export_string:g,export_markdown:y}=n(3641),_=function(){const e=document.getElementById("items").children;for(let t=0;t<e.length;t++)if(!e[t].id.endsWith("_template"))for(let n=t+1;n<e.length;n++)if(e[t].getElementsByClassName("item_title")[0].value==e[n].getElementsByClassName("item_title")[0].value)return!0;return!1},b=function(e,t){s();const n=document.getElementById("items").children;let r;for(let t=0;t<n.length;t++)if(!n[t].id.endsWith("_template")&&n[t]==e){r=t;break}if(t){let t=0;for(;n[t].id.endsWith("_template");)t++;if(r<=t)return;n[r-1].before(e)}else{if(r+1>=n.length)return;n[r+1].after(e)}s()},v=function(e){const t=document.getElementById("items"),n=e.getElementsByClassName("item_title")[0];let r,a="Untitled",i=0;do{r=!1;const e=t.children;for(const t of e)if(!t.id.endsWith("_template")&&t.getElementsByClassName("item_title")[0].value==a){i++,a="Untitled ("+i+")",r=!0;break}}while(r);n.value=a,e.getElementsByClassName("item_delete")[0].addEventListener("click",(()=>{s(),e.remove(),s()})),e.getElementsByClassName("item_up")[0].addEventListener("click",(()=>{b(e,!0)})),e.getElementsByClassName("item_down")[0].addEventListener("click",(()=>{b(e,!1)}))},w=function(){const e=document.getElementById("items"),t=document.getElementById("item_template").cloneNode(!0),n=e.appendChild(t);n.id="item_"+r(),u(n.getElementsByClassName("item_content")[0]),n.getElementsByClassName("item_generate")[0].addEventListener("click",(()=>{_()?window.alert("There are duplicate titles."):h(n)})),n.getElementsByClassName("item_instruction_exec")[0].addEventListener("click",(()=>{if(_())return void window.alert("There are duplicate titles.");const e=n.getElementsByClassName("item_instruction_mode")[0].value,t=n.getElementsByClassName("item_instruction_content")[0].value;p([n],e,t)}));const s=n.getElementsByClassName("item_instruction_mode")[0];s.addEventListener("change",(()=>{const e=n.getElementsByClassName("item_instruction_content")[0];"Other..."==s.value?e.style.display="inline":e.style.display="none"}));const a=n.getElementsByClassName("item_target")[0];return a.addEventListener("change",(()=>{if(a.checked){const e=document.getElementsByClassName("item");for(const t of e){const e=t.getElementsByClassName("item_target")[0];if(!t.id.endsWith("_template")&&!e.checked)return}document.getElementById("target_instruction_check_all").checked=!0}else document.getElementById("target_instruction_check_all").checked=!1})),document.getElementById("target_instruction_check_all").checked=!1,v(n),n},x=function(){const e=document.getElementById("items"),t=document.getElementById("conversation_template").cloneNode(!0),n=e.appendChild(t);return n.id="conversation_"+r(),Array.from(n.getElementsByClassName("conversation_human")).forEach((e=>e.remove())),Array.from(n.getElementsByClassName("conversation_ai")).forEach((e=>e.remove())),u(n.getElementsByClassName("conversation_input")[0]),n.getElementsByClassName("conversation_chat")[0].addEventListener("click",(()=>{m(n)})),n.getElementsByClassName("conversation_remove_last")[0].addEventListener("click",(()=>{!function(e){s();const t=e.getElementsByClassName("conversation_main")[0].children;if(t.length>=2){t[t.length-1].remove();const n=e.getElementsByClassName("conversation_input")[0];n.value=t[t.length-1].textContent,d(n),t[t.length-1].remove()}const n=e.getElementsByClassName("conversation_display")[0].children;n.length>=2&&(n[n.length-1].remove(),n[n.length-1].remove()),s()}(n)})),v(n),n},k=function(){const e=document.getElementById("api_selector_api"),t=document.getElementById("api_key"),n=localStorage.getItem(e.value+"_api_key");t.value=null!=n?n:"";const r=document.getElementById("api_model_name"),s=localStorage.getItem(e.value+"_api_model_name");null!=s?r.value=s:"Google AI Studio"==e.value?r.value="gemini-pro":"OpenAI API"==e.value&&(r.value="gpt-3.5-turbo");const a=document.getElementById("api_harm_parent");if("Google AI Studio"==e.value){a.style="display:inline;";const t=document.getElementById("api_harm"),n=localStorage.getItem(e.value+"_api_harm");t.value=null!=n?n:"Medium"}else a.style="display:none;";const i=document.getElementById("api_key_and_model_parent"),o=document.getElementById("api_url_parent");if("Google AI Studio"==e.value||"OpenAI API"==e.value)i.style="display:inline;",o.style="display:none;";else{i.style="display:none;",o.style="display:inline;";const t=document.getElementById("api_url"),n=localStorage.getItem(e.value+"_api_url");t.value=null!=n?n:"http://localhost:8080/v1"}},E=function(){const e=document.getElementById("api_selector_api"),t=document.getElementById("api_key");localStorage.setItem(e.value+"_api_key",t.value);const n=document.getElementById("api_model_name");if(localStorage.setItem(e.value+"_api_model_name",n.value),"Google AI Studio"==e.value){const t=document.getElementById("api_harm");localStorage.setItem(e.value+"_api_harm",t.value)}const r=document.getElementById("api_url");localStorage.setItem(e.value+"_api_url",r.value)},O=function(){const e=localStorage.getItem("list_save_data");return null==e?[]:JSON.parse(e)},A=function(){const e=document.getElementById("save_and_load_selector");for(;e.children.length>0;)e.children[0].remove();const t=O();for(const n of t){const t=document.createElement("option");t.value=n,e.appendChild(t)}},T=function(){const e=document.getElementById("save_and_load_selector_input"),t=localStorage.getItem("save_data_"+e.value);null!=t&&(c(JSON.parse(t)),a(),s())},P=function(){const e=document.getElementById("save_and_load_selector_input");if(null==e.value||""==e.value)return void window.alert("Please enter name.");localStorage.setItem("save_data_"+e.value,JSON.stringify(l()));let t=O(),n=!0;for(const r of t)if(r==e.value){n=!1;break}n&&(t.push(e.value),localStorage.setItem("list_save_data",JSON.stringify(t)),A())},I=function(){const e=document.getElementById("save_and_load_selector_input");localStorage.removeItem("save_data_"+e.value);const t=O(),n=[];for(const r of t)r!=e.value&&n.push(r);localStorage.setItem("list_save_data",JSON.stringify(n)),A(),e.value=""};window.addEventListener("DOMContentLoaded",(()=>{w(),document.getElementById("target_instruction_add").addEventListener("click",(()=>{s(),w(),s()})),document.getElementById("target_instruction_exec").addEventListener("click",(()=>{if(_())return void window.alert("There are duplicate titles.");const e=document.getElementById("target_instruction_mode").value,t=document.getElementById("target_instruction_content").value,n=document.getElementById("items").children;let r=[];for(const e of n)e.id.endsWith("_template")||e.getElementsByClassName("item_target")[0].checked&&r.push(e);p(r,e,t)}));const e=document.getElementById("target_instruction_mode");e.addEventListener("change",(()=>{const t=document.getElementById("target_instruction_content");"Other..."==e.value?t.style.display="inline":t.style.display="none"}));const t=document.getElementById("target_instruction_check_all");t.addEventListener("change",(()=>{const e=document.getElementsByClassName("item");for(const n of e)"item_template"!=n.id&&(n.getElementsByClassName("item_target")[0].checked=t.checked)}));const n=document.getElementById("api_selector_api"),r=localStorage.getItem("current_api");null!=r&&(n.value=r),k(),n.addEventListener("change",(()=>{k(),localStorage.setItem("current_api",n.value)})),document.getElementById("api_key").addEventListener("change",E),document.getElementById("api_model_name").addEventListener("change",E),document.getElementById("api_harm").addEventListener("change",E),document.getElementById("api_url").addEventListener("change",E),document.getElementById("save_and_load_load").addEventListener("click",T),document.getElementById("save_and_load_save").addEventListener("click",P),A(),document.getElementById("save_and_load_delete").addEventListener("click",I),document.getElementById("target_instruction_add_conversation").addEventListener("click",(()=>{s(),x(),s()})),document.getElementById("target_instruction_undo").addEventListener("click",i),document.getElementById("target_instruction_redo").addEventListener("click",o),s(),document.getElementById("save_and_load_export").addEventListener("click",(()=>{const e=document.getElementById("save_and_load_export_type").value;"JSON"==e?g(JSON.stringify(l()),"untitled.json","application/json"):"MarkDown"==e&&y()})),document.getElementById("save_and_load_import").addEventListener("change",(e=>{const t=e.target.files[0],n=new FileReader;n.onload=function(e){c(JSON.parse(e.target.result))},n.readAsText(t)})),document.getElementById("abort_btn").addEventListener("click",f)}))},4099:(e,t,n)=>{"use strict";n.r(t),n.d(t,{abort:()=>Ia,conversation_chat:()=>Pa,generate:()=>Aa,instruction:()=>Ta});var r,s,a,i,o,l,c={};n.r(c),n.d(c,{APIConnectionError:()=>Re,APIConnectionTimeoutError:()=>je,APIError:()=>Ce,APIUserAbortError:()=>Ne,AuthenticationError:()=>Me,BadRequestError:()=>$e,ConflictError:()=>Ue,InternalServerError:()=>Ze,NotFoundError:()=>Be,OpenAIError:()=>Se,PermissionDeniedError:()=>Le,RateLimitError:()=>ze,UnprocessableEntityError:()=>De}),function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"}(r||(r={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(s||(s={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(a||(a={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(i||(i={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.OTHER="OTHER"}(o||(o={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(l||(l={}));class u extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class d extends u{constructor(e,t){super(e),this.response=t}}const h="0.1.3",p="genai-js";var m;!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(m||(m={}));class f{constructor(e,t,n,r){this.model=e,this.task=t,this.apiKey=n,this.stream=r}toString(){let e=`https://generativelanguage.googleapis.com/v1/models/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}}async function g(e,t){let n;try{if(n=await fetch(e.toString(),{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-client":`${p}/${h}`,"x-goog-api-key":e.apiKey},body:t}),!n.ok){let e="";try{const t=await n.json();e=t.error.message,t.error.details&&(e+=` ${JSON.stringify(t.error.details)}`)}catch(e){}throw new Error(`[${n.status} ${n.statusText}] ${e}`)}}catch(t){const n=new u(`Error fetching from ${e.toString()}: ${t.message}`);throw n.stack=t.stack,n}return n}function y(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),b(e.candidates[0]))throw new d(`${v(e)}`,e);return function(e){var t,n,r,s;return(null===(s=null===(r=null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r[0])||void 0===s?void 0:s.text)?e.candidates[0].content.parts[0].text:""}(e)}if(e.promptFeedback)throw new d(`Text not available. ${v(e)}`,e);return""},e}const _=[o.RECITATION,o.SAFETY];function b(e){return!!e.finishReason&&_.includes(e.finishReason)}function v(e){var t,n,r;let s="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(r=e.candidates)||void 0===r?void 0:r[0]){const t=e.candidates[0];b(t)&&(s+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(s+=`: ${t.finishMessage}`))}}else s+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(s+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(s+=`: ${e.promptFeedback.blockReasonMessage}`);return s}function w(e){return this instanceof w?(this.v=e,this):new w(e)}"function"==typeof SuppressedError&&SuppressedError;const x=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function k(e){const t=[],n=e.getReader();for(;;){const{done:e,value:r}=await n.read();if(e)return y(O(t));t.push(r)}}function E(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=n.apply(e,t||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){s[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||o(e,t)}))})}function o(e,t){try{(n=s[e](t)).value instanceof w?Promise.resolve(n.value.v).then(l,c):u(a[0][2],n)}catch(e){u(a[0][3],e)}var n}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,(function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield w(t.read());if(n)break;yield yield w(y(e))}}))}function O(e){const t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(const t of e)if(t.candidates)for(const e of t.candidates){const t=e.index;if(n.candidates||(n.candidates=[]),n.candidates[t]||(n.candidates[t]={index:e.index}),n.candidates[t].citationMetadata=e.citationMetadata,n.candidates[t].finishReason=e.finishReason,n.candidates[t].finishMessage=e.finishMessage,n.candidates[t].safetyRatings=e.safetyRatings,e.content&&e.content.parts){n.candidates[t].content||(n.candidates[t].content={role:e.content.role||"user",parts:[{text:""}]});for(const r of e.content.parts)r.text&&(n.candidates[t].content.parts[0].text+=r.text)}}return n}async function A(e,t,n){const r=new f(t,m.STREAM_GENERATE_CONTENT,e,!0);return function(e){const t=function(e){const t=e.getReader();return new ReadableStream({start(e){let n="";return function r(){return t.read().then((({value:t,done:s})=>{if(s)return n.trim()?void e.error(new u("Failed to parse stream")):void e.close();n+=t;let a,i=n.match(x);for(;i;){try{a=JSON.parse(i[1])}catch(t){return void e.error(new u(`Error parsing JSON response: "${i[1]}"`))}e.enqueue(a),n=n.substring(i[0].length),i=n.match(x)}return r()}))}()}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,r]=t.tee();return{stream:E(n),response:k(r)}}(await g(r,JSON.stringify(n)))}async function T(e,t,n){const r=new f(t,m.GENERATE_CONTENT,e,!1),s=await g(r,JSON.stringify(n));return{response:y(await s.json())}}function P(e,t){let n=[];if("string"==typeof e)n=[{text:e}];else for(const t of e)"string"==typeof t?n.push({text:t}):n.push(t);return{role:t,parts:n}}function I(e){return e.contents?e:{contents:[P(e,"user")]}}const S="SILENT_ERROR";class C{constructor(e,t,n){this.model=t,this.params=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(this._history=n.history.map((e=>{if(!e.role)throw new Error("Missing role for history item: "+JSON.stringify(e));return P(e.parts,e.role)})))}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,n;await this._sendPromise;const r=P(e,"user"),s={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,r]};let a;return this._sendPromise=this._sendPromise.then((()=>T(this._apiKey,this.model,s))).then((e=>{var t;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(r);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{const t=v(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}a=e})),await this._sendPromise,a}async sendMessageStream(e){var t,n;await this._sendPromise;const r=P(e,"user"),s={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,r]},a=A(this._apiKey,this.model,s);return this._sendPromise=this._sendPromise.then((()=>a)).catch((e=>{throw new Error(S)})).then((e=>e.response)).then((e=>{if(e.candidates&&e.candidates.length>0){this._history.push(r);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{const t=v(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}})).catch((e=>{e.message!==S&&console.error(e)})),a}}class N{constructor(e,t){var n;this.apiKey=e,t.model.startsWith("models/")?this.model=null===(n=t.model.split("models/"))||void 0===n?void 0:n[1]:this.model=t.model,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[]}async generateContent(e){const t=I(e);return T(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t))}async generateContentStream(e){const t=I(e);return A(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t))}startChat(e){return new C(this.apiKey,this.model,e)}async countTokens(e){const t=I(e);return async function(e,t,n){const r=new f(t,m.COUNT_TOKENS,e,!1);return(await g(r,JSON.stringify(Object.assign(Object.assign({},n),{model:t})))).json()}(this.apiKey,this.model,t)}async embedContent(e){const t="string"==typeof(n=e)||Array.isArray(n)?{content:P(n,"user")}:n;var n;return async function(e,t,n){const r=new f(t,m.EMBED_CONTENT,e,!1);return(await g(r,JSON.stringify(n))).json()}(this.apiKey,this.model,t)}async batchEmbedContents(e){return async function(e,t,n){const r=new f(t,m.BATCH_EMBED_CONTENTS,e,!1),s=n.requests.map((e=>Object.assign(Object.assign({},e),{model:`models/${t}`})));return(await g(r,JSON.stringify({requests:s}))).json()}(this.apiKey,this.model,e)}}class R{constructor(e){this.apiKey=e}getGenerativeModel(e){if(!e.model)throw new u("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new N(this.apiKey,e)}}var j=n(6374),$=n(3908);const M="__run";class L{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new L({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class B extends L{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new B({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}var U="object"==typeof window?window:{},D="0123456789abcdef".split(""),z=[-2147483648,8388608,32768,128],Z=[24,16,8,0],q=[];function F(e){e?(q[0]=q[16]=q[1]=q[2]=q[3]=q[4]=q[5]=q[6]=q[7]=q[8]=q[9]=q[10]=q[11]=q[12]=q[13]=q[14]=q[15]=0,this.blocks=q):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}F.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===U.ArrayBuffer&&(e=new Uint8Array(e));for(var n,r,s=0,a=e.length||0,i=this.blocks;s<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),t)for(r=this.start;s<a&&r<64;++s)i[r>>2]|=e[s]<<Z[3&r++];else for(r=this.start;s<a&&r<64;++s)(n=e.charCodeAt(s))<128?i[r>>2]|=n<<Z[3&r++]:n<2048?(i[r>>2]|=(192|n>>6)<<Z[3&r++],i[r>>2]|=(128|63&n)<<Z[3&r++]):n<55296||n>=57344?(i[r>>2]|=(224|n>>12)<<Z[3&r++],i[r>>2]|=(128|n>>6&63)<<Z[3&r++],i[r>>2]|=(128|63&n)<<Z[3&r++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),i[r>>2]|=(240|n>>18)<<Z[3&r++],i[r>>2]|=(128|n>>12&63)<<Z[3&r++],i[r>>2]|=(128|n>>6&63)<<Z[3&r++],i[r>>2]|=(128|63&n)<<Z[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=i[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},F.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=z[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},F.prototype.hash=function(){var e,t,n=this.h0,r=this.h1,s=this.h2,a=this.h3,i=this.h4,o=this.blocks;for(e=16;e<80;++e)t=o[e-3]^o[e-8]^o[e-14]^o[e-16],o[e]=t<<1|t>>>31;for(e=0;e<20;e+=5)n=(t=(r=(t=(s=(t=(a=(t=(i=(t=n<<5|n>>>27)+(r&s|~r&a)+i+1518500249+o[e]<<0)<<5|i>>>27)+(n&(r=r<<30|r>>>2)|~n&s)+a+1518500249+o[e+1]<<0)<<5|a>>>27)+(i&(n=n<<30|n>>>2)|~i&r)+s+1518500249+o[e+2]<<0)<<5|s>>>27)+(a&(i=i<<30|i>>>2)|~a&n)+r+1518500249+o[e+3]<<0)<<5|r>>>27)+(s&(a=a<<30|a>>>2)|~s&i)+n+1518500249+o[e+4]<<0,s=s<<30|s>>>2;for(;e<40;e+=5)n=(t=(r=(t=(s=(t=(a=(t=(i=(t=n<<5|n>>>27)+(r^s^a)+i+1859775393+o[e]<<0)<<5|i>>>27)+(n^(r=r<<30|r>>>2)^s)+a+1859775393+o[e+1]<<0)<<5|a>>>27)+(i^(n=n<<30|n>>>2)^r)+s+1859775393+o[e+2]<<0)<<5|s>>>27)+(a^(i=i<<30|i>>>2)^n)+r+1859775393+o[e+3]<<0)<<5|r>>>27)+(s^(a=a<<30|a>>>2)^i)+n+1859775393+o[e+4]<<0,s=s<<30|s>>>2;for(;e<60;e+=5)n=(t=(r=(t=(s=(t=(a=(t=(i=(t=n<<5|n>>>27)+(r&s|r&a|s&a)+i-1894007588+o[e]<<0)<<5|i>>>27)+(n&(r=r<<30|r>>>2)|n&s|r&s)+a-1894007588+o[e+1]<<0)<<5|a>>>27)+(i&(n=n<<30|n>>>2)|i&r|n&r)+s-1894007588+o[e+2]<<0)<<5|s>>>27)+(a&(i=i<<30|i>>>2)|a&n|i&n)+r-1894007588+o[e+3]<<0)<<5|r>>>27)+(s&(a=a<<30|a>>>2)|s&i|a&i)+n-1894007588+o[e+4]<<0,s=s<<30|s>>>2;for(;e<80;e+=5)n=(t=(r=(t=(s=(t=(a=(t=(i=(t=n<<5|n>>>27)+(r^s^a)+i-899497514+o[e]<<0)<<5|i>>>27)+(n^(r=r<<30|r>>>2)^s)+a-899497514+o[e+1]<<0)<<5|a>>>27)+(i^(n=n<<30|n>>>2)^r)+s-899497514+o[e+2]<<0)<<5|s>>>27)+(a^(i=i<<30|i>>>2)^n)+r-899497514+o[e+3]<<0)<<5|r>>>27)+(s^(a=a<<30|a>>>2)^i)+n-899497514+o[e+4]<<0,s=s<<30|s>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+r<<0,this.h2=this.h2+s<<0,this.h3=this.h3+a<<0,this.h4=this.h4+i<<0},F.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,s=this.h4;return D[e>>28&15]+D[e>>24&15]+D[e>>20&15]+D[e>>16&15]+D[e>>12&15]+D[e>>8&15]+D[e>>4&15]+D[15&e]+D[t>>28&15]+D[t>>24&15]+D[t>>20&15]+D[t>>16&15]+D[t>>12&15]+D[t>>8&15]+D[t>>4&15]+D[15&t]+D[n>>28&15]+D[n>>24&15]+D[n>>20&15]+D[n>>16&15]+D[n>>12&15]+D[n>>8&15]+D[n>>4&15]+D[15&n]+D[r>>28&15]+D[r>>24&15]+D[r>>20&15]+D[r>>16&15]+D[r>>12&15]+D[r>>8&15]+D[r>>4&15]+D[15&r]+D[s>>28&15]+D[s>>24&15]+D[s>>20&15]+D[s>>16&15]+D[s>>12&15]+D[s>>8&15]+D[s>>4&15]+D[15&s]},F.prototype.toString=F.prototype.hex,F.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,s=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,s>>24&255,s>>16&255,s>>8&255,255&s]},F.prototype.array=F.prototype.digest,F.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};const H=(...e)=>{return t=e.join("_"),new F(!0).update(t).hex();var t};class K{}const V=new Map;class G extends K{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(H(e,t))??null)}async update(e,t,n){this.cache.set(H(e,t),n)}static global(){return new G(V)}}var W=n(1141),J=n(9636),Y=n(9742),X=Object.defineProperty;function Q(e,t){return 1===e.length?[t.get(e.join(","))]:function(e,t){let n=Array.from({length:e.length},((e,t)=>({start:t,end:t+1})));for(;n.length>1;){let r=null;for(let s=0;s<n.length-1;s++){const a=e.slice(n[s].start,n[s+1].end),i=t.get(a.join(","));null!=i&&(null==r||i<r[0])&&(r=[i,s])}if(null==r)break;{const e=r[1];n[e]={start:n[e].start,end:n[e+1].end},n.splice(e+1,1)}}return n}(e,t).map((n=>t.get(e.slice(n.start,n.end).join(",")))).filter((e=>null!=e))}var ee,te,ne=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const n=e.bpe_ranks.split("\n").filter(Boolean).reduce(((e,t)=>{const[n,r,...s]=t.split(" "),a=Number.parseInt(r,10);return s.forEach(((t,n)=>e[t]=a+n)),e}),{});for(const[e,t]of Object.entries(n)){const n=Y.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce(((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e)),{})}encode(e,t=[],n="all"){const r=new RegExp(this.patStr,"ug"),s=ne.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===n?Object.keys(this.specialTokens).filter((e=>!i.has(e))):n);if(o.size>0){const t=ne.specialTokenRegex([...o]),n=e.match(t);if(null!=n)throw new Error(`The text contains a special token that is not allowed: ${n[0]}`)}let l=0;for(;;){let t=null,n=l;for(;s.lastIndex=n,t=s.exec(e),null!=t&&!i.has(t[0]);)n=t.index+1;const o=t?.index??e.length;for(const t of e.substring(l,o).matchAll(r)){const e=this.textEncoder.encode(t[0]),n=this.rankMap.get(e.join(","));null==n?a.push(...Q(e,this.rankMap)):a.push(n)}if(null==t)break;let c=this.specialTokens[t[0]];a.push(c),l=t.index+t[0].length}return a}decode(e){const t=[];let n=0;for(let r=0;r<e.length;++r){const s=e[r],a=this.textMap.get(s)??this.inverseSpecialTokens[s];null!=a&&(t.push(a),n+=a.length)}const r=new Uint8Array(n);let s=0;for(const e of t)r.set(e,s),s+=e.length;return this.textDecoder.decode(r)}},re=ne;te=e=>new RegExp(e.map((e=>function(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}(e))).join("|"),"g"),((e,t,n)=>{t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(re,"symbol"!=typeof(ee="specialTokenRegex")?ee+"":ee,te);const se={},ae=new J.L({});var ie=n(4451);class oe extends ie.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class le extends oe{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){super({callbacks:e??t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof n.cache?this.cache=n.cache:n.cache?this.cache=G.global():this.cache=void 0,this.caller=new J.L(n??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await async function(e){return async function(e){return e in se||(se[e]=ae.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then((e=>e.json())).then((e=>new re(e))).catch((t=>{throw delete se[e],t}))),await se[e]}(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}(e))}("modelName"in this?(n=this.modelName,n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}var n;if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new W.nw(e):Array.isArray(e)?new W.GU(e.map($.E1)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){const t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()},n=Object.entries(t).filter((([e,t])=>void 0!==t)),r=n.map((([e,t])=>`${e}:${JSON.stringify(t)}`)).sort().join(",");return r}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}var ce=n(9205);class ue extends le{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,n]=super._separateRunnableConfigFromCallOptions(e);return n?.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}async invoke(e,t){const n=ue._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===ue.prototype._streamResponseChunks)yield this.invoke(e,t);else{const n=ue._convertInputToPromptValue(e).toChatMessages(),[r,s]=this._separateRunnableConfigFromCallOptions(t),a=await ce.Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i={options:s,invocation_params:this?.invocationParams(s),batch_size:1},o=await(a?.handleChatModelStart(this.toJSON(),[n],void 0,void 0,i,void 0,void 0,r.runName));let l;try{for await(const e of this._streamResponseChunks(n,s,o?.[0]))yield e.message,l=l?l.concat(e):e}catch(e){throw await Promise.all((o??[]).map((t=>t?.handleLLMError(e)))),e}await Promise.all((o??[]).map((e=>e?.handleLLMEnd({generations:[[l]]}))))}}async _generateUncached(e,t,n){const r=e.map((e=>e.map($.E1))),s=await ce.Ye.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this?.invocationParams(t),batch_size:1},i=await(s?.handleChatModelStart(this.toJSON(),r,void 0,void 0,a,void 0,void 0,n.runName)),o=await Promise.allSettled(r.map(((e,n)=>this._generate(e,{...t,promptIndex:n},i?.[n])))),l=[],c=[];await Promise.all(o.map((async(e,t)=>{if("fulfilled"===e.status){const n=e.value;return l[t]=n.generations,c[t]=n.llmOutput,i?.[t]?.handleLLMEnd({generations:[n.generations],llmOutput:n.llmOutput})}return await(i?.[t]?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const u={generations:l,llmOutput:c.length?this._combineLLMOutput?.(...c):void 0};return Object.defineProperty(u,M,{value:i?{runIds:i?.map((e=>e.runId))}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:r,handledOptions:s}){const a=e.map((e=>e.map($.E1))),i=await ce.Ye.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),o={options:r,invocation_params:this?.invocationParams(r),batch_size:1,cached:!0},l=await(i?.handleChatModelStart(this.toJSON(),a,void 0,void 0,o,void 0,void 0,s.runName)),c=[],u=(await Promise.allSettled(a.map((async(e,r)=>{const s=ue._convertInputToPromptValue(e).toString(),a=await t.lookup(s,n);return null==a&&c.push(r),a})))).map(((e,t)=>({result:e,runManager:l?.[t]}))).filter((({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status)),d=[];await Promise.all(u.map((async({result:e,runManager:t},n)=>{if("fulfilled"===e.status){const r=e.value;return d[n]=r,r.length&&await(t?.handleLLMNewToken(r[0].text)),t?.handleLLMEnd({generations:[r]})}return await(t?.handleLLMError(e.reason)),Promise.reject(e.reason)})));const h={generations:d,missingPromptIndices:c};return Object.defineProperty(h,M,{value:l?{runIds:l?.map((e=>e.runId))}:void 0,configurable:!0}),h}async generate(e,t,n){let r;r=Array.isArray(t)?{stop:t}:t;const s=e.map((e=>e.map($.E1))),[a,i]=this._separateRunnableConfigFromCallOptions(r);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(s,i,a);const{cache:o}=this,l=this._getSerializedCacheKeyParametersForCall(i),{generations:c,missingPromptIndices:u}=await this._generateCached({messages:s,cache:o,llmStringKey:l,parsedOptions:i,handledOptions:a});let d={};if(u.length>0){const e=await this._generateUncached(u.map((e=>s[e])),i,a);await Promise.all(e.generations.map((async(e,t)=>{const n=u[t];c[n]=e;const r=ue._convertInputToPromptValue(s[n]).toString();return o.update(r,l,e)}))),d=e.llmOutput??{}}return{generations:c,llmOutput:d}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){const r=e.map((e=>e.toChatMessages()));return this.generate(r,t,n)}async call(e,t,n){return(await this.generate([e.map($.E1)],t,n)).generations[0][0].message}async callPrompt(e,t,n){const r=e.toChatMessages();return this.call(r,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){const r=new $.xk(e),s=await this.call([r],t,n);if("string"!=typeof s.content)throw new Error("Cannot use predict when output is not a string.");return s.content}}function de(e,t){return e.reduce(((e,n,r)=>{if(!(0,$.QW)(n))throw new Error("Unsupported message input");const s=function(e){const t=e._getType();return $.J.isInstance(e)?e.role:e.name??t}(n);if("system"===s&&0!==r)throw new Error("System message should be the first one");const a=function(e){switch(e){case"ai":case"model":return"model";case"system":case"human":return"user";default:throw new Error(`Unknown / unsupported author: ${e}`)}}(s),i=e.content[e.content.length];if(!e.mergeWithPreviousContent&&i&&i.role===a)throw new Error("Google Generative AI requires alternate messages between authors");const o=function(e,t){return"string"==typeof e?[{text:e}]:e.map((e=>{if("text"===e.type)return{text:e.text};if("image_url"===e.type){if(!t)throw new Error("This model does not support images");if("string"!=typeof e.image_url)throw new Error("Please provide image as base64 encoded data URL");const[n,r]=e.image_url.split(",");if(!n.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[s,a]=n.replace(/^data:/,"").split(";");if("base64"!==a)throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:r,mimeType:s}}}throw new Error(`Unknown content type ${e.type}`)}))}(n.content,t);if(e.mergeWithPreviousContent){const t=e.content[e.content.length-1];if(!t)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return t.parts.push(...o),{mergeWithPreviousContent:!1,content:e.content}}const l={role:a,parts:o};return{mergeWithPreviousContent:"system"===s,content:[...e.content,l]}}),{content:[],mergeWithPreviousContent:!1}).content}function he(e){if(!e.candidates||0===e.candidates.length)return null;const[t]=e.candidates,{content:n,...r}=t,s=n?.parts[0]?.text??"";return new B({text:s,message:new $.GC({content:s,name:n?n.role:void 0,additional_kwargs:{}}),generationInfo:r})}class pe extends ue{static lc_name(){return"googlegenerativeai"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get _isMultimodalModel(){return this.modelName.includes("vision")}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=e?.modelName?.replace(/^models\//,"")??this.modelName,this.maxOutputTokens=e?.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e?.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>1))throw new Error("`temperature` must be in the range of [0.0,1.0]");if(this.topP=e?.topP??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=e?.topK??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=e?.stopSequences??this.stopSequences,this.apiKey=e?.apiKey??(0,j.lS)("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e?.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map((e=>e.category))).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=e?.streaming??this.streaming,this.client=new R(this.apiKey).getGenerativeModel({model:this.modelName,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK}})}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}async _generate(e,t,n){const r=de(e,this._isMultimodalModel);if(this.streaming){const r={},s=this._streamResponseChunks(e,t,n),a={};for await(const e of s){const t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}const i=Object.entries(a).sort((([e],[t])=>parseInt(e,10)-parseInt(t,10))).map((([e,t])=>t));return{generations:i,llmOutput:{estimatedTokenUsage:r}}}const s=function(e){if(!e.candidates||0===e.candidates.length||!e.candidates[0])return{generations:[],llmOutput:{filters:e.promptFeedback}};const[t]=e.candidates,{content:n,...r}=t,s=n?.parts[0]?.text??"";return{generations:[{text:s,message:new $.gY({content:s,name:n?n.role:void 0,additional_kwargs:r}),generationInfo:r}]}}((await this.caller.callWithOptions({signal:t?.signal},(async()=>{let e;try{e=await this.client.generateContent({contents:r})}catch(e){throw e.message?.includes("400 Bad Request")&&(e.status=400),e}return e}))).response);return await(n?.handleLLMNewToken(s.generations[0].text??"")),s}async*_streamResponseChunks(e,t,n){const r=de(e,this._isMultimodalModel),s=await this.caller.callWithOptions({signal:t?.signal},(async()=>{const{stream:e}=await this.client.generateContentStream({contents:r});return e}));for await(const e of s){const t=he(e);t&&(yield t,await(n?.handleLLMNewToken(t.text??"")))}}}const me="4.26.0";let fe,ge,ye,_e,be,ve,we,xe,ke,Ee=!1,Oe=null,Ae=null,Te=null,Pe=null;class Ie{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}fe||function(e,t={auto:!1}){if(Ee)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(fe)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${fe}'\``);Ee=t.auto,fe=e.kind,ge=e.fetch,Oe=e.Request,Ae=e.Response,Te=e.Headers,ye=e.FormData,Pe=e.Blob,_e=e.File,be=e.ReadableStream,ve=e.getMultipartRequestOptions,we=e.getDefaultAgent,xe=e.fileFromPath,ke=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,s,a;try{n=fetch,r=Request,s=Response,a=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new Ie(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class Se extends Error{}class Ce extends Se{constructor(e,t,n,r){super(`${Ce.makeMessage(e,t,n)}`),this.status=e,this.headers=r;const s=t;this.error=s,this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,n){const r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e)return new Re({cause:vt(t)});const s=t?.error;return 400===e?new $e(e,s,n,r):401===e?new Me(e,s,n,r):403===e?new Le(e,s,n,r):404===e?new Be(e,s,n,r):409===e?new Ue(e,s,n,r):422===e?new De(e,s,n,r):429===e?new ze(e,s,n,r):e>=500?new Ze(e,s,n,r):new Ce(e,s,n,r)}}class Ne extends Ce{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class Re extends Ce{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class je extends Re{constructor({message:e}={}){super({message:e??"Request timed out."})}}class $e extends Ce{constructor(){super(...arguments),this.status=400}}class Me extends Ce{constructor(){super(...arguments),this.status=401}}class Le extends Ce{constructor(){super(...arguments),this.status=403}}class Be extends Ce{constructor(){super(...arguments),this.status=404}}class Ue extends Ce{constructor(){super(...arguments),this.status=409}}class De extends Ce{constructor(){super(...arguments),this.status=422}}class ze extends Ce{constructor(){super(...arguments),this.status=429}}class Ze extends Ce{}class qe{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;const r=new Fe;return new qe((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(const n of async function*(){if(!e.body)throw t.abort(),new Se("Attempted to iterate over a response with no body");const n=new He,s=Ke(e.body);for await(const e of s)for(const t of n.decode(e)){const e=r.decode(t);e&&(yield e)}for(const e of n.flush()){const t=r.decode(e);t&&(yield t)}}())if(!s)if(n.data.startsWith("[DONE]"))s=!0;else if(null===n.event){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if(e&&e.error)throw new Ce(void 0,e.error,void 0,void 0);yield e}s=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{s||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new qe((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(const t of async function*(){const t=new He,n=Ke(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())r||t&&(yield JSON.parse(t));r=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{r||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new qe((()=>r(e)),this.controller),new qe((()=>r(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new be({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:r,done:s}=await t.next();if(s)return e.close();const a=n.encode(JSON.stringify(r)+"\n");e.enqueue(a)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}class Fe{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(":");return-1!==n?[e.substring(0,n),":",e.substring(n+1)]:[e,"",""]}(e);return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}class He{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=He.NEWLINE_CHARS.has(t[t.length-1]||"");let r=t.split(He.NEWLINE_REGEXP);return 1!==r.length||n?(this.buffer.length>0&&(r=[this.buffer.join("")+r[0],...r.slice(1)],this.buffer=[]),n||(this.buffer=[r.pop()||""]),r):(this.buffer.push(r[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Se(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Se(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Se("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function Ke(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}He.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","","","","","\u2028","\u2029"]),He.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;const Ve=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,Ge=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function We(e,t,n={}){if(e=await e,Ve(e)){const r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new _e([r],t,n)}const r=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Ge(e))t.push(await e.arrayBuffer());else{if(!Ye(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const n of e)t.push(n)}return t}(e);if(t||(t=function(e){return Je(e.name)||Je(e.filename)||Je(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!n.type){const e=r[0]?.type;"string"==typeof e&&(n={...n,type:e})}return new _e(r,t,n)}const Je=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,Ye=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],Xe=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],Qe=async e=>{const t=await et(e.body);return ve(t,e)},et=async e=>{const t=new ye;return await Promise.all(Object.entries(e||{}).map((([e,n])=>tt(t,e,n)))),t},tt=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((e=>(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&Ge(e))(e)||Ve(e)||ke(e))(n)){const r=await We(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map((n=>tt(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,r])=>tt(e,`${t}[${n}]`,r))))}}};var nt;async function rt(e){const{response:t}=e;if(e.options.stream)return Ot("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):qe.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type");if(n?.includes("application/json")){const e=await t.json();return Ot("response",t.status,t.url,t.headers,e),e}const r=await t.text();return Ot("response",t.status,t.url,t.headers,r),r}class st extends Promise{constructor(e,t=rt){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new st(this.responsePromise,(async t=>e(await this.parseResponse(t))))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class at{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:s}){this.baseURL=e,this.maxRetries=bt("maxRetries",t),this.timeout=bt("timeout",n),this.httpAgent=r,this.fetch=s??ge}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...mt(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${At()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((n=>({method:e,path:t,...n}))))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}return null}buildRequest(e){const{method:t,path:n,query:r,headers:s={}}=e,a=Xe(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,i=this.calculateContentLength(a),o=this.buildURL(n,r);"timeout"in e&&bt("timeout",e.timeout);const l=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??we(o),u=l+1e3;return"number"==typeof c?.options?.timeout&&u>(c.options.timeout??0)&&(c.options.timeout=u),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey),{req:{method:t,...a&&{body:a},headers:this.buildHeaders({options:e,headers:s,contentLength:i}),...c&&{agent:c},signal:e.signal??null},url:o,timeout:l}}buildHeaders({options:e,headers:t,contentLength:n}){const r={};return n&&(r["content-length"]=n),Et(r,this.defaultHeaders(e)),Et(r,t),Xe(e.body)&&"node"!==fe&&delete r["content-type"],this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,r){return Ce.generate(e,t,n,r)}request(e,t=null){return new st(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e;null==t&&(t=n.maxRetries??this.maxRetries),await this.prepareOptions(n);const{req:r,url:s,timeout:a}=this.buildRequest(n);if(await this.prepareRequest(r,{url:s,options:n}),Ot("request",s,n,r.headers),n.signal?.aborted)throw new Ne;const i=new AbortController,o=await this.fetchWithTimeout(s,r,a,i).catch(vt);if(o instanceof Error){if(n.signal?.aborted)throw new Ne;if(t)return this.retryRequest(n,t);if("AbortError"===o.name)throw new je;throw new Re({cause:o})}const l=lt(o.headers);if(!o.ok){if(t&&this.shouldRetry(o))return Ot(`response (error; retrying, ${t} attempts remaining)`,o.status,s,l),this.retryRequest(n,t,l);const e=await o.text().catch((e=>vt(e).message)),r=ft(e),a=r?void 0:e;throw Ot(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,o.status,s,l,a),this.makeStatusError(o.status,r,a,l)}return{response:o,options:n,controller:i}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new ot(this,n,e)}buildURL(e,t){const n=yt(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return xt(r)||(t={...r,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new Se(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:s,...a}=t||{};s&&s.addEventListener("abort",(()=>r.abort()));const i=setTimeout((()=>r.abort()),n);return this.getRequestClient().fetch.call(void 0,e,{signal:r.signal,...a}).finally((()=>{clearTimeout(i)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,n){let r;const s=n?.["retry-after-ms"];if(s){const e=parseFloat(s);Number.isNaN(e)||(r=e)}const a=n?.["retry-after"];if(a&&!r){const e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const n=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,n)}return await _t(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${me}`}}class it{constructor(e,t,n,r){nt.set(this,void 0),function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?s.call(e,n):s?s.value=n:t.set(e,n)}(this,nt,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Se("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,r]of n)e.url.searchParams.set(t,r);t.query=void 0,t.path=e.url.toString()}return await function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,nt,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(nt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class ot extends st{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await rt(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const lt=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),ct={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},ut=e=>"object"==typeof e&&null!==e&&!xt(e)&&Object.keys(e).every((e=>kt(ct,e))),dt=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ht=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let pt;const mt=()=>pt??(pt=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":me,"X-Stainless-OS":ht(Deno.build.os),"X-Stainless-Arch":dt(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":me,"X-Stainless-OS":ht(process.platform),"X-Stainless-Arch":dt(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),ft=e=>{try{return JSON.parse(e)}catch(e){return}},gt=new RegExp("^(?:[a-z]+:)?//","i"),yt=e=>gt.test(e),_t=e=>new Promise((t=>setTimeout(t,e))),bt=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new Se(`${e} must be an integer`);if(t<0)throw new Se(`${e} must be a positive integer`);return t},vt=e=>e instanceof Error?e:new Error(e),wt=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function xt(e){if(!e)return!0;for(const t in e)return!1;return!0}function kt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Et(e,t){for(const n in t){if(!kt(t,n))continue;const r=n.toLowerCase();if(!r)continue;const s=t[n];null===s?delete e[r]:void 0!==s&&(e[r]=s)}}function Ot(e,...t){"undefined"!=typeof process&&"true"===process.env.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}const At=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));class Tt extends it{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Pt extends it{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class It{constructor(e){this._client=e}}class St extends It{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}St||(St={});class Ct extends It{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}Ct||(Ct={});class Nt extends It{constructor(){super(...arguments),this.completions=new Ct(this._client)}}!function(e){e.Completions=Ct}(Nt||(Nt={}));class Rt extends It{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}Rt||(Rt={});class jt extends It{create(e,t){return this._client.post("/files",Qe({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ut(e)?this.list({},e):this._client.getAPIList("/files",$t,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const r=new Set(["processed","error","deleted"]),s=Date.now();let a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await _t(t),a=await this.retrieve(e),Date.now()-s>n)throw new je({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}}class $t extends Tt{}!function(e){e.FileObjectsPage=$t}(jt||(jt={}));class Mt extends It{createVariation(e,t){return this._client.post("/images/variations",Qe({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Qe({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Mt||(Mt={});class Lt extends It{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Lt||(Lt={});class Bt extends It{create(e,t){return this._client.post("/audio/transcriptions",Qe({body:e,...t}))}}Bt||(Bt={});class Ut extends It{create(e,t){return this._client.post("/audio/translations",Qe({body:e,...t}))}}Ut||(Ut={});class Dt extends It{constructor(){super(...arguments),this.transcriptions=new Bt(this._client),this.translations=new Ut(this._client),this.speech=new Lt(this._client)}}!function(e){e.Transcriptions=Bt,e.Translations=Ut,e.Speech=Lt}(Dt||(Dt={}));class zt extends It{create(e,t){return this._client.post("/moderations",{body:e,...t})}}zt||(zt={});class Zt extends It{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",qt,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class qt extends Tt{}!function(e){e.ModelsPage=qt}(Zt||(Zt={}));class Ft extends It{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ut(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ht,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return ut(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Kt,{query:t,...n})}}class Ht extends Pt{}class Kt extends Pt{}!function(e){e.FineTuningJobsPage=Ht,e.FineTuningJobEventsPage=Kt}(Ft||(Ft={}));class Vt extends It{constructor(){super(...arguments),this.jobs=new Ft(this._client)}}!function(e){e.Jobs=Ft,e.FineTuningJobsPage=Ht,e.FineTuningJobEventsPage=Kt}(Vt||(Vt={}));class Gt extends It{create(e,t,n){return this._client.post(`/assistants/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e,t={},n){return ut(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,Wt,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}del(e,t,n){return this._client.delete(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}}class Wt extends Pt{}!function(e){e.AssistantFilesPage=Wt}(Gt||(Gt={}));class Jt extends It{constructor(){super(...arguments),this.files=new Gt(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}list(e={},t){return ut(e)?this.list({},e):this._client.getAPIList("/assistants",Yt,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}class Yt extends Pt{}function Xt(e){return"function"==typeof e.parse}!function(e){e.AssistantsPage=Yt,e.Files=Gt,e.AssistantFilesPage=Wt}(Jt||(Jt={}));const Qt=e=>"assistant"===e?.role,en=e=>"function"===e?.role,tn=e=>"tool"===e?.role;var nn,rn,sn,an,on,ln,cn,un,dn,hn,pn,mn,fn,gn,yn,_n,bn,vn,wn,xn,kn=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},En=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const On=10;class An{constructor(){nn.add(this),this.controller=new AbortController,rn.set(this,void 0),sn.set(this,(()=>{})),an.set(this,(()=>{})),on.set(this,void 0),ln.set(this,(()=>{})),cn.set(this,(()=>{})),un.set(this,{}),this._chatCompletions=[],this.messages=[],dn.set(this,!1),hn.set(this,!1),pn.set(this,!1),mn.set(this,!1),vn.set(this,(e=>{if(kn(this,hn,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new Ne),e instanceof Ne)return kn(this,pn,!0,"f"),this._emit("abort",e);if(e instanceof Se)return this._emit("error",e);if(e instanceof Error){const t=new Se(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Se(String(e)))})),kn(this,rn,new Promise(((e,t)=>{kn(this,sn,e,"f"),kn(this,an,t,"f")})),"f"),kn(this,on,new Promise(((e,t)=>{kn(this,ln,e,"f"),kn(this,cn,t,"f")})),"f"),En(this,rn,"f").catch((()=>{})),En(this,on,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),En(this,vn,"f"))}),0)}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(en(e)||tn(e))&&e.content)this._emit("functionCallResult",e.content);else if(Qt(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Qt(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}_connected(){this.ended||(En(this,sn,"f").call(this),this._emit("connect"))}get ended(){return En(this,dn,"f")}get errored(){return En(this,hn,"f")}get aborted(){return En(this,pn,"f")}abort(){this.controller.abort()}on(e,t){return(En(this,un,"f")[e]||(En(this,un,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=En(this,un,"f")[e];if(!n)return this;const r=n.findIndex((e=>e.listener===t));return r>=0&&n.splice(r,1),this}once(e,t){return(En(this,un,"f")[e]||(En(this,un,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{kn(this,mn,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){kn(this,mn,!0,"f"),await En(this,on,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Se("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),En(this,nn,"m",fn).call(this)}async finalMessage(){return await this.done(),En(this,nn,"m",gn).call(this)}async finalFunctionCall(){return await this.done(),En(this,nn,"m",yn).call(this)}async finalFunctionCallResult(){return await this.done(),En(this,nn,"m",_n).call(this)}async totalUsage(){return await this.done(),En(this,nn,"m",bn).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(En(this,dn,"f"))return;"end"===e&&(kn(this,dn,!0,"f"),En(this,ln,"f").call(this));const n=En(this,un,"f")[e];if(n&&(En(this,un,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return En(this,mn,"f")||n?.length||Promise.reject(e),En(this,an,"f").call(this,e),En(this,cn,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];En(this,mn,"f")||n?.length||Promise.reject(e),En(this,an,"f").call(this,e),En(this,cn,"f").call(this,e),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=En(this,nn,"m",gn).call(this);t&&this._emit("finalMessage",t);const n=En(this,nn,"m",fn).call(this);n&&this._emit("finalContent",n);const r=En(this,nn,"m",yn).call(this);r&&this._emit("finalFunctionCall",r);const s=En(this,nn,"m",_n).call(this);null!=s&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",En(this,nn,"m",bn).call(this))}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),En(this,nn,"m",wn).call(this,t);const s=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(s)}async _runChatCompletion(e,t,n){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){const r="function",{function_call:s="auto",stream:a,...i}=t,o="string"!=typeof s&&s?.name,{maxChatCompletions:l=On}=n||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,function_call:s,functions:u,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new Se("missing message in ChatCompletion response");if(!a.function_call)return;const{name:l,arguments:d}=a.function_call,h=c[l];if(!h){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:l,content:e});continue}if(o&&o!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,name:l,content:e});continue}let p;try{p=Xt(h)?await h.parse(d):d}catch(e){this._addMessage({role:r,name:l,content:e instanceof Error?e.message:String(e)});continue}const m=await h.function(p,this),f=En(this,nn,"m",xn).call(this,m);if(this._addMessage({role:r,name:l,content:f}),o)return}}async _runTools(e,t,n){const r="tool",{tool_choice:s="auto",stream:a,...i}=t,o="string"!=typeof s&&s?.function?.name,{maxChatCompletions:l=On}=n||{},c={};for(const e of t.tools)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);const u="tools"in t?t.tools.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:s,tools:u,messages:[...this.messages]},n),a=t.choices[0]?.message;if(!a)throw new Se("missing message in ChatCompletion response");if(!a.tool_calls)return;for(const e of a.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:s}=e.function,a=c[n];if(!a){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${u.map((e=>JSON.stringify(e.function.name))).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}if(o&&o!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:t,content:e});continue}let i;try{i=Xt(a)?await a.parse(s):s}catch(e){const n=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:t,content:n});continue}const l=await a.function(i,this),d=En(this,nn,"m",xn).call(this,l);if(this._addMessage({role:r,tool_call_id:t,content:d}),o)return}}}}rn=new WeakMap,sn=new WeakMap,an=new WeakMap,on=new WeakMap,ln=new WeakMap,cn=new WeakMap,un=new WeakMap,dn=new WeakMap,hn=new WeakMap,pn=new WeakMap,mn=new WeakMap,vn=new WeakMap,nn=new WeakSet,fn=function(){return En(this,nn,"m",gn).call(this).content??null},gn=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Qt(t))return{...t,content:t.content??null}}throw new Se("stream ended without producing a ChatCompletionMessage with role=assistant")},yn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Qt(t)&&t?.function_call)return t.function_call;if(Qt(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},_n=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(en(t)&&null!=t.content)return t.content;if(tn(t)&&null!=t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},bn=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},wn=function(e){if(null!=e.n&&e.n>1)throw new Se("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},xn=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Tn extends An{static runFunctions(e,t,n){const r=new Tn,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,s))),r}static runTools(e,t,n){const r=new Tn,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,s))),r}_addMessage(e){super._addMessage(e),Qt(e)&&e.content&&this._emit("content",e.content)}}var Pn,In,Sn,Cn,Nn,Rn,jn,$n=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Mn=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};class Ln extends An{constructor(){super(...arguments),Pn.add(this),In.set(this,void 0)}get currentChatCompletionSnapshot(){return $n(this,In,"f")}static fromReadableStream(e){const t=new Ln;return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const r=new Ln;return r._run((()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createChatCompletion(e,t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),$n(this,Pn,"m",Sn).call(this);const s=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const e of s)$n(this,Pn,"m",Cn).call(this,e);if(s.controller.signal?.aborted)throw new Ne;return this._addChatCompletion($n(this,Pn,"m",Nn).call(this))}async _fromReadableStream(e,t){const n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),$n(this,Pn,"m",Sn).call(this),this._connected();const r=qe.fromReadableStream(e,this.controller);let s;for await(const e of r)s&&s!==e.id&&this._addChatCompletion($n(this,Pn,"m",Nn).call(this)),$n(this,Pn,"m",Cn).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new Ne;return this._addChatCompletion($n(this,Pn,"m",Nn).call(this))}[(In=new WeakMap,Pn=new WeakSet,Sn=function(){this.ended||Mn(this,In,void 0,"f")},Cn=function(e){if(this.ended)return;const t=$n(this,Pn,"m",Rn).call(this,e);this._emit("chunk",e,t);const n=e.choices[0]?.delta?.content,r=t.choices[0]?.message;null!=n&&"assistant"===r?.role&&r?.content&&this._emit("content",n,r.content)},Nn=function(){if(this.ended)throw new Se("stream has ended, this shouldn't happen");const e=$n(this,In,"f");if(!e)throw new Se("request ended without sending any chunks");return Mn(this,In,void 0,"f"),function(e){const{id:t,choices:n,created:r,model:s,system_fingerprint:a,...i}=e;return{...i,id:t,choices:n.map((({message:t,finish_reason:n,index:r,logprobs:s,...a})=>{if(!n)throw new Se(`missing finish_reason for choice ${r}`);const{content:i=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new Se(`missing role for choice ${r}`);if(o){const{arguments:e,name:t}=o;if(null==e)throw new Se(`missing function_call.arguments for choice ${r}`);if(!t)throw new Se(`missing function_call.name for choice ${r}`);return{...a,message:{content:i,function_call:{arguments:e,name:t},role:u},finish_reason:n,index:r,logprobs:s}}return l?{...a,index:r,finish_reason:n,logprobs:s,message:{...c,role:u,content:i,tool_calls:l.map(((t,n)=>{const{function:s,type:a,id:i,...o}=t,{arguments:l,name:c,...u}=s||{};if(null==i)throw new Se(`missing choices[${r}].tool_calls[${n}].id\n${Bn(e)}`);if(null==a)throw new Se(`missing choices[${r}].tool_calls[${n}].type\n${Bn(e)}`);if(null==c)throw new Se(`missing choices[${r}].tool_calls[${n}].function.name\n${Bn(e)}`);if(null==l)throw new Se(`missing choices[${r}].tool_calls[${n}].function.arguments\n${Bn(e)}`);return{...o,id:i,type:a,function:{...u,name:c,arguments:l}}}))}}:{...a,message:{...c,content:i,role:u},finish_reason:n,index:r,logprobs:s}})),created:r,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}}}(e)},Rn=function(e){var t,n,r;let s=$n(this,In,"f");const{choices:a,...i}=e;s?Object.assign(s,i):s=Mn(this,In,{...i,choices:[]},"f");for(const{delta:a,finish_reason:i,index:o,logprobs:l=null,...c}of e.choices){let e=s.choices[o];if(e||(e=s.choices[o]={finish_reason:i,index:o,message:{},logprobs:l,...c}),l)if(e.logprobs){const{content:n,...r}=l;Object.assign(e.logprobs,r),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n))}else e.logprobs=Object.assign({},l);if(i&&(e.finish_reason=i),Object.assign(e,c),!a)continue;const{content:u,function_call:d,role:h,tool_calls:p,...m}=a;if(Object.assign(e.message,m),u&&(e.message.content=(e.message.content||"")+u),h&&(e.message.role=h),d&&(e.message.function_call?(d.name&&(e.message.function_call.name=d.name),d.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=d.arguments)):e.message.function_call=d),p){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:s,function:a,...i}of p){const o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,i),n&&(o.id=n),s&&(o.type=s),a&&(o.function??(o.function={arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments)}}}return s},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const r=t.shift();r?r(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e(void 0);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((e=>t.push(e))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}))}}toReadableStream(){return new qe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Bn(e){return JSON.stringify(e)}class Un extends Ln{static fromReadableStream(e){const t=new Un;return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const r=new Un,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run((()=>r._runFunctions(e,t,s))),r}static runTools(e,t,n){const r=new Un,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run((()=>r._runTools(e,t,s))),r}}class Dn extends It{runFunctions(e,t){return e.stream?Un.runFunctions(this._client.chat.completions,e,t):Tn.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?Un.runTools(this._client.chat.completions,e,t):Tn.runTools(this._client.chat.completions,e,t)}stream(e,t){return Ln.createChatCompletion(this._client.chat.completions,e,t)}}class zn extends It{constructor(){super(...arguments),this.completions=new Dn(this._client)}}!function(e){e.Completions=Dn}(zn||(zn={}));class Zn extends It{retrieve(e,t,n,r){return this._client.get(`/threads/${e}/messages/${t}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t,n={},r){return ut(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,qn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class qn extends Pt{}!function(e){e.MessageFilesPage=qn}(Zn||(Zn={}));class Fn extends It{constructor(){super(...arguments),this.files=new Zn(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t={},n){return ut(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Hn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}}class Hn extends Pt{}!function(e){e.ThreadMessagesPage=Hn,e.Files=Zn,e.MessageFilesPage=qn}(Fn||(Fn={}));class Kn extends It{retrieve(e,t,n,r){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t,n={},r){return ut(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Vn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class Vn extends Pt{}!function(e){e.RunStepsPage=Vn}(Kn||(Kn={}));class Gn extends It{constructor(){super(...arguments),this.steps=new Kn(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}list(e,t={},n){return ut(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Wn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v1",...r?.headers}})}}class Wn extends Pt{}!function(e){e.RunsPage=Wn,e.Steps=Kn,e.RunStepsPage=Vn}(Gn||(Gn={}));class Jn extends It{constructor(){super(...arguments),this.runs=new Gn(this._client),this.messages=new Fn(this._client)}create(e={},t){return ut(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t?.headers}})}}!function(e){e.Runs=Gn,e.RunsPage=Wn,e.Messages=Fn,e.ThreadMessagesPage=Hn}(Jn||(Jn={}));class Yn extends It{constructor(){super(...arguments),this.chat=new zn(this._client),this.assistants=new Jt(this._client),this.threads=new Jn(this._client)}}!function(e){e.Chat=zn,e.Assistants=Jt,e.AssistantsPage=Yt,e.Threads=Jn}(Yn||(Yn={}));class Xn extends at{constructor({baseURL:e=wt("OPENAI_BASE_URL"),apiKey:t=wt("OPENAI_API_KEY"),organization:n=wt("OPENAI_ORG_ID")??null,...r}={}){if(void 0===t)throw new Se("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const s={apiKey:t,organization:n,...r,baseURL:e||"https://api.openai.com/v1"};if(!s.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new Se("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:s.baseURL,timeout:s.timeout??6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new St(this),this.chat=new Nt(this),this.embeddings=new Rt(this),this.files=new jt(this),this.images=new Mt(this),this.audio=new Dt(this),this.moderations=new zt(this),this.models=new Zt(this),this.fineTuning=new Vt(this),this.beta=new Yn(this),this._options=s,this.apiKey=t,this.organization=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}jn=Xn,Xn.OpenAI=jn,Xn.OpenAIError=Se,Xn.APIError=Ce,Xn.APIConnectionError=Re,Xn.APIConnectionTimeoutError=je,Xn.APIUserAbortError=Ne,Xn.NotFoundError=Be,Xn.ConflictError=Ue,Xn.RateLimitError=ze,Xn.BadRequestError=$e,Xn.AuthenticationError=Me,Xn.InternalServerError=Ze,Xn.PermissionDeniedError=Le,Xn.UnprocessableEntityError=De;const{OpenAIError:Qn,APIError:er,APIConnectionError:tr,APIConnectionTimeoutError:nr,APIUserAbortError:rr,NotFoundError:sr,ConflictError:ar,RateLimitError:ir,BadRequestError:or,AuthenticationError:lr,InternalServerError:cr,PermissionDeniedError:ur,UnprocessableEntityError:dr}=c;var hr;(hr=Xn||(Xn={})).toFile=We,hr.fileFromPath=xe,hr.Page=Tt,hr.CursorPage=Pt,hr.Completions=St,hr.Chat=Nt,hr.Embeddings=Rt,hr.Files=jt,hr.FileObjectsPage=$t,hr.Images=Mt,hr.Audio=Dt,hr.Moderations=zt,hr.Models=Zt,hr.ModelsPage=qt,hr.FineTuning=Vt,hr.Beta=Yn;const pr={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",mapStrategy:"entries",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email"};var mr,fr;!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(mr||(mr={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(fr||(fr={}));const gr=mr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),yr=e=>{switch(typeof e){case"undefined":return gr.undefined;case"string":return gr.string;case"number":return isNaN(e)?gr.nan:gr.number;case"boolean":return gr.boolean;case"function":return gr.function;case"bigint":return gr.bigint;case"symbol":return gr.symbol;case"object":return Array.isArray(e)?gr.array:null===e?gr.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?gr.promise:"undefined"!=typeof Map&&e instanceof Map?gr.map:"undefined"!=typeof Set&&e instanceof Set?gr.set:"undefined"!=typeof Date&&e instanceof Date?gr.date:gr.object;default:return gr.unknown}},_r=mr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class br extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(r);else if("invalid_return_type"===s.code)r(s.returnTypeError);else if("invalid_arguments"===s.code)r(s.argumentsError);else if(0===s.path.length)n._errors.push(t(s));else{let e=n,r=0;for(;r<s.path.length;){const n=s.path[r];r===s.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(s))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,mr.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}br.create=e=>new br(e);const vr=(e,t)=>{let n;switch(e.code){case _r.invalid_type:n=e.received===gr.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case _r.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,mr.jsonStringifyReplacer)}`;break;case _r.unrecognized_keys:n=`Unrecognized key(s) in object: ${mr.joinValues(e.keys,", ")}`;break;case _r.invalid_union:n="Invalid input";break;case _r.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${mr.joinValues(e.options)}`;break;case _r.invalid_enum_value:n=`Invalid enum value. Expected ${mr.joinValues(e.options)}, received '${e.received}'`;break;case _r.invalid_arguments:n="Invalid function arguments";break;case _r.invalid_return_type:n="Invalid function return type";break;case _r.invalid_date:n="Invalid date";break;case _r.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:mr.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case _r.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case _r.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case _r.custom:n="Invalid input";break;case _r.invalid_intersection_types:n="Intersection results could not be merged";break;case _r.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case _r.not_finite:n="Number must be finite";break;default:n=t.defaultError,mr.assertNever(e)}return{message:n}};let wr=vr;function xr(e,t){const n=(e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,a=[...n,...s.path||[]],i={...s,path:a};let o="";const l=r.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(i,{data:t,defaultError:o}).message;return{...s,path:a,message:s.message||o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,wr,vr].filter((e=>!!e))});e.common.issues.push(n)}class kr{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return Er;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t)n.push({key:await e.key,value:await e.value});return kr.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:s}=r;if("aborted"===t.status)return Er;if("aborted"===s.status)return Er;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"===t.value||void 0===s.value&&!r.alwaysSet||(n[t.value]=s.value)}return{status:e.value,value:n}}}const Er=Object.freeze({status:"aborted"}),Or=e=>({status:"valid",value:e}),Ar=e=>"aborted"===e.status,Tr=e=>"dirty"===e.status,Pr=e=>"valid"===e.status,Ir=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Sr;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Sr||(Sr={}));class Cr{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Nr=(e,t)=>{if(Pr(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new br(e.common.issues);return this._error=t,this._error}}};function Rr(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=r?r:t.defaultError}:{message:null!=n?n:t.defaultError},description:s}}class jr{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return yr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:yr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new kr,ctx:{common:e.parent.common,data:e.data,parsedType:yr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ir(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yr(e)},s=this._parseSync({data:e,path:r.path,parent:r});return Nr(r,s)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:yr(e)},r=this._parse({data:e,path:n.path,parent:n}),s=await(Ir(r)?r:Promise.resolve(r));return Nr(n,s)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const s=e(t),a=()=>r.addIssue({code:_r.custom,...n(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then((e=>!!e||(a(),!1))):!!s||(a(),!1)}))}refinement(e,t){return this._refinement(((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1)))}_refinement(e){return new ys({schema:this,typeName:As.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return _s.create(this,this._def)}nullable(){return bs.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ns.create(this,this._def)}promise(){return gs.create(this,this._def)}or(e){return as.create([this,e],this._def)}and(e){return os.create(this,e,this._def)}transform(e){return new ys({...Rr(this._def),schema:this,typeName:As.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new vs({...Rr(this._def),innerType:this,defaultValue:t,typeName:As.ZodDefault})}brand(){return new ks({typeName:As.ZodBranded,type:this,...Rr(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new ws({...Rr(this._def),innerType:this,catchValue:t,typeName:As.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Es.create(this,e)}readonly(){return Os.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const $r=/^c[^\s-]{8,}$/i,Mr=/^[a-z][a-z0-9]*$/,Lr=/^[0-9A-HJKMNP-TV-Z]{26}$/,Br=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ur=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Dr;const zr=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Zr=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class qr extends jr{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==gr.string){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.string,received:t.parsedType}),Er}const t=new kr;let n;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const r=e.data.length>i.value,s=e.data.length<i.value;(r||s)&&(n=this._getOrReturnCtx(e,n),r?xr(n,{code:_r.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):s&&xr(n,{code:_r.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)Ur.test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{validation:"email",code:_r.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)Dr||(Dr=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Dr.test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{validation:"emoji",code:_r.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)Br.test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{validation:"uuid",code:_r.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)$r.test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{validation:"cuid",code:_r.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)Mr.test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{validation:"cuid2",code:_r.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)Lr.test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{validation:"ulid",code:_r.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(r){n=this._getOrReturnCtx(e,n),xr(n,{validation:"url",code:_r.invalid_string,message:i.message}),t.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{validation:"regex",code:_r.invalid_string,message:i.message}),t.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty()):"datetime"===i.kind?((a=i).precision?a.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${a.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${a.precision}}Z$`):0===a.precision?a.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):a.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.invalid_string,validation:"datetime",message:i.message}),t.dirty()):"ip"===i.kind?(r=e.data,("v4"!==(s=i.version)&&s||!zr.test(r))&&("v6"!==s&&s||!Zr.test(r))&&(n=this._getOrReturnCtx(e,n),xr(n,{validation:"ip",code:_r.invalid_string,message:i.message}),t.dirty())):mr.assertNever(i);var r,s,a;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),{validation:t,code:_r.invalid_string,...Sr.errToObj(n)})}_addCheck(e){return new qr({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Sr.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Sr.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Sr.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Sr.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Sr.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Sr.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Sr.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Sr.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...Sr.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Sr.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Sr.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Sr.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Sr.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Sr.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Sr.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Sr.errToObj(t)})}nonempty(e){return this.min(1,Sr.errToObj(e))}trim(){return new qr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new qr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new qr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Fr(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r;return parseInt(e.toFixed(s).replace(".",""))%parseInt(t.toFixed(s).replace(".",""))/Math.pow(10,s)}qr.create=e=>{var t;return new qr({checks:[],typeName:As.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Rr(e)})};class Hr extends jr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==gr.number){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.number,received:t.parsedType}),Er}let t;const n=new kr;for(const r of this._def.checks)"int"===r.kind?mr.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==Fr(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.not_finite,message:r.message}),n.dirty()):mr.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Sr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Sr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Sr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Sr.toString(t))}setLimit(e,t,n,r){return new Hr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Sr.toString(r)}]})}_addCheck(e){return new Hr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Sr.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Sr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Sr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Sr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Sr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Sr.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Sr.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Sr.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Sr.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&mr.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Hr.create=e=>new Hr({checks:[],typeName:As.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Rr(e)});class Kr extends jr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==gr.bigint){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.bigint,received:t.parsedType}),Er}let t;const n=new kr;for(const r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),xr(t,{code:_r.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):mr.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Sr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Sr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Sr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Sr.toString(t))}setLimit(e,t,n,r){return new Kr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Sr.toString(r)}]})}_addCheck(e){return new Kr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Sr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Sr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Sr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Sr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Sr.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Kr.create=e=>{var t;return new Kr({checks:[],typeName:As.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Rr(e)})};class Vr extends jr{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==gr.boolean){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.boolean,received:t.parsedType}),Er}return Or(e.data)}}Vr.create=e=>new Vr({typeName:As.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Rr(e)});class Gr extends jr{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==gr.date){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.date,received:t.parsedType}),Er}if(isNaN(e.data.getTime()))return xr(this._getOrReturnCtx(e),{code:_r.invalid_date}),Er;const t=new kr;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),xr(n,{code:_r.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):mr.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Gr({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Sr.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Sr.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Gr.create=e=>new Gr({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:As.ZodDate,...Rr(e)});class Wr extends jr{_parse(e){if(this._getType(e)!==gr.symbol){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.symbol,received:t.parsedType}),Er}return Or(e.data)}}Wr.create=e=>new Wr({typeName:As.ZodSymbol,...Rr(e)});class Jr extends jr{_parse(e){if(this._getType(e)!==gr.undefined){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.undefined,received:t.parsedType}),Er}return Or(e.data)}}Jr.create=e=>new Jr({typeName:As.ZodUndefined,...Rr(e)});class Yr extends jr{_parse(e){if(this._getType(e)!==gr.null){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.null,received:t.parsedType}),Er}return Or(e.data)}}Yr.create=e=>new Yr({typeName:As.ZodNull,...Rr(e)});class Xr extends jr{constructor(){super(...arguments),this._any=!0}_parse(e){return Or(e.data)}}Xr.create=e=>new Xr({typeName:As.ZodAny,...Rr(e)});class Qr extends jr{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Or(e.data)}}Qr.create=e=>new Qr({typeName:As.ZodUnknown,...Rr(e)});class es extends jr{_parse(e){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.never,received:t.parsedType}),Er}}es.create=e=>new es({typeName:As.ZodNever,...Rr(e)});class ts extends jr{_parse(e){if(this._getType(e)!==gr.undefined){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.void,received:t.parsedType}),Er}return Or(e.data)}}ts.create=e=>new ts({typeName:As.ZodVoid,...Rr(e)});class ns extends jr{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==gr.array)return xr(t,{code:_r.invalid_type,expected:gr.array,received:t.parsedType}),Er;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,s=t.data.length<r.exactLength.value;(e||s)&&(xr(t,{code:e?_r.too_big:_r.too_small,minimum:s?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(xr(t,{code:_r.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(xr(t,{code:_r.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>r.type._parseAsync(new Cr(t,e,t.path,n))))).then((e=>kr.mergeArray(n,e)));const s=[...t.data].map(((e,n)=>r.type._parseSync(new Cr(t,e,t.path,n))));return kr.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new ns({...this._def,minLength:{value:e,message:Sr.toString(t)}})}max(e,t){return new ns({...this._def,maxLength:{value:e,message:Sr.toString(t)}})}length(e,t){return new ns({...this._def,exactLength:{value:e,message:Sr.toString(t)}})}nonempty(e){return this.min(1,e)}}function rs(e){if(e instanceof ss){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=_s.create(rs(r))}return new ss({...e._def,shape:()=>t})}return e instanceof ns?new ns({...e._def,type:rs(e.element)}):e instanceof _s?_s.create(rs(e.unwrap())):e instanceof bs?bs.create(rs(e.unwrap())):e instanceof ls?ls.create(e.items.map((e=>rs(e)))):e}ns.create=(e,t)=>new ns({type:e,minLength:null,maxLength:null,exactLength:null,typeName:As.ZodArray,...Rr(t)});class ss extends jr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=mr.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==gr.object){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.object,received:t.parsedType}),Er}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof es&&"strip"===this._def.unknownKeys))for(const e in n.data)s.includes(e)||a.push(e);const i=[];for(const e of s){const t=r[e],s=n.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new Cr(n,s,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof es){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of a)i.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)a.length>0&&(xr(n,{code:_r.unrecognized_keys,keys:a}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of a){const r=n.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new Cr(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of i){const n=await t.key;e.push({key:n,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>kr.mergeObjectSync(t,e))):kr.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Sr.errToObj,new ss({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{var r,s,a,i;const o=null!==(a=null===(s=(r=this._def).errorMap)||void 0===s?void 0:s.call(r,t,n).message)&&void 0!==a?a:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=Sr.errToObj(e).message)&&void 0!==i?i:o}:{message:o}}}:{}})}strip(){return new ss({...this._def,unknownKeys:"strip"})}passthrough(){return new ss({...this._def,unknownKeys:"passthrough"})}extend(e){return new ss({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ss({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:As.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ss({...this._def,catchall:e})}pick(e){const t={};return mr.objectKeys(e).forEach((n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])})),new ss({...this._def,shape:()=>t})}omit(e){const t={};return mr.objectKeys(this.shape).forEach((n=>{e[n]||(t[n]=this.shape[n])})),new ss({...this._def,shape:()=>t})}deepPartial(){return rs(this)}partial(e){const t={};return mr.objectKeys(this.shape).forEach((n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()})),new ss({...this._def,shape:()=>t})}required(e){const t={};return mr.objectKeys(this.shape).forEach((n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof _s;)e=e._def.innerType;t[n]=e}})),new ss({...this._def,shape:()=>t})}keyof(){return ps(mr.objectKeys(this.shape))}}ss.create=(e,t)=>new ss({shape:()=>e,unknownKeys:"strip",catchall:es.create(),typeName:As.ZodObject,...Rr(t)}),ss.strictCreate=(e,t)=>new ss({shape:()=>e,unknownKeys:"strict",catchall:es.create(),typeName:As.ZodObject,...Rr(t)}),ss.lazycreate=(e,t)=>new ss({shape:e,unknownKeys:"strip",catchall:es.create(),typeName:As.ZodObject,...Rr(t)});class as extends jr{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new br(e.ctx.common.issues)));return xr(t,{code:_r.invalid_union,unionErrors:n}),Er}));{let e;const r=[];for(const s of n){const n={...t,common:{...t.common,issues:[]},parent:null},a=s._parseSync({data:t.data,path:t.path,parent:n});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const s=r.map((e=>new br(e)));return xr(t,{code:_r.invalid_union,unionErrors:s}),Er}}get options(){return this._def.options}}function is(e,t){const n=yr(e),r=yr(t);if(e===t)return{valid:!0,data:e};if(n===gr.object&&r===gr.object){const n=mr.objectKeys(t),r=mr.objectKeys(e).filter((e=>-1!==n.indexOf(e))),s={...e,...t};for(const n of r){const r=is(e[n],t[n]);if(!r.valid)return{valid:!1};s[n]=r.data}return{valid:!0,data:s}}if(n===gr.array&&r===gr.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const s=is(e[r],t[r]);if(!s.valid)return{valid:!1};n.push(s.data)}return{valid:!0,data:n}}return n===gr.date&&r===gr.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}as.create=(e,t)=>new as({options:e,typeName:As.ZodUnion,...Rr(t)});class os extends jr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(Ar(e)||Ar(r))return Er;const s=is(e.value,r.value);return s.valid?((Tr(e)||Tr(r))&&t.dirty(),{status:t.value,value:s.data}):(xr(n,{code:_r.invalid_intersection_types}),Er)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}os.create=(e,t,n)=>new os({left:e,right:t,typeName:As.ZodIntersection,...Rr(n)});class ls extends jr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==gr.array)return xr(n,{code:_r.invalid_type,expected:gr.array,received:n.parsedType}),Er;if(n.data.length<this._def.items.length)return xr(n,{code:_r.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Er;!this._def.rest&&n.data.length>this._def.items.length&&(xr(n,{code:_r.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new Cr(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(r).then((e=>kr.mergeArray(t,e))):kr.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new ls({...this._def,rest:e})}}ls.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ls({items:e,typeName:As.ZodTuple,rest:null,...Rr(t)})};class cs extends jr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==gr.map)return xr(n,{code:_r.invalid_type,expected:gr.map,received:n.parsedType}),Er;const r=this._def.keyType,s=this._def.valueType,a=[...n.data.entries()].map((([e,t],a)=>({key:r._parse(new Cr(n,e,n.path,[a,"key"])),value:s._parse(new Cr(n,t,n.path,[a,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const n of a){const r=await n.key,s=await n.value;if("aborted"===r.status||"aborted"===s.status)return Er;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of a){const r=n.key,s=n.value;if("aborted"===r.status||"aborted"===s.status)return Er;"dirty"!==r.status&&"dirty"!==s.status||t.dirty(),e.set(r.value,s.value)}return{status:t.value,value:e}}}}cs.create=(e,t,n)=>new cs({valueType:t,keyType:e,typeName:As.ZodMap,...Rr(n)});class us extends jr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==gr.set)return xr(n,{code:_r.invalid_type,expected:gr.set,received:n.parsedType}),Er;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(xr(n,{code:_r.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(xr(n,{code:_r.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const s=this._def.valueType;function a(e){const n=new Set;for(const r of e){if("aborted"===r.status)return Er;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const i=[...n.data.values()].map(((e,t)=>s._parse(new Cr(n,e,n.path,t))));return n.common.async?Promise.all(i).then((e=>a(e))):a(i)}min(e,t){return new us({...this._def,minSize:{value:e,message:Sr.toString(t)}})}max(e,t){return new us({...this._def,maxSize:{value:e,message:Sr.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}us.create=(e,t)=>new us({valueType:e,minSize:null,maxSize:null,typeName:As.ZodSet,...Rr(t)});class ds extends jr{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ds.create=(e,t)=>new ds({getter:e,typeName:As.ZodLazy,...Rr(t)});class hs extends jr{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return xr(t,{received:t.data,code:_r.invalid_literal,expected:this._def.value}),Er}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ps(e,t){return new ms({values:e,typeName:As.ZodEnum,...Rr(t)})}hs.create=(e,t)=>new hs({value:e,typeName:As.ZodLiteral,...Rr(t)});class ms extends jr{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return xr(t,{expected:mr.joinValues(n),received:t.parsedType,code:_r.invalid_type}),Er}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return xr(t,{received:t.data,code:_r.invalid_enum_value,options:n}),Er}return Or(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return ms.create(e)}exclude(e){return ms.create(this.options.filter((t=>!e.includes(t))))}}ms.create=ps;class fs extends jr{_parse(e){const t=mr.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==gr.string&&n.parsedType!==gr.number){const e=mr.objectValues(t);return xr(n,{expected:mr.joinValues(e),received:n.parsedType,code:_r.invalid_type}),Er}if(-1===t.indexOf(e.data)){const e=mr.objectValues(t);return xr(n,{received:n.data,code:_r.invalid_enum_value,options:e}),Er}return Or(e.data)}get enum(){return this._def.values}}fs.create=(e,t)=>new fs({values:e,typeName:As.ZodNativeEnum,...Rr(t)});class gs extends jr{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==gr.promise&&!1===t.common.async)return xr(t,{code:_r.invalid_type,expected:gr.promise,received:t.parsedType}),Er;const n=t.parsedType===gr.promise?t.data:Promise.resolve(t.data);return Or(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}gs.create=(e,t)=>new gs({type:e,typeName:As.ZodPromise,...Rr(t)});class ys extends jr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===As.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,s={addIssue:e=>{xr(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===r.type){const e=r.transform(n.data,s);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:n.path,parent:n}))):this._def.schema._parseSync({data:e,path:n.path,parent:n})}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,s);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Er:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?Er:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Pr(e))return e;const a=r.transform(e.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>Pr(e)?Promise.resolve(r.transform(e.value,s)).then((e=>({status:t.value,value:e}))):e))}mr.assertNever(r)}}ys.create=(e,t,n)=>new ys({schema:e,typeName:As.ZodEffects,effect:t,...Rr(n)}),ys.createWithPreprocess=(e,t,n)=>new ys({schema:t,effect:{type:"preprocess",transform:e},typeName:As.ZodEffects,...Rr(n)});class _s extends jr{_parse(e){return this._getType(e)===gr.undefined?Or(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}_s.create=(e,t)=>new _s({innerType:e,typeName:As.ZodOptional,...Rr(t)});class bs extends jr{_parse(e){return this._getType(e)===gr.null?Or(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}bs.create=(e,t)=>new bs({innerType:e,typeName:As.ZodNullable,...Rr(t)});class vs extends jr{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===gr.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}vs.create=(e,t)=>new vs({innerType:e,typeName:As.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Rr(t)});class ws extends jr{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Ir(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new br(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new br(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ws.create=(e,t)=>new ws({innerType:e,typeName:As.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Rr(t)});class xs extends jr{_parse(e){if(this._getType(e)!==gr.nan){const t=this._getOrReturnCtx(e);return xr(t,{code:_r.invalid_type,expected:gr.nan,received:t.parsedType}),Er}return{status:"valid",value:e.data}}}xs.create=e=>new xs({typeName:As.ZodNaN,...Rr(e)}),Symbol("zod_brand");class ks extends jr{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Es extends jr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Er:"dirty"===e.status?(t.dirty(),(e=>({status:"dirty",value:e}))(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Er:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Es({in:e,out:t,typeName:As.ZodPipeline})}}class Os extends jr{_parse(e){const t=this._def.innerType._parse(e);return Pr(t)&&(t.value=Object.freeze(t.value)),t}}var As;function Ts(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ps(e,t,n,r,s){e[t]=n,Ts(e,t,r,s)}Os.create=(e,t)=>new Os({innerType:e,typeName:As.ZodReadonly,...Rr(t)}),ss.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(As||(As={})),qr.create,Hr.create,xs.create,Kr.create,Vr.create,Gr.create,Wr.create,Jr.create,Yr.create,Xr.create,Qr.create,es.create,ts.create,ns.create,ss.create,ss.strictCreate,as.create,os.create,ls.create,cs.create,us.create,ds.create,hs.create,ms.create,fs.create,gs.create,ys.create,_s.create,bs.create,ys.createWithPreprocess,Es.create;const Is={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$"};function Ss(e,t){const n={type:"string"};function r(e){return"escape"===t.patternStrategy?Cs(e):e}if(e.checks)for(const s of e.checks)switch(s.kind){case"min":Ps(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,s.value):s.value,s.message,t);break;case"max":Ps(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,s.value):s.value,s.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Ns(n,"email",s.message,t);break;case"format:idn-email":Ns(n,"idn-email",s.message,t);break;case"pattern:zod":Rs(n,Is.email,s.message,t)}break;case"url":Ns(n,"uri",s.message,t);break;case"uuid":Ns(n,"uuid",s.message,t);break;case"regex":Rs(n,s.regex.source,s.message,t);break;case"cuid":Rs(n,Is.cuid,s.message,t);break;case"cuid2":Rs(n,Is.cuid2,s.message,t);break;case"startsWith":Rs(n,"^"+r(s.value),s.message,t);break;case"endsWith":Rs(n,r(s.value)+"$",s.message,t);break;case"datetime":Ns(n,"date-time",s.message,t);break;case"length":Ps(n,"minLength","number"==typeof n.minLength?Math.max(n.minLength,s.value):s.value,s.message,t),Ps(n,"maxLength","number"==typeof n.maxLength?Math.min(n.maxLength,s.value):s.value,s.message,t);break;case"includes":Rs(n,r(s.value),s.message,t);break;case"ip":"v6"!==s.version&&Ns(n,"ipv4",s.message,t),"v4"!==s.version&&Ns(n,"ipv6",s.message,t);break;case"emoji":Rs(n,Is.emoji,s.message,t);break;case"ulid":Rs(n,Is.ulid,s.message,t)}return n}const Cs=e=>Array.from(e).map((e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`)).join(""),Ns=(e,t,n,r)=>{e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ps(e,"format",t,n,r)},Rs=(e,t,n,r)=>{e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:t,...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ps(e,"pattern",t,n,r)};function js(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===As.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((n,r)=>({...n,[r]:Ls(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",r]})??{}})),{}),additionalProperties:!1};const n={type:"object",additionalProperties:Ls(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return n;if(e.keyType?._def.typeName===As.ZodString&&e.keyType._def.checks?.length){const r=Object.entries(Ss(e.keyType._def,t)).reduce(((e,[t,n])=>"type"===t?e:{...e,[t]:n}),{});return{...n,propertyNames:r}}return e.keyType?._def.typeName===As.ZodEnum?{...n,propertyNames:{enum:e.keyType._def.values}}:n}const $s={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},Ms=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,n)=>Ls(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return n.length?{anyOf:n}:void 0};function Ls(e,t,n=!1){const r=t.seen.get(e);if(r&&!n){const e=Bs(r,t);if(void 0!==e)return e}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const a=Ds(e,e.typeName,t);return a&&zs(e,t,a),s.jsonSchema=a,a}const Bs=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Us(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,n)=>t.currentPath[n]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},Us=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},Ds=(e,t,n)=>{switch(t){case As.ZodString:return Ss(e,n);case As.ZodNumber:return function(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Ts(n,"type",r.message,t);break;case"min":"jsonSchema7"===t.target?r.inclusive?Ps(n,"minimum",r.value,r.message,t):Ps(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ps(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?Ps(n,"maximum",r.value,r.message,t):Ps(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ps(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ps(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case As.ZodObject:return function(e,t){const n={type:"object",...Object.entries(e.shape()).reduce(((e,[n,r])=>{if(void 0===r||void 0===r._def)return e;const s=Ls(r._def,{...t,currentPath:[...t.currentPath,"properties",n],propertyPath:[...t.currentPath,"properties",n]});return void 0===s?e:{properties:{...e.properties,[n]:s},required:r.isOptional()?e.required:[...e.required,n]}}),{properties:{},required:[]}),additionalProperties:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:Ls(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return n.required.length||delete n.required,n}(e,n);case As.ZodBigInt:return function(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target?r.inclusive?Ps(n,"minimum",r.value,r.message,t):Ps(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ps(n,"minimum",r.value,r.message,t));break;case"max":"jsonSchema7"===t.target?r.inclusive?Ps(n,"maximum",r.value,r.message,t):Ps(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ps(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ps(n,"multipleOf",r.value,r.message,t)}return n}(e,n);case As.ZodBoolean:return{type:"boolean"};case As.ZodDate:return function(e,t){return"integer"==t.dateStrategy?((e,t)=>{const n={type:"integer",format:"unix-time"};for(const r of e.checks)switch(r.kind){case"min":"jsonSchema7"===t.target&&Ps(n,"minimum",r.value,r.message,t);break;case"max":"jsonSchema7"===t.target&&Ps(n,"maximum",r.value,r.message,t)}return n})(e,t):{type:"string",format:"date-time"}}(e,n);case As.ZodUndefined:return{not:{}};case As.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(n);case As.ZodArray:return function(e,t){const n={type:"array"};return e.type?._def?.typeName!==As.ZodAny&&(n.items=Ls(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ps(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ps(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ps(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ps(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}(e,n);case As.ZodUnion:case As.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return Ms(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every((e=>e._def.typeName in $s&&(!e._def.checks||!e._def.checks.length)))){const e=n.reduce(((e,t)=>{const n=$s[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e}),[]);return{type:e.length>1?e:e[0]}}if(n.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=n.reduce(((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===n.length){const t=e.filter(((e,t,n)=>n.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:n.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(n.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:n.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return Ms(e,t)}(e,n);case As.ZodIntersection:return function(e,t){const n=[Ls(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Ls(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let r="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach((e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...r}=e;t=r}else r=void 0;s.push(t)}else s.push(...e.allOf),void 0===e.unevaluatedProperties&&(r=void 0);var t})),s.length?{allOf:s,...r}:void 0}(e,n);case As.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,n)=>Ls(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:Ls(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,n)=>Ls(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,n);case As.ZodRecord:return js(e,n);case As.ZodLiteral:return function(e,t){const n=typeof e.value;return"bigint"!==n&&"number"!==n&&"boolean"!==n&&"string"!==n?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===n?"integer":n,enum:[e.value]}:{type:"bigint"===n?"integer":n,const:e.value}}(e,n);case As.ZodEnum:return function(e){return{type:"string",enum:e.values}}(e);case As.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])),r=n.map((e=>t[e])),s=Array.from(new Set(r.map((e=>typeof e))));return{type:1===s.length?"string"===s[0]?"string":"number":["string","number"],enum:r}}(e);case As.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:$s[e.innerType._def.typeName],nullable:!0}:{type:[$s[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const n=Ls(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const n=Ls(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case As.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return Ls(e.innerType._def,t);const n=Ls(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}})(e,n);case As.ZodMap:return function(e,t){return"record"===t.mapStrategy?js(e,t):{type:"array",maxItems:125,items:{type:"array",items:[Ls(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},Ls(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,n);case As.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:Ls(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ps(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ps(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}(e,n);case As.ZodLazy:return Ls(e.getter()._def,n);case As.ZodPromise:return function(e,t){return Ls(e.type._def,t)}(e,n);case As.ZodNaN:case As.ZodNever:return{not:{}};case As.ZodEffects:return function(e,t){return"input"===t.effectStrategy?Ls(e.schema._def,t):{}}(e,n);case As.ZodAny:case As.ZodUnknown:return{};case As.ZodDefault:return function(e,t){return{...Ls(e.innerType._def,t),default:e.defaultValue()}}(e,n);case As.ZodBranded:return function(e,t){return Ls(e.type._def,t)}(e,n);case As.ZodReadonly:case As.ZodCatch:return((e,t)=>Ls(e.innerType._def,t))(e,n);case As.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return Ls(e.in._def,t);if("output"===t.pipeStrategy)return Ls(e.out._def,t);const n=Ls(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,Ls(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter((e=>void 0!==e))}})(e,n);case As.ZodFunction:case As.ZodVoid:case As.ZodSymbol:default:return}},zs=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),Zs=(e,t)=>{const n=(e=>{const t=(e=>"string"==typeof e?{...pr,name:e}:{...pr,...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t),r="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,r])=>({...e,[t]:Ls(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??{}})),{}):void 0,s="string"==typeof t?t:t?.name,a=Ls(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??{},i=void 0===s?r?{...a,[n.definitionPath]:r}:a:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...r,[s]:a}};return"jsonSchema7"===n.target?i.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),i};function qs(e){return{name:e.name,description:e.description,parameters:Zs(e.schema)}}function Fs(e){return{type:"function",function:qs(e)}}function Hs(e,t){const n=[];for(const[r,s]of Object.entries(e.properties??{}))s.description&&t<2&&n.push(`// ${s.description}`),e.required?.includes(r)?n.push(`${r}: ${Ks(s,t)},`):n.push(`${r}?: ${Ks(s,t)},`);return n.map((e=>" ".repeat(t)+e)).join("\n")}function Ks(e,t){if(void 0!==(n=e).anyOf&&Array.isArray(n.anyOf))return e.anyOf.map((e=>Ks(e,t))).join(" | ");var n;switch(e.type){case"string":return e.enum?e.enum.map((e=>`"${e}"`)).join(" | "):"string";case"number":case"integer":return e.enum?e.enum.map((e=>`${e}`)).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Hs(e,t+2),"}"].join("\n");case"array":return e.items?`${Ks(e.items,t)}[]`:"any[]";default:return""}}function Vs(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!$.J.isInstance(e))throw new Error("Invalid generic chat message");return function(e){return"system"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role}(e);default:throw new Error(`Unknown message type: ${t}`)}}function Gs(e,t){const n=e.role??t,r=e.content??"";let s;return s=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},"user"===n?new $.ro({content:r}):"assistant"===n?new $.GC({content:r,additional_kwargs:s}):"system"===n?new $.xq({content:r}):"function"===n?new $.Cr({content:r,additional_kwargs:s,name:e.name}):"tool"===n?new $.Xz({content:r,additional_kwargs:s,tool_call_id:e.tool_call_id}):new $.HD({content:r,role:n})}function Ws(e){return e.map((e=>({role:Vs(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id})))}class Js extends ue{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.openAIApiKey??(0,j.lS)("OPENAI_API_KEY"),this.azureOpenAIApiKey=e?.azureOpenAIApiKey??(0,j.lS)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??(0,j.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??(0,j.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??(0,j.lS)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??(0,j.lS)("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??(0,j.lS)("OPENAI_ORGANIZATION"),this.modelName=e?.modelName??this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}invocationParams(e){var t;return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stop,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:(t=e?.tools,void 0!==t&&t.every((e=>Array.isArray(e.lc_namespace)))?e?.tools.map(Fs):e?.tools),tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){const r=Ws(e),s={...this.invocationParams(t),messages:r,stream:!0};let a;const i=await this.completionWithRetry(s,t);for await(const e of i){const r=e?.choices[0];if(!r)continue;const{delta:s}=r;if(!s)continue;const i=Gs(s,a);a=s.role??a;const o={prompt:t.promptIndex??0,completion:r.index??0};if("string"!=typeof i.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const l=new B({message:i,text:i.content,generationInfo:o});yield l,n?.handleLLMNewToken(l.text??"",o,void 0,void 0,void 0,{chunk:l})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){const r={},s=this.invocationParams(t),a=Ws(e);if(s.stream){const s=this._streamResponseChunks(e,t,n),a={};for await(const e of s){const t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}const i=Object.entries(a).sort((([e],[t])=>parseInt(e,10)-parseInt(t,10))).map((([e,t])=>t)),{functions:o,function_call:l}=this.invocationParams(t),c=await this.getEstimatedTokenCountFromPrompt(e,o,l),u=await this.getNumTokensFromGenerations(i);return r.promptTokens=c,r.completionTokens=u,r.totalTokens=c+u,{generations:i,llmOutput:{estimatedTokenUsage:r}}}{const e=await this.completionWithRetry({...s,stream:!1,messages:a},{signal:t?.signal,...t?.options}),{completion_tokens:n,prompt_tokens:o,total_tokens:l}=e?.usage??{};n&&(r.completionTokens=(r.completionTokens??0)+n),o&&(r.promptTokens=(r.promptTokens??0)+o),l&&(r.totalTokens=(r.totalTokens??0)+l);const c=[];for(const t of e?.choices??[]){const e={text:t.message?.content??"",message:(i=t.message??{role:"assistant"},"assistant"===i.role?new $.gY(i.content||"",{function_call:i.function_call,tool_calls:i.tool_calls}):new $.J(i.content||"",i.role??"unknown"))};e.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},c.push(e)}return{generations:c,llmOutput:{tokenUsage:r}}}var i}async getEstimatedTokenCountFromPrompt(e,t,n){let r=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==n){const e=function(e){const t=["namespace functions {",""];for(const n of e)n.description&&t.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(t.push(`type ${n.name} = (_: {`),t.push(Hs(n.parameters,0)),t.push("}) => any;")):t.push(`type ${n.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);r+=await this.getNumTokens(e),r+=9}return t&&e.find((e=>"system"===e._getType()))&&(r-=4),"none"===n?r+=1:"object"==typeof n&&(r+=await this.getNumTokens(n.name)+4),r}async getNumTokensFromGenerations(e){return(await Promise.all(e.map((async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content))))).reduce(((e,t)=>e+t),0)}async getNumTokensFromMessages(e){let t=0,n=0,r=0;"gpt-3.5-turbo-0301"===this.modelName?(n=4,r=-1):(n=3,r=1);const s=await Promise.all(e.map((async e=>{const s=await this.getNumTokens(e.content),a=await this.getNumTokens(Vs(e)),i=void 0!==e.name?r+await this.getNumTokens(e.name):0;let o=s+n+a+i;const l=e;return"function"===l._getType()&&(o-=2),l.additional_kwargs?.function_call&&(o+=3),l?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(l.additional_kwargs.function_call?.name)),l.additional_kwargs.function_call?.arguments&&(o+=await this.getNumTokens(JSON.stringify(JSON.parse(l.additional_kwargs.function_call?.arguments)))),t+=o,o})));return t+=3,{totalCount:t,countPerMessage:s}}async completionWithRetry(e,t){const n=this._getClientOptions(t);return this.caller.call((async()=>{try{return await this.client.chat.completions.create(e,n)}catch(e){throw function(e){let t;return e.constructor.name===nr.name?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===rr.name?(t=new Error(e.message),t.name="AbortError"):t=e,t}(e)}}))}_getClientOptions(e){if(!this.client){const e=function(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:a}=e;if(r&&s&&t)return`${s}/${t}`;if(r){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return a}({azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new Xn(t)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce(((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e)),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}n(7798),n(6076),ie.eq,ie.eq,ie.eq,ie.pX;class Ys extends ie.eq{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}async invoke(e,t){return"string"==typeof e?this._callWithConfig((async e=>this.parseResult([{text:e}])),e,{...t,runType:"parser"}):this._callWithConfig((async e=>this.parseResult([{message:e,text:"string"==typeof e.content?e.content:JSON.stringify(e.content)}])),e,{...t,runType:"parser"})}}class Xs extends Ys{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}}Error,"undefined"!=typeof self&&self.location&&"null"!==self.location.origin&&(self.location.origin,self.location.pathname,location.search);class Qs extends Xs{async*_transform(e){for await(const t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:"string"==typeof t.content?t.content:JSON.stringify(t.content)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}n(344);var ea=n(619);n(9242),n(7315),ea.d;var ta=n(1214),na=(n(1307),n(7327),n(7441));const{add_undo_history:ra,undo_button_disabled_change:sa}=n(8361),{setTextareaHeight:aa}=n(6548),ia=ta.PromptTemplate.fromTemplate("You are a document generation application.\nThe document is divided into items.\nThe following represents the title of the item.\n    \n\x3c!-- ## title: This is title. ## --\x3e\n    \n---\n{all_items}\n---\n    \n{inst_format}"),oa=ta.PromptTemplate.fromTemplate('Please generate the item named "{item_title}", taking the above into account.\nPlease reply using the format below.\n\n\x3c!-- ## title: {item_title} ## --\x3e\nGENERATED_CONTENT\n\x3c!-- ## end ## --\x3e\n\nPlease enter the content you generated to GENERATED_CONTENT.\n'),la=ta.PromptTemplate.fromTemplate('Please generate the continuation of item named "{item_title}", taking the above into account.\nThe contents of "{item_title}" are as follows.\n\n{already_generated}\n\nPlease reply using the format below.\n\n\x3c!-- ## title: {item_title} ## --\x3e\nGENERATED_CONTENT\n\x3c!-- ## end ## --\x3e\n\nPlease enter the continuation content you generated to GENERATED_CONTENT.\n'),ca=ta.PromptTemplate.fromTemplate("Please format it as below.\n\n\x3c!-- ## title: {item_title} ## --\x3e\nGENERATED_CONTENT\n\x3c!-- ## end ## --\x3e\n\nPlease enter the content you generated to GENERATED_CONTENT.\n"),ua=ta.PromptTemplate.fromTemplate("{human_input}\n\nPlease do this to the following items.\n\n{items}\n\nPlease reply using the format below.\n\n{items_format}\n\nPlease enter the content you generated to GENERATED_CONTENT.\n"),da=ta.PromptTemplate.fromTemplate("Please format it as below.\n\n{items_format}\n\nPlease enter the content you generated to GENERATED_CONTENT.\n"),ha=ta.PromptTemplate.fromTemplate("You are an application that answers about text.\nThe text is divided into items.\nThe following represents the title of the item.\n\n\x3c!-- ## title: This is title. ## --\x3e\n\n---\n{all_items}\n---\n\n"),pa=new class extends Qs{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}};let ma=null,fa=null,ga=!1,ya=null,_a=null,ba=null,va=null,wa=null;const xa=function(){ga=!1;const e=document.getElementById("api_selector_api").value,t=document.getElementById("api_key").value;let n=document.getElementById("api_model_name").value;const a=document.getElementById("api_harm").value,i=document.getElementById("api_url").value;if(ya!=e||_a!=t||ba!=n||va!=a||wa!=i)if(ya=e,_a=t,ba=n,va=a,wa=i,"Google AI Studio"==e){let e;""==n&&(n="gemini-pro"),e="High"==a?s.BLOCK_ONLY_HIGH:"Low"==a?s.BLOCK_LOW_AND_ABOVE:"None"==a?s.BLOCK_NONE:s.BLOCK_MEDIUM_AND_ABOVE,ma=new pe({modelName:n,apiKey:t,safetySettings:[{category:r.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:e},{category:r.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:e},{category:r.HARM_CATEGORY_HATE_SPEECH,threshold:e},{category:r.HARM_CATEGORY_HARASSMENT,threshold:e}]})}else"OpenAI API"==e?(""==n&&(n="gpt-3.5-turbo"),ma=new Js({modelName:n,openAIApiKey:t})):ma=new Js({modelName:n,openAIApiKey:"EMPTY",modelName:"EMPTY"},{basePath:i})},ka=function(e=!0){const t=function(e,t){for(const n of e)n.disabled=t};document.getElementById("api_selector_api").disabled=e,document.getElementById("api_key").disabled=e,document.getElementById("api_model_name").disabled=e,document.getElementById("api_harm").disabled=e,document.getElementById("api_url").disabled=e,t(document.getElementsByClassName("item_generate"),e),t(document.getElementsByClassName("item_instruction_exec"),e),document.getElementById("target_instruction_exec").disabled=e,t(document.getElementsByClassName("conversation_chat"),e),t(document.getElementsByClassName("conversation_remove_last"),e),document.getElementById("save_and_load_load").disabled=e,e?(document.getElementById("target_instruction_undo").disabled=e,document.getElementById("target_instruction_redo").disabled=e):sa(),document.getElementById("abort_btn").disabled=!e},Ea=function(e,t=!1){let n=e,r={},s=null;for(;;){const e=n.indexOf("<");if(e<0){null!=s&&(r[s]+=n);break}if(null!=s&&(r[s]+=n.substring(0,e)),n=n.substring(e),n.length<8){if("\x3c!-- ## title: ".startsWith(n))break;r[s]&&(r[s]+=n.substring(0,1)),n=n.substring(1);continue}if(!n.startsWith("\x3c!-- ## ")){r[s]&&(r[s]+=n.substring(0,1)),n=n.substring(1);continue}const a=n.indexOf(" ## --\x3e");if(a<0){t&&(r[s]+=n);break}n.startsWith("\x3c!-- ## title: ")?(s=n.substring(15,a),null==r[s]&&(r[s]="")):s=null,n=n.substring(a+7),n.startsWith("\n")&&(n=n.substring(1))}const a=Object.keys(r);for(const e of a)r[e].startsWith("GENERATED_CONTENT\n")&&(r[e]=r[e].substring(18));return r},Oa=function(e=null){let t="";const n=document.getElementById("items").children;for(const r of n){if(r.id.endsWith("_template"))continue;const n=r.getElementsByClassName("item_title")[0].value;if(!r.getElementsByClassName("item_ignore")[0].checked&&(null==e||n!=e))if(t+="\x3c!-- ## title: "+n+" ## --\x3e\n","item"==r.className){let e=r.getElementsByClassName("item_content")[0].value;for(;e.endsWith("\n");)e=e.substring(0,e.length-1);t+=e}else{const e=r.getElementsByClassName("conversation_main");for(const n of e)"conversation_human"==n.className?t+="User: ":t+="Assistant: ",t+=n.textContent+"\n"}}return""!=t&&(t+="\x3c!-- ## end ## --\x3e"),t},Aa=async function(e){ka(!0),ra(!1);try{xa();const t=e.getElementsByClassName("item_title")[0],n=e.getElementsByClassName("item_content")[0];let r,s,a,i=n.value;if(ma instanceof pe){let e;if(""==i){const n=await oa.format({item_title:t.value});e=await ia.format({all_items:Oa(t.value),inst_format:n})}else{const n=await la.format({item_title:t.value,already_generated:"\x3c!-- ## title: "+t.value+" ## --\x3e\n"+i});e=await ia.format({all_items:Oa(t.value),inst_format:n})}s=[["human",e]]}else if(ma instanceof Js){let e,n;""==i?(e=await ia.format({all_items:Oa(t.value),inst_format:""}),n=await oa.format({item_title:t.value})):(e=await ia.format({all_items:Oa(t.value),inst_format:""}),n=await la.format({item_title:t.value,already_generated:"\x3c!-- ## title: "+t.value+" ## --\x3e\n"+i})),s=[["system",e],["human",n]]}fa=new AbortController,r=await ma.pipe(pa).stream(s,{signal:fa.signal});let o="";const l=async function(){if(""==i){n.value="";for await(const e of r){o+=e;const r=Ea(o);null!=r[t.value]&&(n.value=r[t.value],aa(n))}a=Ea(o,!0),null!=a[t.value]&&(n.value=a[t.value],aa(n))}else{let e=0;for await(const s of r){o+=s;const r=Ea(o);null!=r[t.value]&&(e<0?n.value=i+r[t.value]:r[t.value].startsWith(i.substring(e))?n.value=i.substring(e)+r[t.value]:(e=i.indexOf(r[t.value]),n.value=e<0?i+r[t.value]:i.substring(e)+r[t.value]),aa(n))}a=Ea(o,!0),null!=a[t.value]&&(n.value=e<0?i+a[t.value]:i.substring(e)+a[t.value],aa(n))}};if(await l(),!a[t.value]){s.push(["ai",o]);const e=await ca.format({item_title:t.value});s.push(["human",e]),r=await ma.pipe(pa).stream(s,{signal:fa.signal}),await l()}}catch(e){ga||window.alert("An error has occurred:\n"+e.message)}ra(),ka(!1)},Ta=async function(e,t,n=""){ka(!0),ra(!1);try{xa();let r,s,a,i="",o="";for(const t of e){const e=t.getElementsByClassName("item_title")[0].value;i+="- "+e+"\n",o+="\x3c!-- ## title: "+e+" ## --\x3e\n",o+="GENERATED_CONTENT\n"}if(i=i.substring(1),o+="\x3c!-- ## end ## --\x3e",r="Update"==t?"Please regenerate the items, taking the above into account.":"Correction"==t?"Please correct the items.":"Summarize"==t?"Please summarize the contents of the items.":n,ma instanceof pe){const e=await ua.format({human_input:r,items:i,items_format:o});a=[["human",await ia.format({all_items:Oa(),inst_format:e})]]}else{a=[["system",await ia.format({all_items:Oa(),inst_format:""})],["human",await ua.format({human_input:r,items:i,items_format:o})]]}fa=new AbortController,s=await ma.pipe(pa).stream(a,{signal:fa.signal});let l,c="";const u=async function(){for await(const t of s){c+=t;const n=Ea(c);for(const t of e){const e=t.getElementsByClassName("item_title")[0];if(null!=n[e.value]){const r=t.getElementsByClassName("item_content")[0];r.value=n[e.value],aa(r)}}}l=Ea(c,!0);for(const t of e){const e=t.getElementsByClassName("item_title")[0];if(null!=l[e.value]){const n=t.getElementsByClassName("item_content")[0];n.value=l[e.value],aa(n)}}};await u();let d=!1;for(const t of e){const e=t.getElementsByClassName("item_title")[0];if(!l[e.value]){d=!0;break}}if(d){a.push(["ai",c]);const e=await da.format({items_format:o});a.push(["human",e]),s=await ma.pipe(pa).stream(a,{signal:fa.signal}),await u()}}catch(e){ga||window.alert("An error has occurred:\n"+e.message)}ra(),ka(!1)},Pa=async function(e){ka(!0),ra(!1);try{const t=document.getElementById("conversation_template"),n=t.getElementsByClassName("conversation_human")[0],r=n.cloneNode(!0),s=e.getElementsByClassName("conversation_main")[0],a=s.appendChild(r),i=n.cloneNode(!0),o=e.getElementsByClassName("conversation_display")[0],l=o.appendChild(i),c=e.getElementsByClassName("conversation_input")[0];let u;a.textContent=c.value,l.innerHTML=na.TU.parse(c.value),c.value="",aa(c),xa();const d=await ha.format({all_items:Oa(e.value)}),h=s.children,p=[];if(ma instanceof pe){p.push(["human",d+h[0].textContent]);const e=Array.from(h).slice(1);for(const t of e)"conversation_human"==t.className?p.push(["human",t.textContent]):p.push(["ai",t.textContent])}else if(ma instanceof Js){p.push(["system",d]);const e=h;for(const t of e)"conversation_human"==t.className?p.push(["human",t.textContent]):p.push(["ai",t.textContent])}fa=new AbortController,u=await ma.pipe(pa).stream(p,{signal:fa.signal});const m=t.getElementsByClassName("conversation_ai")[0],f=m.cloneNode(!0),g=s.appendChild(f),y=m.cloneNode(!0),_=o.appendChild(y);g.textContent="";let b="";for await(const e of u)b+=e,g.textContent=b,_.innerHTML=na.TU.parse(b)}catch(e){ga||window.alert("An error has occurred:\n"+e.message)}ra(),ka(!1)},Ia=function(){ga=!0,document.getElementById("abort_btn").disabled=!0,fa.abort()}},6548:(e,t,n)=>{"use strict";n.r(t),n.d(t,{allSetTextareaHeight:()=>a,itemTitleTextArea:()=>s,setTextareaHeight:()=>r});const r=function(e){const t=e.value.match(/\n/g);!t||t.length<30?(e.style.height="auto",e.scrollHeight<390?e.style.height=`${e.scrollHeight}px`:e.style.height="390px"):e.style.height="390px"},s=function(e){e.setAttribute("style",`height: ${e.scrollHeight}px; font-size: 13px;`),e.addEventListener("input",(()=>{r(e)}))},a=function(){const e=Array.from(document.getElementsByTagName("textarea"));for(const t of e)r(t)};window.addEventListener("DOMContentLoaded",(()=>{Array.from(document.getElementsByTagName("textarea")).forEach(s)}))},8361:(e,t,n)=>{"use strict";n.r(t),n.d(t,{add_undo_history:()=>u,clear_undo_history:()=>d,dump_contents:()=>o,load_contents:()=>l,redo:()=>p,undo:()=>h,undo_button_disabled_change:()=>c});var r=n(7441);const{allSetTextareaHeight:s}=n(6548);let a=[],i=-1;const o=function(){const e=document.getElementById("items").children;let t=[];for(const n of e)if(!n.id.endsWith("_template"))if("item"==n.className){const e=n.getElementsByClassName("item_title")[0],r=n.getElementsByClassName("item_content")[0],s=n.getElementsByClassName("item_target")[0],a=n.getElementsByClassName("item_ignore")[0];t.push({type:"item",id:n.id,title:e.value,content:r.value,target:s.checked,ignore:a.checked})}else if("conversation"==n.className){let e=[];const r=n.getElementsByClassName("conversation_main")[0];for(const t of r.children)"conversation_human"==t.className?e.push(["human",t.textContent]):e.push(["ai",t.textContent]);const s=n.getElementsByClassName("item_title")[0],a=n.getElementsByClassName("item_ignore")[0];t.push({type:"conversation",id:n.id,title:s.value,main:e,ignore:a.checked})}return t},l=function(e){const{add_item:t,add_conversation:a}=n(434);!function(){const e=document.getElementById("items").children;let t=0;for(;t<e.length&&e[t].id.endsWith("_template");)t++;for(;e.length>t;)e[t].remove()}();for(const n of e)if("item"==n.type){const e=t();e.id=n.id,e.getElementsByClassName("item_title")[0].value=n.title,e.getElementsByClassName("item_content")[0].value=n.content,e.getElementsByClassName("item_target")[0].checked=n.target,e.getElementsByClassName("item_ignore")[0].checked=n.ignore}else if("conversation"==n.type){const e=a();e.id=n.id,e.getElementsByClassName("item_title")[0].value=n.title;const t=e.getElementsByClassName("conversation_main")[0],s=e.getElementsByClassName("conversation_display")[0],i=document.getElementById("conversation_template"),o=i.getElementsByClassName("conversation_human")[0],l=i.getElementsByClassName("conversation_ai")[0];for(const e of n.main)if("human"==e[0]){const n=o.cloneNode(!0);t.appendChild(n).textContent=e[1];const a=o.cloneNode(!0);s.appendChild(a).innerHTML=r.TU.parse(e[1])}else{const n=l.cloneNode(!0);t.appendChild(n).textContent=e[1];const a=l.cloneNode(!0);s.appendChild(a).innerHTML=r.TU.parse(e[1])}e.getElementsByClassName("item_ignore")[0].checked=n.ignore}s()},c=function(){document.getElementById("target_instruction_undo").disabled=i<=0,document.getElementById("target_instruction_redo").disabled=a.length<=i+1},u=function(e=!0){const t=o();JSON.stringify(t)!=JSON.stringify(a[i])&&(a=a.slice(0,i+1),a.push(t),i++,e&&c())},d=function(){a=[],i=-1,c()},h=function(){if(i>0){const e=o();null!=a[i]&&JSON.stringify(e)!=JSON.stringify(a[i])?(a=a.slice(0,i+1),a.push(e)):i--,l(a[i]),c()}},p=function(){a.length>i+1&&(i++,l(a[i]),c())}},6515:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var r=n(8721),s=n(6141);class a{}class i extends a{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,s.j)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"undefined"==typeof process||"true"!==process.env?.LANGCHAIN_CALLBACKS_BACKGROUND}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return s.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return s.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends i{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:r.Z()}),Object.assign(this,e)}}}}},9205:(e,t,n)=>{"use strict";n.d(t,{Ye:()=>F,xz:()=>H});var r=n(8721),s=n(6515),a=n(6434),i=n(4075);function o(e,t){return`${e.open}${t}${e.close}`}function l(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function c(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:u}=a;class d extends i.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const e=this.runMap.get(n.parent_run_id);if(!e)break;t.push(e),n=e}return t}getBreadcrumbs(e){const t=[...this.getParents(e).reverse(),e].map(((e,t,n)=>{const r=`${e.execution_order}:${e.run_type}:${e.name}`;return t===n.length-1?o(a.bold,r):r})).join(" > ");return o(u.grey,t)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[chain/start]")} [${t}] Entering Chain run with input: ${l(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[chain/end]")} [${t}] [${c(e)}] Exiting Chain run with output: ${l(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[chain/error]")} [${t}] [${c(e)}] Chain run errored with error: ${l(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map((e=>e.trim()))}:e.inputs;console.log(`${o(u.green,"[llm/start]")} [${t}] Entering LLM run with input: ${l(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[llm/end]")} [${t}] [${c(e)}] Exiting LLM run with output: ${l(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[llm/error]")} [${t}] [${c(e)}] LLM run errored with error: ${l(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[tool/end]")} [${t}] [${c(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[tool/error]")} [${t}] [${c(e)}] Tool run errored with error: ${l(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${l(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[retriever/end]")} [${t}] [${c(e)}] Exiting Retriever run with output: ${l(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[retriever/error]")} [${t}] [${c(e)}] Retriever run errored with error: ${l(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${o(u.blue,"[agent/action]")} [${n}] Agent selected action: ${l(t.actions[t.actions.length-1],"[action]")}`)}}const h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;var p=n(2693),m=n(5860);const f=[400,401,403,404,405,406,407,408,409];class g{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t=m.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>p((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError"))throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status;if(t&&f.includes(+t))throw e},retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}function y(e){return"function"==typeof e?._getType}function _(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let b;const v=()=>"undefined"!=typeof Deno;let w,x;async function k(){if(void 0===w){const e=b||(b="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||v()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":v()?"deno":"other":"node",b),t=function(){if(void 0!==x)return x;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const n of e){const e=E(n);void 0!==e&&(t[n]=e)}return x=t,t}();w={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:N,...t}}return w}function E(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}const O=e=>{const t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},A=async(e,t)=>{const n=await e.text();if(!e.ok)throw new Error(`Failed to ${t}: ${e.status} ${e.statusText} ${n}`)};function T(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function P(e){return"true"===E("LANGCHAIN_HIDE_INPUTS")?{}:e}function I(e){return"true"===E("LANGCHAIN_HIDE_OUTPUTS")?{}:e}function S(e){if("string"!=typeof(t=e)||!h.test(t))throw new Error(`Invalid UUID: ${e}`);var t}class C{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null});const t=C.getDefaultClientConfig();this.apiUrl=T(e.apiUrl??t.apiUrl)??"",this.apiKey=T(e.apiKey??t.apiKey),this.webUrl=T(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??12e3,this.caller=new g(e.callerOptions??{})}static getDefaultClientConfig(){const e=E("LANGCHAIN_API_KEY");return{apiUrl:E("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0}}validateApiKeyIfHosted(){if(!O(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:O(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={"User-Agent":`langsmith-js/${N}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _getResponse(e,t){const n=t?.toString()??"",r=`${this.apiUrl}${e}?${n}`,s=await this.caller.call(fetch,r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);return s}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let n=Number(t.get("offset"))||0;const r=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(r));const s=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const i=await a.json();if(0===i.length)break;if(yield i,i.length<r)break;n+=i.length}}async*_getCursorPaginatedList(e,t=null,n="POST",r="runs"){const s=t?{...t}:{};for(;;){const t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(s)}),a=await t.json();if(!a)break;if(!a[r])break;yield a[r];const i=a.cursors;if(!i)break;if(!i.next)break;s.cursor=i.next}}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},n=e.extra??{},r=n.metadata,s=await k(),a=function(){const e=function(){try{return"undefined"!=typeof process&&process.env?Object.entries(process.env).reduce(((e,[t,n])=>(e[t]=String(n),e)),{}):void 0}catch(e){return}}()||{},t={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,s]of Object.entries(e))!r.startsWith("LANGCHAIN_")||"string"!=typeof s||n.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=s:t[r]=s);return t}(),i=e.project_name;delete e.project_name;const o={session_name:i,...e,extra:{...e.extra,runtime:{...s,...n.runtime},metadata:{...a,...a.revision_id||e.revision_id?{revision_id:e.revision_id??a.revision_id}:{},...r}}};o.inputs=P(o.inputs),o.outputs&&(o.outputs=I(o.outputs));const l=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms)});await A(l,"create run")}async updateRun(e,t){S(e),t.inputs&&(t.inputs=P(t.inputs)),t.outputs&&(t.outputs=I(t.outputs));const n={...this.headers,"Content-Type":"application/json"},r=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:n,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await A(r,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){S(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(void 0!==t){let e;e=t.session_id?t.session_id:n?.projectName?(await this.readProject({projectName:n?.projectName})).id:n?.projectId?n?.projectId:(await this.readProject({projectName:E("LANGCHAIN_PROJECT")||"default"})).id;const r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){const t=await this.readRun(e);if(!t.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${t.app_path}`}throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.listRuns({id:e.child_run_ids})),n={},r={};t.sort(((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")));for(const e of t){if(null===e.parent_run_id||void 0===e.parent_run_id)throw new Error(`Child run ${e.id} has no parent`);e.parent_run_id in n||(n[e.parent_run_id]=[]),n[e.parent_run_id].push(e),r[e.id]=e}e.child_runs=n[e.id]||[];for(const t in n)t!==e.id&&(r[t].child_runs=n[t]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:n,referenceExampleId:r,startTime:s,executionOrder:a,runType:i,error:o,id:l,query:c,filter:u,limit:d}){let h=e;if(t){if(e)throw new Error("Only one of projectId or projectName may be given");h=(await this.readProject({projectName:t})).id}const p={session:h?[h]:null,run_type:i,reference_example:r,query:c,filter:u,execution_order:a,parent_run:n?[n]:null,start_time:s?s.toISOString():null,error:o,id:l,limit:d};for await(const e of this._getCursorPaginatedList("/runs/query",p))yield*e}async shareRun(e,{shareId:t}={}){const n={run_id:e,share_token:t||r.Z()};S(e);const s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)}),a=await s.json();if(null===a||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){S(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await A(t,"unshare run")}async readRunSharedLink(e){S(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),n=await t.json();if(null!==n&&"share_token"in n)return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const n=new URLSearchParams({share_token:e});if(void 0!==t)for(const e of t)n.append("id",e);S(e);const r=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),S(e);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await n.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const n={dataset_id:e};S(e);const r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)}),s=await r.json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){S(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await A(t,"unshare dataset")}async readSharedDataset(e){S(e);const t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await t.json()}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:r=!1,projectExtra:s=null,referenceDatasetId:a=null}){const i=r?"?upsert=true":"",o=`${this.apiUrl}/sessions${i}`,l=s||{};n&&(l.metadata=n);const c={name:e,extra:l,description:t};null!==a&&(c.reference_dataset_id=a);const u=await this.caller.call(fetch,o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms)}),d=await u.json();if(!u.ok)throw new Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return d}async updateProject(e,{name:t=null,description:n=null,metadata:r=null,projectExtra:s=null,endTime:a=null}){const i=`${this.apiUrl}/sessions/${e}`;let o=s;r&&(o={...o||{},metadata:r});const l={name:t,extra:o,description:n,end_time:a?new Date(a).toISOString():null},c=await this.caller.call(fetch,i,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),u=await c.json();if(!c.ok)throw new Error(`Failed to update project ${e}: ${c.status} ${c.statusText}`);return u}async readProject({projectId:e,projectName:t}){let n="/sessions";const r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");if(void 0!==e)S(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide projectName or projectId");r.append("name",t)}const s=await this._get(n,r);let a;if(Array.isArray(s)){if(0===s.length)throw new Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:r,referenceDatasetName:s,referenceFree:a}={}){const i=new URLSearchParams;if(void 0!==e)for(const t of e)i.append("id",t);if(void 0!==t&&i.append("name",t),void 0!==n&&i.append("name_contains",n),void 0!==r)i.append("reference_dataset",r);else if(void 0!==s){const e=await this.readDataset({datasetName:s});i.append("reference_dataset",e.id)}void 0!==a&&i.append("reference_free",a.toString());for await(const e of this._getPaginated("/sessions",i))yield*e}async deleteProject({projectId:e,projectName:t}){let n;if(void 0===e&&void 0===t)throw new Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw new Error("Must provide either projectName or projectId, not both");n=void 0===e?(await this.readProject({projectName:t})).id:e,S(n);const r=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await A(r,`delete session ${n} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:r,description:s,dataType:a,name:i}){const o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),n.forEach((e=>{l.append("input_keys",e)})),r.forEach((e=>{l.append("output_keys",e)})),s&&l.append("description",s),a&&l.append("data_type",a),i&&l.append("name",i);const c=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok){const e=await c.json();if(e.detail&&e.detail.includes("already exists"))throw new Error(`Dataset ${t} already exists`);throw new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:t,dataType:n}={}){const r={name:e,description:t};n&&(r.data_type=n);const s=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok){const t=await s.json();if(t.detail&&t.detail.includes("already exists"))throw new Error(`Dataset ${e} already exists`);throw new Error(`Failed to create dataset ${s.status} ${s.statusText}`)}return await s.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets";const r=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)S(e),n+=`/${e}`;else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");r.append("name",t)}const s=await this._get(n,r);let a;if(Array.isArray(s)){if(0===s.length)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else{if(void 0===t)throw new Error("Must provide datasetName or datasetId");e=(await this.readDataset({datasetName:t})).id}const n=await this._getResponse(`/datasets/${e}/openai_ft`);return(await n.text()).trim().split("\n").map((e=>JSON.parse(e)))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:r,datasetNameContains:s}={}){const a=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==n)for(const e of n)a.append("id",e);void 0!==r&&a.append("name",r),void 0!==s&&a.append("name_contains",s);for await(const e of this._getPaginated("/datasets",a))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",r=e;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(r=(await this.readDataset({datasetName:t})).id),void 0===r)throw new Error("Must provide datasetName or datasetId");S(r),n+=`/${r}`;const s=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw new Error(`Failed to delete ${n}: ${s.status} ${s.statusText}`);await s.json()}async createExample(e,t,{datasetId:n,datasetName:r,createdAt:s,exampleId:a}){let i=n;if(void 0===i&&void 0===r)throw new Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==r)throw new Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:r})).id);const o=s||new Date,l={dataset_id:i,inputs:e,outputs:t,created_at:o?.toISOString(),id:a},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async createExamples(e){const{inputs:t,outputs:n,sourceRunIds:r,exampleIds:s,datasetId:a,datasetName:i}=e;let o=a;if(void 0===o&&void 0===i)throw new Error("Must provide either datasetName or datasetId");if(void 0!==o&&void 0!==i)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0===o){const e=await this.readDataset({datasetName:i});o=e.id}const l=t.map(((e,t)=>({dataset_id:o,inputs:e,outputs:n?n[t]:void 0,id:s?s[t]:void 0,source_run_id:r?r[t]:void 0}))),c=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create examples: ${c.status} ${c.statusText}`);return await c.json()}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){const r=e.map((e=>y(e)?_(e):e)),s=y(t)?_(t):t;return this.createExample({input:r},{output:s},n)}async readExample(e){S(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:n}={}){let r;if(void 0!==e&&void 0!==t)throw new Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)r=e;else{if(void 0===t)throw new Error("Must provide a datasetName or datasetId");r=(await this.readDataset({datasetName:t})).id}const s=new URLSearchParams({dataset:r});if(void 0!==n)for(const e of n)s.append("id",e);for await(const e of this._getPaginated("/examples",s))yield*e}async deleteExample(e){S(e);const t=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,t){S(e);const n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:r,referenceExample:s}={loadChildRuns:!1}){let a;if("string"==typeof e)a=await this.readRun(e,{loadChildRuns:r});else{if("object"!=typeof e||!("id"in e))throw new Error("Invalid run type: "+typeof e);a=e}null!==a.reference_example_id&&void 0!==a.reference_example_id&&(s=await this.readExample(a.reference_example_id));const i=await t.evaluateRun(a,s);let o=n??{};i.evaluatorInfo&&(o={...o,...i.evaluatorInfo});const l=i.targetRunId??a.id;return await this.createFeedback(l,i.key,{score:i?.score,value:i?.value,comment:i?.comment,correction:i?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:i?.sourceRunId})}async createFeedback(e,t,{score:n,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,eager:d=!1}){const h={type:l??"api",metadata:o??{}};void 0===c||void 0===h?.metadata||h.metadata.__run||(h.metadata.__run={run_id:c}),void 0!==h?.metadata&&void 0!==h.metadata.__run?.run_id&&S(h.metadata.__run.run_id);const p={id:u??r.Z(),run_id:e,key:t,score:n,value:s,correction:a,comment:i,feedback_source:h},m=`${this.apiUrl}/feedback`+(d?"/eager":""),f=await this.caller.call(fetch,m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(p),signal:AbortSignal.timeout(this.timeout_ms)});return await A(f,"create feedback"),p}async updateFeedback(e,{score:t,value:n,correction:r,comment:s}){const a={};null!=t&&(a.score=t),null!=n&&(a.value=n),null!=r&&(a.correction=r),null!=s&&(a.comment=s),S(e);const i=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});await A(i,"update feedback")}async readFeedback(e){S(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){S(e);const t=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){const r=new URLSearchParams;if(e&&r.append("run",e.join(",")),t)for(const e of t)r.append("key",e);if(n)for(const e of n)r.append("source",e);for await(const e of this._getPaginated("/feedback",r))yield*e}}const N="0.0.63";var R=n(6374);class j extends i.Z{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:n,client:r}=e;this.projectName=n??(0,R.lS)("LANGCHAIN_PROJECT")??(0,R.lS)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=r??new C({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await(0,R.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}var $=n(3908);let M;async function L(e,t){!0===t?await e():(void 0===M&&(M=new(0,m.default)({autoStart:!0,concurrency:1})),M.add(e))}i.Z;class B{setHandler(e){return this.setHandlers([e])}}class U{constructor(e,t,n,r,s,a,i,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map((t=>L((async()=>{try{await(t.handleText?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}}),t.awaitHandlers))))}}class D extends U{getChild(e){const t=new F(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}}),t.awaitHandlers))))}async handleRetrieverError(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreRetriever)try{await(t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}}),t.awaitHandlers))))}}class z extends U{async handleLLMNewToken(e,t,n,r,s,a){await Promise.all(this.handlers.map((n=>L((async()=>{if(!n.ignoreLLM)try{await(n.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(e){console.error(`Error in handler ${n.constructor.name}, handleLLMNewToken: ${e}`)}}),n.awaitHandlers))))}async handleLLMError(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}}),t.awaitHandlers))))}async handleLLMEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreLLM)try{await(t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}}),t.awaitHandlers))))}}class Z extends U{getChild(e){const t=new F(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,r,s){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreChain)try{await(t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}}),t.awaitHandlers))))}async handleChainEnd(e,t,n,r,s){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreChain)try{await(t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}}),t.awaitHandlers))))}async handleAgentAction(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}}),t.awaitHandlers))))}async handleAgentEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}}),t.awaitHandlers))))}}class q extends U{getChild(e){const t=new F(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleToolError?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}}),t.awaitHandlers))))}async handleToolEnd(e){await Promise.all(this.handlers.map((t=>L((async()=>{if(!t.ignoreAgent)try{await(t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags))}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}}),t.awaitHandlers))))}}class F extends B{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}async handleLLMStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map((async t=>{const n=(0,r.Z)();return await Promise.all(this.handlers.map((r=>L((async()=>{if(!r.ignoreLLM)try{await(r.handleLLMStart?.(e,[t],n,this._parentRunId,a,this.tags,this.metadata,l))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`)}}),r.awaitHandlers)))),new z(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChatModelStart(e,t,n=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map((async t=>{const n=(0,r.Z)();return await Promise.all(this.handlers.map((r=>L((async()=>{if(!r.ignoreLLM)try{if(r.handleChatModelStart)await(r.handleChatModelStart?.(e,[t],n,this._parentRunId,a,this.tags,this.metadata,l));else if(r.handleLLMStart){const s=(0,$.zs)(t);await(r.handleLLMStart?.(e,[s],n,this._parentRunId,a,this.tags,this.metadata,l))}}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`)}}),r.awaitHandlers)))),new z(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)})))}async handleChainStart(e,t,n=(0,r.Z)(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>L((async()=>{if(!r.ignoreChain)try{await(r.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleChainStart: ${e}`)}}),r.awaitHandlers)))),new Z(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=(0,r.Z)(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>L((async()=>{if(!r.ignoreAgent)try{await(r.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleToolStart: ${e}`)}}),r.awaitHandlers)))),new q(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=(0,r.Z)(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map((r=>L((async()=>{if(!r.ignoreRetriever)try{await(r.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(e){console.error(`Error in handler ${r.constructor.name}, handleRetrieverStart: ${e}`)}}),r.awaitHandlers)))),new D(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e)),this.inheritableHandlers=this.inheritableHandlers.filter((t=>t!==e))}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter((t=>!e.includes(t))),this.inheritableTags=this.inheritableTags.filter((t=>!e.includes(t)))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const n=new F(this._parentRunId);for(const e of this.handlers){const t=this.inheritableHandlers.includes(e);n.addHandler(e,t)}for(const e of this.tags){const t=this.inheritableTags.includes(e);n.addTags([e],t)}for(const e of Object.keys(this.metadata)){const t=Object.keys(this.inheritableMetadata).includes(e);n.addMetadata({[e]:this.metadata[e]},t)}for(const r of e)n.handlers.filter((e=>"console_callback_handler"===e.name)).some((e=>e.name===r.name))||n.addHandler(r,t);return n}static fromHandlers(e){class t extends s.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,r.Z)()}),Object.assign(this,e)}}const n=new this;return n.addHandler(new t),n}static async configure(e,t,n,r,s,a,i){let o;(e||t)&&(Array.isArray(e)||!e?(o=new F,o.setHandlers(e?.map(H)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(H):t?.handlers,!1));const l="true"===(0,R.lS)("LANGCHAIN_VERBOSE")||i?.verbose,c="true"===(0,R.lS)("LANGCHAIN_TRACING_V2"),u=c||((0,R.lS)("LANGCHAIN_TRACING")??!1);if(l||u){if(o||(o=new F),l&&!o.handlers.some((e=>e.name===d.prototype.name))){const e=new d;o.addHandler(e,!0)}u&&!o.handlers.some((e=>"langchain_tracer"===e.name))&&c&&o.addHandler(await async function(){return new j}(),!0)}return(n||r)&&o&&(o.addTags(n??[]),o.addTags(r??[],!1)),(s||a)&&o&&(o.addMetadata(s??{}),o.addMetadata(a??{},!1)),o}}function H(e){return"name"in e?e:s.E.fromMethods(e)}},6141:(e,t,n)=>{"use strict";n.d(t,{i:()=>c,j:()=>l});var r=n(2466);function s(e,t){return t?.[e]||r(e)}function a(e,t,n){const r={};for(const s in e)Object.hasOwn(e,s)&&(r[t(s,n)]=e[s]);return r}function i(e){return Array.isArray(e)?[...e]:{...e}}function o(e,t){const n=i(e);for(const[e,r]of Object.entries(t)){const[t,...s]=e.split(".").reverse();let a=n;for(const e of s.reverse()){if(void 0===a[e])break;a[e]=i(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[r]})}return n}function l(e){const t=Object.getPrototypeOf(e);return"function"!=typeof e.lc_name||"function"==typeof t.lc_name&&e.lc_name()===t.lc_name()?e.name:e.lc_name()}n(3204);class c{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,l(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof c||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},n=Object.keys(this.lc_kwargs).reduce(((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e)),{});for(let r=Object.getPrototypeOf(this);r;r=Object.getPrototypeOf(r))Object.assign(e,Reflect.get(r,"lc_aliases",this)),Object.assign(t,Reflect.get(r,"lc_secrets",this)),Object.assign(n,Reflect.get(r,"lc_attributes",this));return Object.keys(t).forEach((e=>{let t=this,r=n;const[s,...a]=e.split(".").reverse();for(const e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}s in t&&void 0!==t[s]&&(r[s]=r[s]||t[s])})),{lc:1,type:"constructor",id:this.lc_id,kwargs:a(Object.keys(t).length?o(n,t):n,s,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},3908:(e,t,n)=>{"use strict";n.d(t,{Cr:()=>m,E1:()=>b,GC:()=>d,HD:()=>v,J:()=>g,QW:()=>y,Xz:()=>f,gY:()=>u,jN:()=>h,ku:()=>a,ro:()=>c,wv:()=>_,xk:()=>l,xq:()=>p,zs:()=>w});var r=n(6141);function s(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class a extends r.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){const e=this._getType();if("human"===e)return new c({...this});if("ai"===e)return new d({...this});if("system"===e)return new p({...this});if("function"===e)return new m({...this});if(g.isInstance(this))return new v({...this});throw new Error("Unknown message type.")}}function i(e){return Array.isArray(e)&&e.every((e=>"number"==typeof e.index))}class o extends a{static _mergeAdditionalKwargs(e,t){const n={...e};for(const[e,r]of Object.entries(t))if(void 0===n[e])n[e]=r;else{if(typeof n[e]!=typeof r)throw new Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);if("string"==typeof n[e])n[e]=n[e]+r;else if(Array.isArray(n[e])||"object"!=typeof n[e]){if("tool_calls"!==e||!i(n[e])||!i(r))throw new Error(`additional_kwargs[${e}] already exists in this message chunk.`);for(const t of r)void 0!==n[e]?.[t.index]?n[e]=n[e]?.map(((e,n)=>n!==t.index?e:{...e,...t,function:{name:t.function.name??e.function.name,arguments:(e.function.arguments??"")+(t.function.arguments??"")}})):n[e][t.index]=t}else n[e]=this._mergeAdditionalKwargs(n[e],r)}return n}}class l extends a{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class c extends o{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new c({content:s(this.content,e.content),additional_kwargs:c._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class u extends a{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class d extends o{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new d({content:s(this.content,e.content),additional_kwargs:d._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class h extends a{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class p extends o{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new p({content:s(this.content,e.content),additional_kwargs:p._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class m extends o{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new m({content:s(this.content,e.content),additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class f extends o{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new f({content:s(this.content,e.content),additional_kwargs:f._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),tool_call_id:this.tool_call_id})}}class g extends a{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function y(e){return"function"==typeof e?._getType}function _(e){return y(e)&&"function"==typeof e.concat}function b(e){if("string"==typeof e)return new l(e);if(y(e))return e;const[t,n]=e;if("human"===t||"user"===t)return new l({content:n});if("ai"===t||"assistant"===t)return new u({content:n});if("system"===t)return new h({content:n});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class v extends o{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new v({content:s(this.content,e.content),additional_kwargs:v._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}function w(e,t="Human",n="AI"){const r=[];for(const s of e){let e;if("human"===s._getType())e=t;else if("ai"===s._getType())e=n;else if("system"===s._getType())e="System";else if("function"===s._getType())e="Function";else if("tool"===s._getType())e="Tool";else{if("generic"!==s._getType())throw new Error(`Got unsupported message type: ${s._getType()}`);e=s.role}const a=s.name?`${s.name}, `:"";r.push(`${e}: ${a}${s.content}`)}return r.join("\n")}},1141:(e,t,n)=>{"use strict";n.d(t,{GU:()=>o,nw:()=>i});var r=n(6141),s=n(3908);class a extends r.i{}class i extends a{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new s.xk(this.value)]}}class o extends a{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,s.zs)(this.messages)}toChatMessages(){return this.messages}}},619:(e,t,n)=>{"use strict";n.d(t,{d:()=>s});var r=n(4451);class s extends r.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},n={};for(const[e,r]of Object.entries(t))n[e]="string"==typeof r?r:await r();return{...n,...e}}async invoke(e,t){return this._callWithConfig((e=>this.formatPromptValue(e)),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(n.bind(n,1214));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(n.bind(n,1214));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(n.bind(n,7315));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}},9242:(e,t,n)=>{"use strict";n.d(t,{S:()=>u,ks:()=>g});var r=n(3908),s=n(1141),a=n(4451),i=n(619),o=n(1214);class l extends a.eq{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig((e=>this.formatMessages(e)),e,{...t,runType:"prompt"})}}class c extends l{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class u extends i.d{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new s.GU(t)}}class d extends c{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new r.J(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this(o.PromptTemplate.fromTemplate(e),t)}}class h extends c{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new r.xk(await this.prompt.format(e))}static fromTemplate(e){return new this(o.PromptTemplate.fromTemplate(e))}}class p extends c{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new r.gY(await this.prompt.format(e))}static fromTemplate(e){return new this(o.PromptTemplate.fromTemplate(e))}}class m extends c{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new r.jN(await this.prompt.format(e))}static fromTemplate(e){return new this(o.PromptTemplate.fromTemplate(e))}}function f(e){if("function"==typeof e.formatMessages||(0,r.QW)(e))return e;const t=(0,r.E1)(e);if("human"===t._getType())return h.fromTemplate(t.content);if("ai"===t._getType())return p.fromTemplate(t.content);if("system"===t._getType())return m.fromTemplate(t.content);if(r.J.isInstance(t))return d.fromTemplate(t.content,t.role);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}class g extends u{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const e=new Set;for(const t of this.promptMessages)if(!(t instanceof r.ku))for(const n of t.inputVariables)e.add(n);const t=this.inputVariables,n=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),s=new Set([...n].filter((t=>!e.has(t))));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);const a=new Set([...e].filter((e=>!n.has(e))));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;const n=await Promise.all(e.content.map((async e=>{if("image_url"!==e.type||"string"==typeof e.image_url||!e.image_url?.url)return e;const n=e.image_url.url,r=o.PromptTemplate.fromTemplate(n),s=await r.format(t);return e.image_url.url=s,e})));return e.content=n,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let n=[];for(const e of this.promptMessages)if(e instanceof r.ku)n.push(await this._parseImagePrompts(e,t));else{const r=e.inputVariables.reduce(((n,r)=>{if(!(r in t||"MessagesPlaceholder"===e.constructor.lc_name()&&e.optional))throw new Error(`Missing value for input variable \`${r.toString()}\``);return n[r]=t[r],n}),{}),s=await e.formatMessages(r);n=n.concat(s)}return n}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new g(r)}static fromTemplate(e){const t=o.PromptTemplate.fromTemplate(e),n=new h({prompt:t});return this.fromMessages([n])}static fromMessages(e){const t=e.reduce(((e,t)=>e.concat(t instanceof g?t.promptMessages:[f(t)])),[]),n=e.reduce(((e,t)=>t instanceof g?Object.assign(e,t.partialVariables):e),Object.create(null)),s=new Set;for(const e of t)if(!(e instanceof r.ku))for(const t of e.inputVariables)t in n||s.add(t);return new g({inputVariables:[...s],promptMessages:t,partialVariables:n})}static fromPromptMessages(e){return this.fromMessages(e)}}},7315:(e,t,n)=>{"use strict";n.d(t,{FewShotPromptTemplate:()=>o});var r=n(1307),s=n(7327),a=n(1214),i=n(9242);class o extends r.A{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new o(r)}async format(e){const t=await this.mergePartialAndUserVariables(e),n=await this.getExamples(t),r=await Promise.all(n.map((e=>this.examplePrompt.format(e)))),a=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return(0,s.SM)(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const n=await a.PromptTemplate.deserialize(t);let r;if(!Array.isArray(e.examples))throw new Error("Invalid examples format. Only list or string are supported.");return r=e.examples,new o({inputVariables:e.input_variables,examplePrompt:n,examples:r,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}i.S},1214:(e,t,n)=>{"use strict";n.d(t,{PromptTemplate:()=>a});var r=n(1307),s=n(7327);class a extends r.A{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.af)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return(0,s.SM)(this.template,this.templateFormat,t)}static fromExamples(e,t,n,r="\n\n",s=""){const i=[s,...e,t].join(r);return new a({inputVariables:n,template:i})}static fromTemplate(e,{templateFormat:t="f-string",...n}={}){const r=new Set;return(0,s.$M)(e,t).forEach((e=>{"variable"===e.type&&r.add(e.name)})),new a({inputVariables:[...r],templateFormat:t,template:e,...n})}async partial(e){const t=this.inputVariables.filter((t=>!(t in e))),n={...this.partialVariables??{},...e},r={...this,inputVariables:t,partialVariables:n};return new a(r)}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new a({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},1307:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(1141),s=n(619);class a extends s.d{async formatPromptValue(e){const t=await this.format(e);return new r.nw(t)}}},7327:(e,t,n)=>{"use strict";n.d(t,{$M:()=>o,SM:()=>i,af:()=>l});const r=e=>{const t=e.split(""),n=[],r=(e,n)=>{for(let r=n;r<t.length;r+=1)if(e.includes(t[r]))return r;return-1};let s=0;for(;s<t.length;)if("{"===t[s]&&s+1<t.length&&"{"===t[s+1])n.push({type:"literal",text:"{"}),s+=2;else if("}"===t[s]&&s+1<t.length&&"}"===t[s+1])n.push({type:"literal",text:"}"}),s+=2;else if("{"===t[s]){const e=r("}",s);if(e<0)throw new Error("Unclosed '{' in template.");n.push({type:"variable",name:t.slice(s+1,e).join("")}),s=e+1}else{if("}"===t[s])throw new Error("Single '}' in template.");{const e=r("{}",s),a=(e<0?t.slice(s):t.slice(s,e)).join("");n.push({type:"literal",text:a}),s=e<0?t.length:e}}return n},s={"f-string":(e,t)=>r(e).reduce(((e,n)=>{if("variable"===n.type){if(n.name in t)return e+t[n.name];throw new Error(`Missing value for input ${n.name}`)}return e+n.text}),"")},a={"f-string":r},i=(e,t,n)=>s[t](e,n),o=(e,t)=>a[t](e),l=(e,t,n)=>{if(!(t in s)){const e=Object.keys(s);throw new Error(`Invalid template format. Got \`${t}\`;\n                         should be one of ${e}`)}try{const r=n.reduce(((e,t)=>(e[t]="foo",e)),{});i(e,t,r)}catch(e){throw new Error(`Invalid prompt schema: ${e.message}`)}}},4451:(e,t,n)=>{"use strict";n.d(t,{eq:()=>g,Vh:()=>O,pX:()=>y,Y8:()=>x,dT:()=>w,Uv:()=>f,k9:()=>E});var r=n(2693),s=n(9205),a=n(344),i=n(4075),o=n(6076);class l{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){const t=this.ops.concat(e.ops),n=(0,a.af)({},t);return new c({ops:t,state:n[n.length-1].newDocument})}}class c extends l{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),n=(0,a.af)(this.state,e.ops);return new c({ops:t,state:n[n.length-1].newDocument})}}class u extends i.Z{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=o.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(n=n||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(n=n||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(n=n||void 0!==t.find((e=>this.includeTags?.includes(e)))),void 0!==this.excludeNames&&(n=n&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(n=n&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(n=n&&t.every((e=>!this.excludeTags?.includes(e)))),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const t=this.keyMapByRunId[e];t&&await this.writer.write(new l({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new l({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new l({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(void 0===t)return;const n=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new l({ops:n});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new l({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){const n=this.keyMapByRunId[e.id];if(void 0===n)return;const r=new l({ops:[{op:"add",path:`/logs/${n}/streamed_output_str/-`,value:t}]});await this.writer.write(r)}}var d=n(6141),h=n(7798),p=n(9636);class m extends i.Z{constructor({config:e,onStart:t,onEnd:n,onError:r}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=r}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}function f(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class g extends d.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new y({bound:this,kwargs:e,config:{}})}map(){return new _({bound:this})}withRetry(e){return new b({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new y({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new k({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e.map(h.LE)}return Array.from({length:t},(()=>(0,h.LE)(e)))}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),s=r[0]?.maxConcurrency??n?.maxConcurrency,a=new p.L({maxConcurrency:s,onFailedAttempt:e=>{throw e}}),i=e.map(((e,t)=>a.call((async()=>{try{return await this.invoke(e,r[t])}catch(e){if(n?.returnExceptions)return e;throw e}}))));return Promise.all(i)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=new o.qq(this._streamIterator(e,t));return await n.setup,o.QJ.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e={}){const t=(0,h.LE)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency}),n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,[t,n]}async _callWithConfig(e,t,n){const r=(0,h.LE)(n),s=await(0,h.Le)(r),a=await(s?.handleChainStart(this.toJSON(),f(t,"input"),void 0,r?.runType,void 0,void 0,r?.runName??this.getName()));let i;try{i=await e.call(this,t,r,a)}catch(e){throw await(a?.handleChainError(e)),e}return await(a?.handleChainEnd(f(i,"output"))),i}async _batchWithConfig(e,t,n,r){const s=this._getOptionsList(n??{},t.length),a=await Promise.all(s.map(h.Le)),i=await Promise.all(a.map(((e,n)=>e?.handleChainStart(this.toJSON(),f(t[n],"input"),void 0,s[n].runType,void 0,void 0,s[n].runName??this.getName()))));let o;try{o=await e.call(this,t,s,i,r)}catch(e){throw await Promise.all(i.map((t=>t?.handleChainError(e)))),e}return await Promise.all(i.map((e=>e?.handleChainEnd(f(o,"output"))))),o}async*_transformStreamWithConfig(e,t,n){let r,s,a=!0,i=!0;const l=(0,h.LE)(n),c=await(0,h.Le)(l);let u;try{const n=await(0,o.E7)(t.bind(this),async function*(){for await(const t of e){if(a)if(void 0===r)r=t;else try{r=(0,o.zo)(r,t)}catch{r=void 0,a=!1}yield t}}(),(async()=>c?.handleChainStart(this.toJSON(),{input:""},void 0,l?.runType,void 0,void 0,l?.runName??this.getName())),l);u=n.setup;const d=e=>"log_stream_tracer"===e.name,h=u?.handlers.find(d);let p=n.output;void 0!==h&&void 0!==u&&(p=await h.tapOutputIterable(u.runId,n.output));for await(const e of p)if(yield e,i)if(void 0===s)s=e;else try{s=(0,o.zo)(s,e)}catch{s=void 0,i=!1}}catch(e){throw await(u?.handleChainError(e,void 0,void 0,void 0,{inputs:f(r,"input")})),e}await(u?.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:f(r,"input")}))}pipe(e){return new v({first:this,last:E(e)})}pick(e){return this.pipe(new A(e))}assign(e){return this.pipe(new O(new w({steps:e})))}async*transform(e,t){let n;for await(const t of e)n=void 0===n?t:(0,o.zo)(n,t);yield*this._streamIterator(n,t)}async*streamLog(e,t,n){const r=new u({...n,autoClose:!1}),s=(0,h.LE)(t),{callbacks:a}=s;if(void 0===a)s.callbacks=[r];else if(Array.isArray(a))s.callbacks=a.concat([r]);else{const e=a.copy();e.inheritableHandlers.push(r),s.callbacks=e}const i=await this.stream(e,s),o=async function(){try{for await(const e of i){const t=new l({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await r.writer.write(t)}}finally{await r.writer.close()}}();try{for await(const e of r)yield e}finally{await o}}static isRunnable(e){return!!e&&e.lc_runnable}withListeners({onStart:e,onEnd:t,onError:n}){return new y({bound:this,config:{},configFactories:[r=>({callbacks:[new m({config:r,onStart:e,onEnd:t,onError:n})]})]})}}class y extends g{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=(0,h.t8)(this.config,...e);return(0,h.t8)(t,...this.configFactories?await Promise.all(this.configFactories.map((async e=>await e(t)))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(t,this.kwargs))}async batch(e,t,n){const r=Array.isArray(t)?await Promise.all(t.map((async e=>this._mergeConfig(e,this.kwargs)))):await this._mergeConfig(t,this.kwargs);return this.bound.batch(e,r,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(t,this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(t,this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(t,this.kwargs))}static isRunnableBinding(e){return e.bound&&g.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new y({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[r=>({callbacks:[new m({config:r,onStart:e,onEnd:t,onError:n})]})]})}}class _ extends g{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new _({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,n){return this.bound.batch(e,(0,h.q)(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new _({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}}class b extends y{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const r=e>1?`retry:attempt:${e}`:void 0;return(0,h.q)(t,{callbacks:n?.getChild(r)})}async _invoke(e,t,n){return r((r=>super.invoke(e,this._patchConfigForRetry(r,t,n))),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,n,s){const a={};try{await r((async r=>{const i=e.map(((e,t)=>t)).filter((e=>void 0===a[e.toString()]||a[e.toString()]instanceof Error)),o=i.map((t=>e[t])),l=i.map((e=>this._patchConfigForRetry(r,t?.[e],n?.[e]))),c=await super.batch(o,l,{...s,returnExceptions:!0});let u;for(let e=0;e<c.length;e+=1){const t=c[e],n=i[e];t instanceof Error&&void 0===u&&(u=t),a[n.toString()]=t}if(u)throw u;return c}),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(!0!==s?.returnExceptions)throw e}return Object.keys(a).sort(((e,t)=>parseInt(e,10)-parseInt(t,10))).map((e=>a[parseInt(e,10)]))}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}}class v extends g{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const n=await(0,h.Le)(t),r=await(n?.handleChainStart(this.toJSON(),f(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let s,a=e;try{const e=[this.first,...this.middle];for(let n=0;n<e.length;n+=1){const s=e[n];a=await s.invoke(a,(0,h.q)(t,{callbacks:r?.getChild(`seq:step:${n+1}`)}))}s=await this.last.invoke(a,(0,h.q)(t,{callbacks:r?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await(r?.handleChainError(e)),e}return await(r?.handleChainEnd(f(s,"output"))),s}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),s=await Promise.all(r.map(h.Le)),a=await Promise.all(s.map(((t,n)=>t?.handleChainStart(this.toJSON(),f(e[n],"input"),void 0,void 0,void 0,void 0,r[n].runName))));let i=e;try{for(let e=0;e<this.steps.length;e+=1){const t=this.steps[e];i=await t.batch(i,a.map(((t,n)=>{const s=t?.getChild(`seq:step:${e+1}`);return(0,h.q)(r[n],{callbacks:s})})),n)}}catch(e){throw await Promise.all(a.map((t=>t?.handleChainError(e)))),e}return await Promise.all(a.map((e=>e?.handleChainEnd(f(i,"output"))))),i}async*_streamIterator(e,t){const n=await(0,h.Le)(t),r=await(n?.handleChainStart(this.toJSON(),f(e,"input"),void 0,void 0,void 0,void 0,t?.runName)),s=[this.first,...this.middle,this.last];let a,i=!0;try{let n=s[0].transform(async function*(){yield e}(),(0,h.q)(t,{callbacks:r?.getChild("seq:step:1")}));for(let e=1;e<s.length;e+=1){const a=s[e];n=await a.transform(n,(0,h.q)(t,{callbacks:r?.getChild(`seq:step:${e+1}`)}))}for await(const e of n)if(yield e,i)if(void 0===a)a=e;else try{a=(0,o.zo)(a,e)}catch(e){a=void 0,i=!1}}catch(e){throw await(r?.handleChainError(e)),e}await(r?.handleChainEnd(f(a,"output")))}pipe(e){return v.isRunnableSequence(e)?new v({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new v({first:this.first,middle:[...this.middle,this.last],last:E(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&g.isRunnable(e)}static from([e,...t],n){return new v({first:E(e),middle:t.slice(0,-1).map(E),last:E(t[t.length-1]),name:n})}}class w extends g{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,n]of Object.entries(e.steps))this.steps[t]=E(n)}static from(e){return new w({steps:e})}async invoke(e,t){const n=await(0,h.Le)(t),r=await(n?.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,t?.runName)),s={};try{await Promise.all(Object.entries(this.steps).map((async([n,a])=>{s[n]=await a.invoke(e,(0,h.q)(t,{callbacks:r?.getChild(`map:key:${n}`)}))})))}catch(e){throw await(r?.handleChainError(e)),e}return await(r?.handleChainEnd(s)),s}async*_transform(e,t,n){const r={...this.steps},s=(0,o.y2)(e,Object.keys(r).length),a=new Map(Object.entries(r).map((([e,r],a)=>{const i=r.transform(s[a],(0,h.q)(n,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,i.next().then((t=>({key:e,gen:i,result:t})))]})));for(;a.size;){const{key:e,result:t,gen:n}=await Promise.race(a.values());a.delete(e),t.done||(yield{[e]:t.value},a.set(e,n.next().then((t=>({key:e,gen:n,result:t})))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new o.qq(this.transform(async function*(){yield e}(),t));return await n.setup,o.QJ.fromAsyncGenerator(n)}}class x extends g{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new x({func:e})}async _invoke(e,t,n){let r=await this.func(e,{config:t});if(r&&g.isRunnable(r)){if(0===t?.recursionLimit)throw new Error("Recursion limit reached.");r=await r.invoke(e,(0,h.q)(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??h.ov)-1}))}return r}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,n){let r;for await(const t of e)if(void 0===r)r=t;else try{r=(0,o.zo)(r,t)}catch(e){r=t}const s=await this.func(r,{config:n});if(s&&g.isRunnable(s)){if(0===n?.recursionLimit)throw new Error("Recursion limit reached.");const e=await s.stream(r,(0,h.q)(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??h.ov)-1}));for await(const t of e)yield t}else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new o.qq(this.transform(async function*(){yield e}(),t));return await n.setup,o.QJ.fromAsyncGenerator(n)}}class k extends g{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=await s.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),r=await(n?.handleChainStart(this.toJSON(),f(e,"input"),void 0,void 0,void 0,void 0,t?.runName));let a;for(const n of this.runnables())try{const s=await n.invoke(e,(0,h.q)(t,{callbacks:r?.getChild()}));return await(r?.handleChainEnd(f(s,"output"))),s}catch(e){void 0===a&&(a=e)}if(void 0===a)throw new Error("No error stored at end of fallback.");throw await(r?.handleChainError(a)),a}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),a=await Promise.all(r.map((e=>s.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)))),i=await Promise.all(a.map(((t,n)=>t?.handleChainStart(this.toJSON(),f(e[n],"input"),void 0,void 0,void 0,void 0,r[n].runName))));let o;for(const t of this.runnables())try{const s=await t.batch(e,i.map(((e,t)=>(0,h.q)(r[t],{callbacks:e?.getChild()}))),n);return await Promise.all(i.map(((e,t)=>e?.handleChainEnd(f(s[t],"output"))))),s}catch(e){void 0===o&&(o=e)}if(!o)throw new Error("No error stored at end of fallbacks.");throw await Promise.all(i.map((e=>e?.handleChainError(o)))),o}}function E(e){if("function"==typeof e)return new x({func:e});if(g.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw new Error("Expected a Runnable, function or object.\nInstead got an unsupported type.");{const t={};for(const[n,r]of Object.entries(e))t[n]=E(r);return new w({steps:t})}}class O extends g{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof w&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const r=this.mapper.getStepsKeys(),[s,a]=(0,o.y2)(e),i=this.mapper.transform(a,(0,h.q)(n,{callbacks:t?.getChild()})),l=i.next();for await(const e of s){if("object"!=typeof e||Array.isArray(e))throw new Error("RunnableAssign can only be used with objects as input, got "+typeof e);const t=Object.fromEntries(Object.entries(e).filter((([e])=>!r.includes(e))));Object.keys(t).length>0&&(yield t)}yield(await l).value;for await(const e of i)yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new o.qq(this.transform(async function*(){yield e}(),t));return await n.setup,o.QJ.fromAsyncGenerator(n)}}class A extends g{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{const t=this.keys.map((t=>[t,e[t]])).filter((e=>void 0!==e[1]));return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){const n=new o.qq(this.transform(async function*(){yield e}(),t));return await n.setup,o.QJ.fromAsyncGenerator(n)}}},7798:(e,t,n)=>{"use strict";n.d(t,{LE:()=>l,Le:()=>a,ov:()=>s,q:()=>c,t8:()=>i});var r=n(9205);const s=25;async function a(e){return r.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function i(...e){const t=l();for(const n of e.filter((e=>!!e)))for(const e of Object.keys(n))if("metadata"===e)t[e]={...t[e],...n[e]};else if("tags"===e)t[e]=[...new Set(t[e].concat(n[e]??[]))];else if("configurable"===e)t[e]={...t[e],...n[e]};else if("callbacks"===e){const e=t.callbacks,s=n.callbacks;if(Array.isArray(s))if(e)if(Array.isArray(e))t.callbacks=e.concat(s);else{const n=e.copy();for(const e of s)n.addHandler((0,r.xz)(e),!0);t.callbacks=n}else t.callbacks=s;else if(s)if(e)if(Array.isArray(e)){const n=s.copy();for(const t of e)n.addHandler((0,r.xz)(t),!0);t.callbacks=n}else t.callbacks=new r.Ye(s._parentRunId,{handlers:e.handlers.concat(s.handlers),inheritableHandlers:e.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(s.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(s.inheritableTags))),metadata:{...e.metadata,...s.metadata}});else t.callbacks=s}else{const r=e;t[r]=n[r]??t[r]}return t}const o=new Set(["string","number","boolean"]);function l(e){let t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25};if(e&&(t={...t,...e}),e?.configurable)for(const n of Object.keys(e.configurable))o.has(typeof e.configurable[n])&&!t.metadata?.[n]&&(t.metadata||(t.metadata={}),t.metadata[n]=e.configurable[n]);return t}function c(e={},{callbacks:t,maxConcurrency:n,recursionLimit:r,runName:s,configurable:a}={}){const i=l(e);return void 0!==t&&(delete i.runName,i.callbacks=t),void 0!==r&&(i.recursionLimit=r),void 0!==n&&(i.maxConcurrency=n),void 0!==s&&(i.runName=s),void 0!==a&&(i.configurable={...i.configurable,...a}),i}},4075:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(6515);function s(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class a extends r.E{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){const t=(n=e.start_time,r=e.id,`${new Date(n).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+r);var n,r;const s={...e};if(void 0!==s.parent_run_id){const e=this.runMap.get(s.parent_run_id);e&&(this._addChildRun(e,s),e.child_execution_order=Math.max(e.child_execution_order,s.child_execution_order),s.trace_id=e.trace_id,void 0!==e.dotted_order&&(s.dotted_order=[e.dotted_order,t].join(".")))}else s.trace_id=s.id,s.dotted_order=t;this.runMap.set(s.id,s),await(this.onRunCreate?.(s))}async _endTrace(e){const t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await(this.onRunUpdate?.(e))}_getExecutionOrder(e){const t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,n,r,s,a,i,o){const l=this._getExecutionOrder(r),c=Date.now(),u=i?{...s,metadata:i}:s,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:a||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleChatModelStart(e,t,n,r,s,a,i,o){const l=this._getExecutionOrder(r),c=Date.now(),u=i?{...s,metadata:i}:s,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:a||[]};return await this._startTrace(d),await(this.onLLMStart?.(d)),d}async handleLLMEnd(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onLLMEnd?.(n)),await this._endTrace(n),n}async handleLLMError(e,t){const n=this.runMap.get(t);if(!n||"llm"!==n?.run_type)throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=e.message,n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onLLMError?.(n)),await this._endTrace(n),n}async handleChainStart(e,t,n,r,s,a,i,o){const l=this._getExecutionOrder(r),c=Date.now(),u={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:i??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(u),await(this.onChainStart?.(u)),u}async handleChainEnd(e,t,n,r,a){const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=s(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),void 0!==a?.inputs&&(i.inputs=s(a.inputs,"input")),await(this.onChainEnd?.(i)),await this._endTrace(i),i}async handleChainError(e,t,n,r,a){const i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=e.message+(e?.stack?`\n\n${e.stack}`:""),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),void 0!==a?.inputs&&(i.inputs=s(a.inputs,"input")),await(this.onChainError?.(i)),await this._endTrace(i),i}async handleToolStart(e,t,n,r,s,a,i){const o=this._getExecutionOrder(r),l=Date.now(),c={id:n,name:i??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(c),await(this.onToolStart?.(c)),c}async handleToolEnd(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onToolEnd?.(n)),await this._endTrace(n),n}async handleToolError(e,t){const n=this.runMap.get(t);if(!n||"tool"!==n?.run_type)throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=e.message,n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onToolError?.(n)),await this._endTrace(n),n}async handleAgentAction(e,t){const n=this.runMap.get(t);if(!n||"chain"!==n?.run_type)return;const r=n;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentAction?.(n))}async handleAgentEnd(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"agent_end",time:(new Date).toISOString(),kwargs:{action:e}}),await(this.onAgentEnd?.(n)))}async handleRetrieverStart(e,t,n,r,s,a,i){const o=this._getExecutionOrder(r),l=Date.now(),c={id:n,name:i??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return await this._startTrace(c),await(this.onRetrieverStart?.(c)),c}async handleRetrieverEnd(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverEnd?.(n)),await this._endTrace(n),n}async handleRetrieverError(e,t){const n=this.runMap.get(t);if(!n||"retriever"!==n?.run_type)throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=e.message,n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await(this.onRetrieverError?.(n)),await this._endTrace(n),n}async handleText(e,t){const n=this.runMap.get(t);n&&"chain"===n?.run_type&&(n.events.push({name:"text",time:(new Date).toISOString(),kwargs:{text:e}}),await(this.onText?.(n)))}async handleLLMNewToken(e,t,n,r,s,a){const i=this.runMap.get(n);if(!i||"llm"!==i?.run_type)throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return i.events.push({name:"new_token",time:(new Date).toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await(this.onLLMNewToken?.(i,e)),i}}},9636:(e,t,n)=>{"use strict";n.d(t,{L:()=>o});var r=n(2693),s=n(5860);const a=[400,401,402,403,404,405,406,407,408,409],i=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name)throw e;if("ECONNABORTED"===e?.code)throw e;const t=e?.response?.status??e?.status;if(t&&a.includes(+t))throw e;if("insufficient_quota"===e?.error?.code){const t=new Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??i;const t=s.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add((()=>r((()=>e(...t).catch((e=>{throw e instanceof Error?e:new Error(e)}))),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0})),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise(((t,n)=>{e.signal?.addEventListener("abort",(()=>{n(new Error("AbortError"))}))}))]):this.call(t,...n)}fetch(...e){return this.call((()=>fetch(...e).then((e=>e.ok?e:Promise.reject(e)))))}}},6374:(e,t,n)=>{"use strict";n.d(t,{lS:()=>o,sA:()=>i});const r=()=>"undefined"!=typeof Deno,s=()=>{let e;return e="undefined"!=typeof window&&void 0!==window.document?"browser":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||r()?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"))?"jsdom":r()?"deno":"other":"node",e};let a;async function i(){if(void 0===a){const e=s();a={library:"langchain-js",runtime:e}}return a}function o(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}},344:(e,t,n)=>{"use strict";n.d(t,{af:()=>b,qu:()=>O});var r={};n.r(r),n.d(r,{JsonPatchError:()=>p,_areEquals:()=>k,applyOperation:()=>_,applyPatch:()=>b,applyReducer:()=>v,deepClone:()=>m,getValueByPointer:()=>y,validate:()=>x,validator:()=>w});const s=Object.prototype.hasOwnProperty;function a(e,t){return s.call(e,t)}function i(e){if(Array.isArray(e)){const t=new Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let n in e)a(e,n)&&t.push(n);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t=0;const n=e.length;let r;for(;t<n;){if(r=e.charCodeAt(t),!(r>=48&&r<=57))return!1;t++}return!0}function c(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function u(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(u(e[t]))return!0}else if("object"==typeof e){const n=i(e),r=n.length;for(var t=0;t<r;t++)if(u(e[n[t]]))return!0}return!1}function d(e,t){const n=[e];for(const e in t){const r="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==r&&n.push(`${e}: ${r}`)}return n.join("\n")}class h extends Error{constructor(e,t,n,r,s){super(d(e,{name:t,index:n,operation:r,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=d(e,{name:t,index:n,operation:r,tree:s})}}const p=h,m=o,f={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){let r=y(n,this.path);r&&(r=o(r));const s=_(n,{op:"remove",path:this.from}).removed;return _(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(e,t,n){const r=y(n,this.from);return _(n,{op:"add",path:this.path,value:o(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:k(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};var g={add:function(e,t,n){return l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:f.move,copy:f.copy,test:f.test,_get:f._get};function y(e,t){if(""==t)return e;var n={op:"_get",path:t};return _(e,n),n.value}function _(e,t,n=!1,r=!0,s=!0,a=0){if(n&&("function"==typeof n?n(t,0,e,t.path):w(t,0)),""===t.path){let r={newDocument:e};if("add"===t.op)return r.newDocument=t.value,r;if("replace"===t.op)return r.newDocument=t.value,r.removed=e,r;if("move"===t.op||"copy"===t.op)return r.newDocument=y(e,t.from),"move"===t.op&&(r.removed=e),r;if("test"===t.op){if(r.test=k(e,t.value),!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r.newDocument=e,r}if("remove"===t.op)return r.removed=e,r.newDocument=null,r;if("_get"===t.op)return t.value=e,r;if(n)throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return r}{r||(e=o(e));const i=(t.path||"").split("/");let c,u,d,h=e,m=1,y=i.length;for(d="function"==typeof n?n:w;;){if(u=i[m],u&&-1!=u.indexOf("~")&&(u=u.replace(/~1/g,"/").replace(/~0/g,"~")),s&&("__proto__"==u||"prototype"==u&&m>0&&"constructor"==i[m-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===c&&(void 0===h[u]?c=i.slice(0,m).join("/"):m==y-1&&(c=t.path),void 0!==c&&d(t,0,e,c)),m++,Array.isArray(h)){if("-"===u)u=h.length;else{if(n&&!l(u))throw new p("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);l(u)&&(u=~~u)}if(m>=y){if(n&&"add"===t.op&&u>h.length)throw new p("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);const r=g[t.op].call(t,h,u,e);if(!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}}else if(m>=y){const n=f[t.op].call(t,h,u,e);if(!1===n.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return n}if(h=h[u],n&&m<y&&(!h||"object"!=typeof h))throw new p("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function b(e,t,n,r=!0,s=!0){if(n&&!Array.isArray(t))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=o(e));const a=new Array(t.length);for(let r=0,i=t.length;r<i;r++)a[r]=_(e,t[r],n,!0,s,r),e=a[r].newDocument;return a.newDocument=e,a}function v(e,t,n){const r=_(e,t);if(!1===r.test)throw new p("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function w(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new p("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!f[e.op])throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new p("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new p('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new p("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&u(e.value))throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var s=e.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new p("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new p("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var i=x([{op:"_get",path:e.from,value:void 0}],n);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new p("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function x(e,t,n){try{if(!Array.isArray(e))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)b(o(t),o(e),n||!0);else{n=n||w;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof p)return e;throw e}}function k(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,s,a=Array.isArray(e),i=Array.isArray(t);if(a&&i){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!k(e[n],t[n]))return!1;return!0}if(a!=i)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!=n--;)if(!k(e[s=o[n]],t[s]))return!1;return!0}return e!=e&&t!=t}function E(e,t,n,r,s){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var l=i(t),u=i(e),d=!1,h=u.length-1;h>=0;h--){var p=e[f=u[h]];if(!a(t,f)||void 0===t[f]&&void 0!==p&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(s&&n.push({op:"test",path:r+"/"+c(f),value:o(p)}),n.push({op:"remove",path:r+"/"+c(f)}),d=!0):(s&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var m=t[f];"object"==typeof p&&null!=p&&"object"==typeof m&&null!=m&&Array.isArray(p)===Array.isArray(m)?E(p,m,n,r+"/"+c(f),s):p!==m&&(s&&n.push({op:"test",path:r+"/"+c(f),value:o(p)}),n.push({op:"replace",path:r+"/"+c(f),value:o(m)}))}}if(d||l.length!=u.length)for(h=0;h<l.length;h++){var f;a(e,f=l[h])||void 0===t[f]||n.push({op:"add",path:r+"/"+c(f),value:o(t[f])})}}}function O(e,t,n=!1){var r=[];return E(e,t,r,"",n),r}new WeakMap},6076:(e,t,n)=>{"use strict";n.d(t,{E7:()=>o,QJ:()=>r,qq:()=>i,y2:()=>s,zo:()=>a});class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new r({start:e=>function n(){return t.read().then((({done:t,value:r})=>{if(!t)return e.enqueue(r),n();e.close()}))}(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){const{value:n,done:r}=await e.next();r&&t.close(),t.enqueue(n)}})}}function s(e,t=2){const n=Array.from({length:t},(()=>[]));return n.map((async function*(t){for(;;)if(0===t.length){const t=await e.next();for(const e of n)e.push(t)}else{if(t[0].done)return;yield t.shift().value}}))}function a(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){const n={...e};for(const[e,r]of Object.entries(t))n[e]=e in n?a(n[e],r):r;return n}throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}class i{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise(((n,r)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(n,r):this.firstResult.then((e=>n(void 0)),r)}))}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}async function o(e,t,n,...r){const s=new i(t,n),a=await s.setup;return{output:e(s,a,...r),setup:a}}},7441:(e,t,n)=>{"use strict";n.d(t,{TU:()=>ue});let r={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function s(e){r=e}const a=/[&<>"']/,i=new RegExp(a.source,"g"),o=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,l=new RegExp(o.source,"g"),c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},u=e=>c[e];function d(e,t){if(t){if(a.test(e))return e.replace(i,u)}else if(o.test(e))return e.replace(l,u);return e}const h=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function p(e){return e.replace(h,((e,t)=>"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const m=/(^|[^\[])\^/g;function f(e,t){let n="string"==typeof e?e:e.source;t=t||"";const r={replace:(e,t)=>{let s="string"==typeof t?t:t.source;return s=s.replace(m,"$1"),n=n.replace(e,s),r},getRegex:()=>new RegExp(n,t)};return r}function g(e){try{e=encodeURI(e).replace(/%25/g,"%")}catch(e){return null}return e}const y={exec:()=>null};function _(e,t){const n=e.replace(/\|/g,((e,t,n)=>{let r=!1,s=t;for(;--s>=0&&"\\"===n[s];)r=!r;return r?"|":" |"})).split(/ \|/);let r=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(/\\\|/g,"|");return n}function b(e,t,n){const r=e.length;if(0===r)return"";let s=0;for(;s<r;){const a=e.charAt(r-s-1);if(a!==t||n){if(a===t||!n)break;s++}else s++}return e.slice(0,r-s)}function v(e,t,n,r){const s=t.href,a=t.title?d(t.title):null,i=e[1].replace(/\\([\[\]])/g,"$1");if("!"!==e[0].charAt(0)){r.state.inLink=!0;const e={type:"link",raw:n,href:s,title:a,text:i,tokens:r.inlineTokens(i)};return r.state.inLink=!1,e}return{type:"image",raw:n,href:s,title:a,text:d(i)}}class w{options;rules;lexer;constructor(e){this.options=e||r}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:b(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],n=function(e,t){const n=e.match(/^(\s+)(?:```)/);if(null===n)return t;const r=n[1];return t.split("\n").map((e=>{const t=e.match(/^\s+/);if(null===t)return e;const[n]=t;return n.length>=r.length?e.slice(r.length):e})).join("\n")}(e,t[3]||"");return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(/#$/.test(e)){const t=b(e,"#");this.options.pedantic?e=t.trim():t&&!/ $/.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const e=b(t[0].replace(/^ *>[ \t]?/gm,""),"\n"),n=this.lexer.state.top;this.lexer.state.top=!0;const r=this.lexer.blockTokens(e);return this.lexer.state.top=n,{type:"blockquote",raw:t[0],tokens:r,text:e}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const r=n.length>1,s={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");const a=new RegExp(`^( {0,3}${n})((?:[\t ][^\\n]*)?(?:\\n|$))`);let i="",o="",l=!1;for(;e;){let n=!1;if(!(t=a.exec(e)))break;if(this.rules.block.hr.test(e))break;i=t[0],e=e.substring(i.length);let r=t[2].split("\n",1)[0].replace(/^\t+/,(e=>" ".repeat(3*e.length))),c=e.split("\n",1)[0],u=0;this.options.pedantic?(u=2,o=r.trimStart()):(u=t[2].search(/[^ ]/),u=u>4?1:u,o=r.slice(u),u+=t[1].length);let d=!1;if(!r&&/^ *$/.test(c)&&(i+=c+"\n",e=e.substring(c.length+1),n=!0),!n){const t=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),n=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),s=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),a=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e;){const l=e.split("\n",1)[0];if(c=l,this.options.pedantic&&(c=c.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),s.test(c))break;if(a.test(c))break;if(t.test(c))break;if(n.test(e))break;if(c.search(/[^ ]/)>=u||!c.trim())o+="\n"+c.slice(u);else{if(d)break;if(r.search(/[^ ]/)>=4)break;if(s.test(r))break;if(a.test(r))break;if(n.test(r))break;o+="\n"+c}d||c.trim()||(d=!0),i+=l+"\n",e=e.substring(l.length+1),r=c.slice(u)}}s.loose||(l?s.loose=!0:/\n *\n *$/.test(i)&&(l=!0));let h,p=null;this.options.gfm&&(p=/^\[[ xX]\] /.exec(o),p&&(h="[ ] "!==p[0],o=o.replace(/^\[[ xX]\] +/,""))),s.items.push({type:"list_item",raw:i,task:!!p,checked:h,loose:!1,text:o,tokens:[]}),s.raw+=i}s.items[s.items.length-1].raw=i.trimEnd(),s.items[s.items.length-1].text=o.trimEnd(),s.raw=s.raw.trimEnd();for(let e=0;e<s.items.length;e++)if(this.lexer.state.top=!1,s.items[e].tokens=this.lexer.blockTokens(s.items[e].text,[]),!s.loose){const t=s.items[e].tokens.filter((e=>"space"===e.type)),n=t.length>0&&t.some((e=>/\n.*\n/.test(e.raw)));s.loose=n}if(s.loose)for(let e=0;e<s.items.length;e++)s.items[e].loose=!0;return s}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(/\s+/g," "),n=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:r}}}table(e){const t=this.rules.block.table.exec(e);if(!t)return;if(!/[:|]/.test(t[2]))return;const n=_(t[1]),r=t[2].replace(/^\||\| *$/g,"").split("|"),s=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split("\n"):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===r.length){for(const e of r)/^ *-+: *$/.test(e)?a.align.push("right"):/^ *:-+: *$/.test(e)?a.align.push("center"):/^ *:-+ *$/.test(e)?a.align.push("left"):a.align.push(null);for(const e of n)a.header.push({text:e,tokens:this.lexer.inline(e)});for(const e of s)a.rows.push(_(e,a.header.length).map((e=>({text:e,tokens:this.lexer.inline(e)}))));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:d(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&/^</.test(e)){if(!/>$/.test(e))return;const t=b(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let r=0;r<e.length;r++)if("\\"===e[r])r++;else if(e[r]===t[0])n++;else if(e[r]===t[1]&&(n--,n<0))return r;return-1}(t[2],"()");if(e>-1){const n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],r="";if(this.options.pedantic){const e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(n);e&&(n=e[1],r=e[3])}else r=t[3]?t[3].slice(1,-1):"";return n=n.trim(),/^</.test(n)&&(n=this.options.pedantic&&!/>$/.test(e)?n.slice(1):n.slice(1,-1)),v(t,{href:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n,title:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const e=t[(n[2]||n[1]).replace(/\s+/g," ").toLowerCase()];if(!e){const e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return v(n,e,n[0],this.lexer)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(r&&(!r[3]||!n.match(/[\p{L}\p{N}]/u))&&(!r[1]&&!r[2]||!n||this.rules.inline.punctuation.exec(n))){const n=[...r[0]].length-1;let s,a,i=n,o=0;const l="*"===r[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+n);null!=(r=l.exec(t));){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(a=[...s].length,r[3]||r[4]){i+=a;continue}if((r[5]||r[6])&&n%3&&!((n+a)%3)){o+=a;continue}if(i-=a,i>0)continue;a=Math.min(a,a+i+o);const t=[...r[0]][0].length,l=e.slice(0,n+r.index+t+a);if(Math.min(n,a)%2){const e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}const c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(/\n/g," ");const n=/[^ ]/.test(e),r=/^ /.test(e)&&/ $/.test(e);return n&&r&&(e=e.substring(1,e.length-1)),e=d(e,!0),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=d(t[1]),n="mailto:"+e):(e=d(t[1]),n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,n;if("@"===t[2])e=d(t[0]),n="mailto:"+e;else{let r;do{r=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??""}while(r!==t[0]);e=d(t[0]),n="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let e;return e=this.lexer.state.inRawBlock?t[0]:d(t[0]),{type:"text",raw:t[0],text:e}}}}const x=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,k=/(?:[*+-]|\d{1,9}[.)])/,E=f(/^(?!bull )((?:.|\n(?!\s*?\n|bull ))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,k).getRegex(),O=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,A=/(?!\s*\])(?:\\.|[^\[\]\\])+/,T=f(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",A).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),P=f(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,k).getRegex(),I="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",S=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,C=f("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",S).replace("tag",I).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),N=f(O).replace("hr",x).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",I).getRegex(),R={blockquote:f(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",N).getRegex(),code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,def:T,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:x,html:C,lheading:E,list:P,newline:/^(?: *(?:\n|$))+/,paragraph:N,table:y,text:/^[^\n]+/},j=f("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",x).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",I).getRegex(),$={...R,table:j,paragraph:f(O).replace("hr",x).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",j).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",I).getRegex()},M={...R,html:f("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",S).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:y,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:f(O).replace("hr",x).replace("heading"," *#{1,6} *[^\n]").replace("lheading",E).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},L=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,B=/^( {2,}|\\)\n(?!\s*$)/,U="\\p{P}$+<=>`^|~",D=f(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,U).getRegex(),z=f(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,U).getRegex(),Z=f("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,U).getRegex(),q=f("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,U).getRegex(),F=f(/\\([punct])/,"gu").replace(/punct/g,U).getRegex(),H=f(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),K=f(S).replace("(?:--\x3e|$)","--\x3e").getRegex(),V=f("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",K).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),G=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,W=f(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",G).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),J=f(/^!?\[(label)\]\[(ref)\]/).replace("label",G).replace("ref",A).getRegex(),Y=f(/^!?\[(ref)\](?:\[\])?/).replace("ref",A).getRegex(),X={_backpedal:y,anyPunctuation:F,autolink:H,blockSkip:/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,br:B,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:y,emStrongLDelim:z,emStrongRDelimAst:Z,emStrongRDelimUnd:q,escape:L,link:W,nolink:Y,punctuation:D,reflink:J,reflinkSearch:f("reflink|nolink(?!\\()","g").replace("reflink",J).replace("nolink",Y).getRegex(),tag:V,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:y},Q={...X,link:f(/^!?\[(label)\]\((.*?)\)/).replace("label",G).getRegex(),reflink:f(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",G).getRegex()},ee={...X,escape:f(L).replace("])","~|])").getRegex(),url:f(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},te={...ee,br:f(B).replace("{2,}","*").getRegex(),text:f(ee.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ne={normal:R,gfm:$,pedantic:M},re={normal:X,gfm:ee,breaks:te,pedantic:Q};class se{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||r,this.options.tokenizer=this.options.tokenizer||new w,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:ne.normal,inline:re.normal};this.options.pedantic?(t.block=ne.pedantic,t.inline=re.pedantic):this.options.gfm&&(t.block=ne.gfm,this.options.breaks?t.inline=re.breaks:t.inline=re.gfm),this.tokenizer.rules=t}static get rules(){return{block:ne,inline:re}}static lex(e,t){return new se(t).lex(e)}static lexInline(e,t){return new se(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[]){let n,r,s,a;for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,((e,t,n)=>t+"    ".repeat(n.length)));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some((r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0)))))if(n=this.tokenizer.space(e))e=e.substring(n.raw.length),1===n.raw.length&&t.length>0?t[t.length-1].raw+="\n":t.push(n);else if(n=this.tokenizer.code(e))e=e.substring(n.raw.length),r=t[t.length-1],!r||"paragraph"!==r.type&&"text"!==r.type?t.push(n):(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(n=this.tokenizer.fences(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.heading(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.hr(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.blockquote(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.list(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.html(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.def(e))e=e.substring(n.raw.length),r=t[t.length-1],!r||"paragraph"!==r.type&&"text"!==r.type?this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title}):(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(n=this.tokenizer.table(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.lheading(e))e=e.substring(n.raw.length),t.push(n);else{if(s=e,this.options.extensions&&this.options.extensions.startBlock){let t=1/0;const n=e.slice(1);let r;this.options.extensions.startBlock.forEach((e=>{r=e.call({lexer:this},n),"number"==typeof r&&r>=0&&(t=Math.min(t,r))})),t<1/0&&t>=0&&(s=e.substring(0,t+1))}if(this.state.top&&(n=this.tokenizer.paragraph(s)))r=t[t.length-1],a&&"paragraph"===r.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n),a=s.length!==e.length,e=e.substring(n.raw.length);else if(n=this.tokenizer.text(e))e=e.substring(n.raw.length),r=t[t.length-1],r&&"text"===r.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(n);else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,r,s,a,i,o,l=e;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(a=this.tokenizer.rules.inline.reflinkSearch.exec(l));)e.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(a=this.tokenizer.rules.inline.blockSkip.exec(l));)l=l.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(a=this.tokenizer.rules.inline.anyPunctuation.exec(l));)l=l.slice(0,a.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(i||(o=""),i=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some((r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0)))))if(n=this.tokenizer.escape(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.tag(e))e=e.substring(n.raw.length),r=t[t.length-1],r&&"text"===n.type&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);else if(n=this.tokenizer.link(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(n.raw.length),r=t[t.length-1],r&&"text"===n.type&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);else if(n=this.tokenizer.emStrong(e,l,o))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.codespan(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.br(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.del(e))e=e.substring(n.raw.length),t.push(n);else if(n=this.tokenizer.autolink(e))e=e.substring(n.raw.length),t.push(n);else if(this.state.inLink||!(n=this.tokenizer.url(e))){if(s=e,this.options.extensions&&this.options.extensions.startInline){let t=1/0;const n=e.slice(1);let r;this.options.extensions.startInline.forEach((e=>{r=e.call({lexer:this},n),"number"==typeof r&&r>=0&&(t=Math.min(t,r))})),t<1/0&&t>=0&&(s=e.substring(0,t+1))}if(n=this.tokenizer.inlineText(s))e=e.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(o=n.raw.slice(-1)),i=!0,r=t[t.length-1],r&&"text"===r.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}else e=e.substring(n.raw.length),t.push(n);return t}}class ae{options;constructor(e){this.options=e||r}code(e,t,n){const r=(t||"").match(/^\S*/)?.[0];return e=e.replace(/\n$/,"")+"\n",r?'<pre><code class="language-'+d(r)+'">'+(n?e:d(e,!0))+"</code></pre>\n":"<pre><code>"+(n?e:d(e,!0))+"</code></pre>\n"}blockquote(e){return`<blockquote>\n${e}</blockquote>\n`}html(e,t){return e}heading(e,t,n){return`<h${t}>${e}</h${t}>\n`}hr(){return"<hr>\n"}list(e,t,n){const r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+r+">\n"}listitem(e,t,n){return`<li>${e}</li>\n`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>\n`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),"<table>\n<thead>\n"+e+"</thead>\n"+t+"</table>\n"}tablerow(e){return`<tr>\n${e}</tr>\n`}tablecell(e,t){const n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>\n`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,n){const r=g(e);if(null===r)return n;let s='<a href="'+(e=r)+'"';return t&&(s+=' title="'+t+'"'),s+=">"+n+"</a>",s}image(e,t,n){const r=g(e);if(null===r)return n;let s=`<img src="${e=r}" alt="${n}"`;return t&&(s+=` title="${t}"`),s+=">",s}text(e){return e}}class ie{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,n){return""+n}image(e,t,n){return""+n}br(){return""}}class oe{options;renderer;textRenderer;constructor(e){this.options=e||r,this.options.renderer=this.options.renderer||new ae,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ie}static parse(e,t){return new oe(t).parse(e)}static parseInline(e,t){return new oe(t).parseInline(e)}parse(e,t=!0){let n="";for(let r=0;r<e.length;r++){const s=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const e=s,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){n+=t||"";continue}}switch(s.type){case"space":continue;case"hr":n+=this.renderer.hr();continue;case"heading":{const e=s;n+=this.renderer.heading(this.parseInline(e.tokens),e.depth,p(this.parseInline(e.tokens,this.textRenderer)));continue}case"code":{const e=s;n+=this.renderer.code(e.text,e.lang,!!e.escaped);continue}case"table":{const e=s;let t="",r="";for(let t=0;t<e.header.length;t++)r+=this.renderer.tablecell(this.parseInline(e.header[t].tokens),{header:!0,align:e.align[t]});t+=this.renderer.tablerow(r);let a="";for(let t=0;t<e.rows.length;t++){const n=e.rows[t];r="";for(let t=0;t<n.length;t++)r+=this.renderer.tablecell(this.parseInline(n[t].tokens),{header:!1,align:e.align[t]});a+=this.renderer.tablerow(r)}n+=this.renderer.table(t,a);continue}case"blockquote":{const e=s,t=this.parse(e.tokens);n+=this.renderer.blockquote(t);continue}case"list":{const e=s,t=e.ordered,r=e.start,a=e.loose;let i="";for(let t=0;t<e.items.length;t++){const n=e.items[t],r=n.checked,s=n.task;let o="";if(n.task){const e=this.renderer.checkbox(!!r);a?n.tokens.length>0&&"paragraph"===n.tokens[0].type?(n.tokens[0].text=e+" "+n.tokens[0].text,n.tokens[0].tokens&&n.tokens[0].tokens.length>0&&"text"===n.tokens[0].tokens[0].type&&(n.tokens[0].tokens[0].text=e+" "+n.tokens[0].tokens[0].text)):n.tokens.unshift({type:"text",text:e+" "}):o+=e+" "}o+=this.parse(n.tokens,a),i+=this.renderer.listitem(o,s,!!r)}n+=this.renderer.list(i,t,r);continue}case"html":{const e=s;n+=this.renderer.html(e.text,e.block);continue}case"paragraph":{const e=s;n+=this.renderer.paragraph(this.parseInline(e.tokens));continue}case"text":{let a=s,i=a.tokens?this.parseInline(a.tokens):a.text;for(;r+1<e.length&&"text"===e[r+1].type;)a=e[++r],i+="\n"+(a.tokens?this.parseInline(a.tokens):a.text);n+=t?this.renderer.paragraph(i):i;continue}default:{const e='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let r=0;r<e.length;r++){const s=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]){const e=this.options.extensions.renderers[s.type].call({parser:this},s);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){n+=e||"";continue}}switch(s.type){case"escape":{const e=s;n+=t.text(e.text);break}case"html":{const e=s;n+=t.html(e.text);break}case"link":{const e=s;n+=t.link(e.href,e.title,this.parseInline(e.tokens,t));break}case"image":{const e=s;n+=t.image(e.href,e.title,e.text);break}case"strong":{const e=s;n+=t.strong(this.parseInline(e.tokens,t));break}case"em":{const e=s;n+=t.em(this.parseInline(e.tokens,t));break}case"codespan":{const e=s;n+=t.codespan(e.text);break}case"br":n+=t.br();break;case"del":{const e=s;n+=t.del(this.parseInline(e.tokens,t));break}case"text":{const e=s;n+=t.text(e.text);break}default:{const e='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}}class le{options;constructor(e){this.options=e||r}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}}const ce=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.#e(se.lex,oe.parse);parseInline=this.#e(se.lexInline,oe.parseInline);Parser=oe;Renderer=ae;TextRenderer=ie;Lexer=se;Tokenizer=w;Hooks=le;constructor(...e){this.use(...e)}walkTokens(e,t){let n=[];for(const r of e)switch(n=n.concat(t.call(this,r)),r.type){case"table":{const e=r;for(const r of e.header)n=n.concat(this.walkTokens(r.tokens,t));for(const r of e.rows)for(const e of r)n=n.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=r;n=n.concat(this.walkTokens(e.items,t));break}default:{const e=r;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach((r=>{const s=e[r].flat(1/0);n=n.concat(this.walkTokens(s,t))})):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const n={...e};if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const n=t.renderers[e.name];t.renderers[e.name]=n?function(...t){let r=e.renderer.apply(this,t);return!1===r&&(r=n.apply(this,t)),r}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const n=t[e.level];n?n.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),n.extensions=t),e.renderer){const t=this.defaults.renderer||new ae(this.defaults);for(const n in e.renderer){if(!(n in t))throw new Error(`renderer '${n}' does not exist`);if("options"===n)continue;const r=n,s=e.renderer[r],a=t[r];t[r]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=a.apply(t,e)),n||""}}n.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new w(this.defaults);for(const n in e.tokenizer){if(!(n in t))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const r=n,s=e.tokenizer[r],a=t[r];t[r]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=a.apply(t,e)),n}}n.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new le;for(const n in e.hooks){if(!(n in t))throw new Error(`hook '${n}' does not exist`);if("options"===n)continue;const r=n,s=e.hooks[r],a=t[r];le.passThroughHooks.has(n)?t[r]=e=>{if(this.defaults.async)return Promise.resolve(s.call(t,e)).then((e=>a.call(t,e)));const n=s.call(t,e);return a.call(t,n)}:t[r]=(...e)=>{let n=s.apply(t,e);return!1===n&&(n=a.apply(t,e)),n}}n.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,r=e.walkTokens;n.walkTokens=function(e){let n=[];return n.push(r.call(this,e)),t&&(n=n.concat(t.call(this,e))),n}}this.defaults={...this.defaults,...n}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return se.lex(e,t??this.defaults)}parser(e,t){return oe.parse(e,t??this.defaults)}#e(e,t){return(n,r)=>{const s={...r},a={...this.defaults,...s};!0===this.defaults.async&&!1===s.async&&(a.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),a.async=!0);const i=this.#t(!!a.silent,!!a.async);if(null==n)return i(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof n)return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(a.hooks&&(a.hooks.options=a),a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(n):n).then((t=>e(t,a))).then((e=>a.hooks?a.hooks.processAllTokens(e):e)).then((e=>a.walkTokens?Promise.all(this.walkTokens(e,a.walkTokens)).then((()=>e)):e)).then((e=>t(e,a))).then((e=>a.hooks?a.hooks.postprocess(e):e)).catch(i);try{a.hooks&&(n=a.hooks.preprocess(n));let r=e(n,a);a.hooks&&(r=a.hooks.processAllTokens(r)),a.walkTokens&&this.walkTokens(r,a.walkTokens);let s=t(r,a);return a.hooks&&(s=a.hooks.postprocess(s)),s}catch(e){return i(e)}}}#t(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+d(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}}};function ue(e,t){return ce.parse(e,t)}ue.options=ue.setOptions=function(e){return ce.setOptions(e),ue.defaults=ce.defaults,s(ue.defaults),ue},ue.getDefaults=function(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}},ue.defaults=r,ue.use=function(...e){return ce.use(...e),ue.defaults=ce.defaults,s(ue.defaults),ue},ue.walkTokens=function(e,t){return ce.walkTokens(e,t)},ue.parseInline=ce.parseInline,ue.Parser=oe,ue.parser=oe.parse,ue.Renderer=ae,ue.TextRenderer=ie,ue.Lexer=se,ue.lexer=se.lex,ue.Tokenizer=w,ue.Hooks=le,ue.parse=ue,ue.options,ue.setOptions,ue.use,ue.walkTokens,ue.parseInline,oe.parse,se.lex}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r](a,a.exports,n),a.loaded=!0,a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(4099),n(6548),n(434),n(8361),n(3641)})();